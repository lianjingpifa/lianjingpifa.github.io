(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d70e17b0"],{"4f3a":function(e,t,a){"use strict";a("d1ef")},cad5:function(e,t,a){"use strict";a.r(t);var l=a("7a23"),c=a("23f9"),o=a("e5f6"),i=a("fa7c"),n=a("5aa0"),r=a("1fba");const[s,d,u]=Object(r["a"])("uploader");function p(e,t){return new Promise(a=>{if("file"===t)return void a();const l=new FileReader;l.onload=e=>{a(e.target.result)},"dataUrl"===t?l.readAsDataURL(e):"text"===t&&l.readAsText(e)})}function b(e,t){return Object(i["o"])(e).some(e=>!!e.file&&(Object(i["g"])(t)?t(e.file):e.file.size>+t))}function m(e,t){const a=[],l=[];return e.forEach(e=>{b(e,t)?l.push(e):a.push(e)}),{valid:a,invalid:l}}const f=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,v=e=>f.test(e);function j(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?v(e.url):"string"===typeof e.content&&0===e.content.indexOf("data:image"))}var O=a("450f"),g=a("efd9"),w=a("9a1c"),V=a("0ae8"),h=a("9b55"),y=a("aee2"),k=a("5913"),x=Object(l["defineComponent"])({props:{name:o["f"],item:Object(o["d"])(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:t,slots:a}){const c=()=>{const{status:t,message:a}=e.item;if("uploading"===t||"failed"===t){const e="failed"===t?Object(l["createVNode"])(w["a"],{name:"close",class:d("mask-icon")},null):Object(l["createVNode"])(k["a"],{class:d("loading")},null),c=Object(i["f"])(a)&&""!==a;return Object(l["createVNode"])("div",{class:d("mask")},[e,c&&Object(l["createVNode"])("div",{class:d("mask-message")},[a])])}},o=a=>{const{name:l,item:c,index:o,beforeDelete:i}=e;a.stopPropagation(),Object(h["a"])(i,{args:[c,{name:l,index:o}],done:()=>t("delete")})},r=()=>t("preview"),s=()=>t("reupload"),p=()=>{if(e.deletable&&"uploading"!==e.item.status){const e=a["preview-delete"];return Object(l["createVNode"])("div",{role:"button",class:d("preview-delete",{shadow:!e}),tabindex:0,"aria-label":u("delete"),onClick:o},[e?e():Object(l["createVNode"])(w["a"],{name:"cross",class:d("preview-delete-icon")},null)])}},b=()=>{if(a["preview-cover"]){const{index:t,item:c}=e;return Object(l["createVNode"])("div",{class:d("preview-cover")},[a["preview-cover"](Object(i["a"])({index:t},c))])}},m=()=>{const{item:t,lazyLoad:a,imageFit:c,previewSize:o,reupload:i}=e;return j(t)?Object(l["createVNode"])(y["a"],{fit:c,src:t.objectUrl||t.content||t.url,class:d("preview-image"),width:Array.isArray(o)?o[0]:o,height:Array.isArray(o)?o[1]:o,lazyLoad:a,onClick:i?s:r},{default:b}):Object(l["createVNode"])("div",{class:d("file"),style:Object(n["f"])(e.previewSize)},[Object(l["createVNode"])(w["a"],{class:d("file-icon"),name:"description"},null),Object(l["createVNode"])("div",{class:[d("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),b()])};return()=>Object(l["createVNode"])("div",{class:d("preview")},[m(),c(),p()])}});const N={name:Object(o["c"])(""),accept:Object(o["e"])("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:Object(o["c"])(1/0),imageFit:Object(o["e"])("cover"),resultType:Object(o["e"])("dataUrl"),uploadIcon:Object(o["e"])("photograph"),uploadText:String,deletable:o["g"],reupload:Boolean,afterRead:Function,showUpload:o["g"],modelValue:Object(o["a"])(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:o["g"],previewOptions:Object,previewFullImage:o["g"],maxSize:{type:[Number,String,Function],default:1/0}};var S=Object(l["defineComponent"])({name:s,props:N,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:t,slots:a}){const c=Object(l["ref"])(),o=[],r=Object(l["ref"])(-1),s=Object(l["ref"])(!1),u=(t=e.modelValue.length)=>({name:e.name,index:t}),f=()=>{c.value&&(c.value.value="")},v=a=>{if(f(),b(a,e.maxSize)){if(!Array.isArray(a))return void t("oversize",a,u());{const l=m(a,e.maxSize);if(a=l.valid,t("oversize",l.invalid,u()),!a.length)return}}if(a=Object(l["reactive"])(a),r.value>-1){const l=[...e.modelValue];l.splice(r.value,1,a),t("update:modelValue",l),r.value=-1}else t("update:modelValue",[...e.modelValue,...Object(i["o"])(a)]);e.afterRead&&e.afterRead(a,u())},h=t=>{const{maxCount:a,modelValue:l,resultType:c}=e;if(Array.isArray(t)){const e=+a-l.length;t.length>e&&(t=t.slice(0,e)),Promise.all(t.map(e=>p(e,c))).then(e=>{const a=t.map((t,a)=>{const l={file:t,status:"",message:"",objectUrl:URL.createObjectURL(t)};return e[a]&&(l.content=e[a]),l});v(a)})}else p(t,c).then(e=>{const a={file:t,status:"",message:"",objectUrl:URL.createObjectURL(t)};e&&(a.content=e),v(a)})},y=t=>{const{files:a}=t.target;if(e.disabled||!a||!a.length)return;const l=1===a.length?a[0]:[].slice.call(a);if(e.beforeRead){const t=e.beforeRead(l,u());if(!t)return void f();if(Object(i["k"])(t))return void t.then(e=>{h(e||l)}).catch(f)}h(l)};let k;const N=()=>t("closePreview"),S=t=>{if(e.previewFullImage){const a=e.modelValue.filter(j),l=a.map(e=>(e.objectUrl&&!e.url&&"failed"!==e.status&&(e.url=e.objectUrl,o.push(e.url)),e.url)).filter(Boolean);k=Object(V["a"])(Object(i["a"])({images:l,startPosition:a.indexOf(t),onClose:N},e.previewOptions))}},U=()=>{k&&k.close()},z=(a,l)=>{const c=e.modelValue.slice(0);c.splice(l,1),t("update:modelValue",c),t("delete",a,u(l))},C=e=>{s.value=!0,r.value=e,Object(l["nextTick"])(()=>I())},R=()=>{s.value||(r.value=-1),s.value=!1},B=(c,o)=>{const n=["imageFit","deletable","reupload","previewSize","beforeDelete"],r=Object(i["a"])(Object(i["n"])(e,n),Object(i["n"])(c,n,!0));return Object(l["createVNode"])(x,Object(l["mergeProps"])({item:c,index:o,onClick:()=>t(e.reupload?"clickReupload":"clickPreview",c,u(o)),onDelete:()=>z(c,o),onPreview:()=>S(c),onReupload:()=>C(o)},Object(i["n"])(e,["name","lazyLoad"]),r),Object(i["n"])(a,["preview-cover","preview-delete"]))},F=()=>{if(e.previewImage)return e.modelValue.map(B)},L=e=>t("clickUpload",e),A=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const t=e.modelValue.length>=+e.maxCount&&e.reupload,o=e.readonly?null:Object(l["createVNode"])("input",{ref:c,type:"file",class:d("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&-1===r.value,disabled:e.disabled,onChange:y,onClick:R},null);return a.default?Object(l["withDirectives"])(Object(l["createVNode"])("div",{class:d("input-wrapper"),onClick:L},[a.default(),o]),[[l["vShow"],!t]]):Object(l["withDirectives"])(Object(l["createVNode"])("div",{class:d("upload",{readonly:e.readonly}),style:Object(n["f"])(e.previewSize),onClick:L},[Object(l["createVNode"])(w["a"],{name:e.uploadIcon,class:d("upload-icon")},null),e.uploadText&&Object(l["createVNode"])("span",{class:d("upload-text")},[e.uploadText]),o]),[[l["vShow"],e.showUpload&&!t]])},I=()=>{c.value&&!e.disabled&&c.value.click()};return Object(l["onBeforeUnmount"])(()=>{o.forEach(e=>URL.revokeObjectURL(e))}),Object(g["a"])({chooseFile:I,closeImagePreview:U}),Object(O["useCustomFieldValue"])(()=>e.modelValue),()=>Object(l["createVNode"])("div",{class:d()},[Object(l["createVNode"])("div",{class:d("wrapper",{disabled:e.disabled})},[F(),A()])])}});const U=Object(c["a"])(S);var z=a("2af9"),C=a("eeb9");const R=e=>(Object(l["pushScopeId"])("data-v-4d974689"),e=e(),Object(l["popScopeId"])(),e),B={class:"upload-box"},F={key:0,class:"van-icon van-icon-photograph default-icon"},L=R(()=>Object(l["createElementVNode"])("span",{class:"van-icon van-icon-cross"},null,-1)),A=[L];var I={__name:"index",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=Object(l["inject"])("$Message",()=>{});async function c({file:e}){try{const a=new FormData;a.append("file",e);const{returnCode:l,data:c}=await Object(C["L"])(a)||{};0===l&&t("update:modelValue",c)}catch(l){a.error(l.message||l)}}return(a,o)=>(Object(l["openBlock"])(),Object(l["createBlock"])(Object(l["unref"])(U),{accept:"image/*","after-read":c,"preview-image":!1,"max-count":1,class:"viUploadSingleImg"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",B,[e.modelValue?(Object(l["openBlock"])(),Object(l["createElementBlock"])(l["Fragment"],{key:1},[Object(l["createVNode"])(Object(l["unref"])(z["e"]),{src:e.modelValue,size:"80px",class:"image-box"},null,8,["src"]),Object(l["createElementVNode"])("div",{class:"delete-btn",onClick:o[0]||(o[0]=e=>t("update:modelValue",""))},A)],64)):(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",F))])]),_:1}))}},P=(a("4f3a"),a("6b0d")),D=a.n(P);const E=D()(I,[["__scopeId","data-v-4d974689"]]);t["default"]=E},d1ef:function(e,t,a){}}]);