(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ea0c766c"],{"027e":function(e,t,c){"use strict";c("f96e")},"13d5":function(e,t,c){"use strict";var a=c("23e7"),o=c("d58f").left,l=c("a640"),n=c("2d00"),r=c("605d"),i=!r&&n>79&&n<83,d=i||!l("reduce");a({target:"Array",proto:!0,forced:d},{reduce:function(e){var t=arguments.length;return o(this,e,t,t>1?arguments[1]:void 0)}})},5713:function(e,t,c){"use strict";c("9362")},"605d":function(e,t,c){"use strict";var a=c("da84"),o=c("c6b6");e.exports="process"===o(a.process)},"7a37":function(e,t,c){"use strict";c.r(t);c("13d5"),c("14d9");var a=c("7a23"),o=c("f23a"),l=c("e84a"),n=c("2af9"),r=c("23f9"),i=c("1fba"),d=c("e5f6"),u=c("450f");const[s,b]=Object(i["a"])("radio-group"),O={shape:String,disabled:Boolean,iconSize:d["f"],direction:String,modelValue:d["h"],checkedColor:String},m=Symbol(s);var j=Object(a["defineComponent"])({name:s,props:O,emits:["change","update:modelValue"],setup(e,{emit:t,slots:c}){const{linkChildren:o}=Object(u["useChildren"])(m),l=e=>t("update:modelValue",e);return Object(a["watch"])(()=>e.modelValue,e=>t("change",e)),o({props:e,updateValue:l}),Object(u["useCustomFieldValue"])(()=>e.modelValue),()=>{var t;return Object(a["createVNode"])("div",{class:b([e.direction]),role:"radiogroup"},[null==(t=c.default)?void 0:t.call(c)])}}});const p=Object(r["a"])(j);var f=c("fa7c"),v=c("8343");const h=Object(f["a"])({},v["a"],{shape:String}),[g,V]=Object(i["a"])("radio");var k=Object(a["defineComponent"])({name:g,props:h,emits:["update:modelValue"],setup(e,{emit:t,slots:c}){const{parent:o}=Object(u["useParent"])(m),l=()=>{const t=o?o.props.modelValue:e.modelValue;return t===e.name},n=()=>{o?o.updateValue(e.name):t("update:modelValue",e.name)};return()=>Object(a["createVNode"])(v["b"],Object(a["mergeProps"])({bem:V,role:"radio",parent:o,checked:l(),onToggle:n},e),Object(f["n"])(c,["default","icon"]))}});const C=Object(r["a"])(k);var N=c("eeb9");const y={key:0,class:"flex-ac"};var w={__name:"userSelect",props:{modelValue:{type:Boolean,default:!1},userId:{type:[Number,String],default:""}},emits:["update:modelValue","update:userId","on-change"],setup(e,{emit:t}){const c=e,l=Object(a["inject"])("$Message",()=>{}),r=Object(a["inject"])("$Auth",()=>!1),i=Object(a["computed"])({get(){return c.modelValue},set(e){t("update:modelValue",e)}}),d=Object(a["computed"])({get(){return c.userId},set(e){t("update:userId",e)}}),u=Object(a["ref"])("");function s(e){return Object(N["C"])({...e,name:u.value,power:"9"})}const b=Object(a["ref"])();Object(a["watch"])(()=>u.value,()=>{var e;null===(e=b.value)||void 0===e||e.reSearch()});const O=Object(a["ref"])(""),m=Object(a["ref"])(!1);function j(e){e.userId!==d.value?(d.value=e.userId,t("on-change",e.userId,e)):(d.value="",t("on-change","")),O.value="",i.value=!1}async function f(){if(O.value)try{m.value=!0;const{data:e}=await Object(N["V"])({name:O.value})||{};if(e)return l.success("名称已存在\n已选择"),void j(e);const{data:t}=await Object(N["O"])({name:O.value})||{};t&&(l.success("新增成功"),j(t))}catch(e){l.error("新增客户失败："+(e.message||e))}finally{m.value=!1}else l.info("请输入要新增的客户名称")}return(e,t)=>{const c=Object(a["resolveComponent"])("Spin"),l=Object(a["resolveComponent"])("Icon"),v=Object(a["resolveComponent"])("van-cell"),h=Object(a["resolveComponent"])("viModal");return Object(a["openBlock"])(),Object(a["createBlock"])(h,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=e=>i.value=e),title:"选择客户"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{fix:"",show:m.value},null,8,["show"]),Object(a["unref"])(r)(2)?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",y,[Object(a["createVNode"])(Object(a["unref"])(o["a"]),{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),label:"没有？快速新增：","label-width":"120",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(a["createVNode"])(l,{type:"ios-checkmark-circle-outline",color:"green",size:"30",class:"mr-10",onClick:f})])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(Object(a["unref"])(o["a"]),{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),label:"过滤客户：","label-width":"80",clearable:"",placeholder:"客户名称",class:"flex-none"},null,8,["modelValue"]),Object(a["createVNode"])(Object(a["unref"])(p),{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),class:"user-list"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(n["i"]),{ref_key:"listRef",ref:b,getData:s,celSpacing:!1,class:"h100"},{default:Object(a["withCtx"])(({item:e})=>[Object(a["createVNode"])(v,{title:e.name,clickable:"",onClick:t=>j(e),class:"cell"},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(C),{name:e.userId,onClick:Object(a["withModifiers"])(t=>j(e),["stop"])},null,8,["name","onClick"])]),_:2},1032,["title","onClick"])]),_:1},512)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},B=(c("5713"),c("6b0d")),x=c.n(B);const I=x()(w,[["__scopeId","data-v-c60821da"]]);var S=I,E=c("6605"),_=c("4360");const U=e=>(Object(a["pushScopeId"])("data-v-46fc63be"),e=e(),Object(a["popScopeId"])(),e),P={class:"container"},$={class:"list"},z={class:"card"},T={class:"card-top"},D={key:0,class:"card-middle"},J=["onClick"],M={class:"origin"},F={class:"flex-ac"},W=U(()=>Object(a["createElementVNode"])("label",{class:"f-16 mr-5"},"￥",-1)),A=U(()=>Object(a["createElementVNode"])("label",{class:"f-16 ml-10 mr-10"}," / ",-1)),G={key:1,class:"card-middle"},R={class:"price"},L={class:"bottom-box"},H={class:"total"};var X={__name:"mobile",setup(e){const t=Object(E["c"])(),c=Object(_["b"])(),r=Object(a["inject"])("$Message",()=>{}),i=Object(a["inject"])("$Modal",()=>{}),d=Object(a["inject"])("$Auth",()=>!1),u=Object(a["ref"])(JSON.parse(localStorage.getItem("order")||"[]")),s=Object(a["ref"])("0.00"),b=Object(a["ref"])(!1),O=Object(a["ref"])(""),m=Object(a["ref"])({});async function j(e="",t){try{if(O.value=e,!e)return void(m.value={});m.value={...t};const{returnCode:c,data:a}=await Object(N["x"])({userId:e})||{};if(0===c){const e={};a.forEach(t=>{e[t.goodId]=+t.specialPrice}),m.value={...t,special:e},u.value=u.value.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))}}catch(c){r.error("获取客户特价失败："+(c.message||c))}}Object(a["watch"])(()=>u.value,()=>{s.value=(u.value.reduce((e,t)=>e+ +(t.count*(t.price||0)).toFixed(2),0)||0).toFixed(2),window.$EventBus.$emit("setBadge",{mobileCashier:u.value.reduce((e,t)=>e+ +t.count,0)}),localStorage.setItem("order",JSON.stringify(u.value))},{deep:!0});const p=Object(a["ref"])("");async function f(e,t){p.value=e||"",await j(t.userId,{userId:t.userId,userName:t.userName}),u.value=JSON.parse(t.detail||"[]").map(e=>("copy"===t.type&&(e.price=e.originPrice),e))}function v(e){f(e.orderId,e),history.state.params={}}function h(){i.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{p.value=""}})}function g(e){e?u.value=[]:i.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{u.value=[]}})}function V(e,t){const c=[...u.value],a=c.findIndex(t=>t.goodId===e.goodId),o=c.findIndex(e=>!e.goodId);t?(-1===a?-1===o?c.push({...curGood.value}):c.splice(o,0,{...curGood.value}):c.splice(a,1,{...e}),u.value=c):-1!==a&&i.confirm({title:"删除商品",content:`确认删除${e.name}?`,onOk:()=>{c.splice(a,1),u.value=c},onCancel:()=>{u.value[a]={...e,count:++t}}})}Object(a["watch"])(()=>t,({name:e})=>{if("mobileCashier"!==e)return;d(3)||j(c.userInfo.userId);const{params:t={}}=history.state;Object.keys(t).length&&(u.value.length?i.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{v(t)}}):v(t))},{deep:!0,immediate:!0});const k=Object(a["ref"])("");function C(){i.confirm({title:"添加特殊行",render:e=>e(n["f"],{modelValue:k.value,placeholder:"添加特殊商品行",onOnChange:e=>k.value=e,onOnEnter:()=>{u.value.push({name:k.value,count:1,price:0}),k.value="",i.remove()}}),onOk:()=>{u.value.push({name:k.value,count:1,price:0}),k.value=""}})}const y=Object(a["ref"])(!1);async function w(e){if(!d(9))return r.info("未审批客户无法提交，请联系商家");if("1"==e&&!O.value)return r.info("请填写客户名称");if("2"!=e||O.value)try{y.value=!0;const{returnCode:t,data:c}=await Object(N["M"])({orderId:p.value||void 0,userId:O.value,userName:m.value.name,status:e,total:s.value,detail:JSON.stringify(u.value)})||{};0===t&&c&&(r.success("操作成功"),window.$EventBus.$emit("refreshOrder"),g(!0),j(),p.value="")}catch(t){r.error("保存草稿失败："+(t.message||t))}finally{y.value=!1}}return Object(a["onActivated"])(()=>{u.value=JSON.parse(localStorage.getItem("order")||"[]")}),(e,t)=>{const c=Object(a["resolveComponent"])("Spin"),r=Object(a["resolveComponent"])("Icon"),i=Object(a["resolveComponent"])("van-cell"),f=Object(a["resolveComponent"])("viEmpty"),v=Object(a["resolveComponent"])("viInputNumber"),k=Object(a["resolveComponent"])("Button");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",P,[Object(a["createVNode"])(c,{fix:"",show:y.value},null,8,["show"]),Object(a["unref"])(d)(3)?(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:0,type:"ios-add",size:"28",onClick:C,class:"vi-header-icon left vi-red-text"})):Object(a["createCommentVNode"])("",!0),p.value?(Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["unref"])(o["a"]),{key:1,label:"订单编号",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),"input-align":"right",readonly:"",class:"flex-none"},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{type:"md-close",size:"25",onClick:h,class:"vi-link-text"})]),_:1},8,["modelValue"])):Object(a["createCommentVNode"])("",!0),Object(a["unref"])(d)(3)?(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:2,title:"客户名称",value:m.value.name,onClick:t[1]||(t[1]=e=>b.value=!0),"is-link":"",class:"user-select"},null,8,["value"])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(Object(a["unref"])(S),{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=e=>b.value=e),userId:O.value,"onUpdate:userId":t[3]||(t[3]=e=>O.value=e),onOnChange:j},null,8,["modelValue","userId"]),Object(a["createElementVNode"])("div",$,[u.value.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(f,{key:0})),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(u.value,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["unref"])(l["a"]),{key:t},{right:Object(a["withCtx"])(()=>[Object(a["createVNode"])(k,{type:"error",onClick:t=>V(e,0)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("删除")]),_:2},1032,["onClick"])]),default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",z,[Object(a["createElementVNode"])("div",T,[Object(a["createElementVNode"])("p",{class:Object(a["normalizeClass"])(["title",{"vi-red-text":!e.goodId}])},Object(a["toDisplayString"])(e.name),3),Object(a["createVNode"])(v,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>V(e,t),class:"count-input"},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),Object(a["unref"])(d)(3)?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",D,[e.goodId&&e.price!=e.originPrice&&e.unit==e.originUnit&&e.standard==e.originStandard?(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{key:0,onClick:t=>e.price=e.originPrice,class:"price"},[Object(a["createElementVNode"])("span",M,"￥ "+Object(a["toDisplayString"])(e.originPrice||0),1)],8,J)):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",F,[W,Object(a["createVNode"])(v,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,step:.5,class:"count-input"},null,8,["modelValue","onUpdate:modelValue"]),A,Object(a["createVNode"])(Object(a["unref"])(n["f"]),{modelValue:e.unit,"onUpdate:modelValue":t=>e.unit=t,placeholder:"单位",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),Object(a["createVNode"])(Object(a["unref"])(n["f"]),{modelValue:e.standard,"onUpdate:modelValue":t=>e.standard=t,placeholder:"规格",class:"flex-1 ml-10"},null,8,["modelValue","onUpdate:modelValue"])])])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",G,[Object(a["createElementVNode"])("p",R,"￥ "+Object(a["toDisplayString"])(e.price),1)])),Object(a["createVNode"])(Object(a["unref"])(o["a"]),{modelValue:e.remarks,"onUpdate:modelValue":t=>e.remarks=t,label:"备注：","label-width":"50",clearable:"",placeholder:"备注，有就填",class:"card-bottom"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),Object(a["createElementVNode"])("div",L,[Object(a["createElementVNode"])("p",H,"总计：￥"+Object(a["toDisplayString"])(s.value),1),Object(a["createVNode"])(k,{type:"error",onClick:t[4]||(t[4]=e=>g())},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("清空商品")]),_:1}),Object(a["unref"])(d)(3)?(Object(a["openBlock"])(),Object(a["createBlock"])(k,{key:0,onClick:t[5]||(t[5]=e=>w("1"))},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("保存草稿")]),_:1})):(Object(a["openBlock"])(),Object(a["createBlock"])(k,{key:1,type:"primary",onClick:t[6]||(t[6]=e=>w("1"))},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("提交订单")]),_:1})),Object(a["unref"])(d)(2)?(Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["unref"])(n["l"]),{key:2,list:u.value,total:s.value,"user-data":m.value,onPrint:t[7]||(t[7]=e=>w("2"))},null,8,["list","total","user-data"])):Object(a["createCommentVNode"])("",!0)])])}}};c("027e");const q=x()(X,[["__scopeId","data-v-46fc63be"]]);t["default"]=q},8343:function(e,t,c){"use strict";c.d(t,"a",(function(){return i})),c.d(t,"b",(function(){return d}));var a=c("7a23"),o=c("e5f6"),l=c("fa7c"),n=c("5aa0"),r=c("9a1c");const i={name:o["h"],disabled:Boolean,iconSize:o["f"],modelValue:o["h"],checkedColor:String,labelPosition:String,labelDisabled:Boolean};var d=Object(a["defineComponent"])({props:Object(l["a"])({},i,{bem:Object(o["d"])(Function),role:String,shape:String,parent:Object,checked:Boolean,bindGroup:o["g"],indeterminate:{type:Boolean,default:null}}),emits:["click","toggle"],setup(e,{emit:t,slots:c}){const o=Object(a["ref"])(),l=t=>{if(e.parent&&e.bindGroup)return e.parent.props[t]},i=Object(a["computed"])(()=>{if(e.parent&&e.bindGroup){const t=l("disabled")||e.disabled;if("checkbox"===e.role){const c=l("modelValue").length,a=l("max"),o=a&&c>=+a;return t||o&&!e.checked}return t}return e.disabled}),d=Object(a["computed"])(()=>l("direction")),u=Object(a["computed"])(()=>{const t=e.checkedColor||l("checkedColor");if(t&&e.checked&&!i.value)return{borderColor:t,backgroundColor:t}}),s=Object(a["computed"])(()=>e.shape||l("shape")||"round"),b=c=>{const{target:a}=c,l=o.value,n=l===a||(null==l?void 0:l.contains(a));i.value||!n&&e.labelDisabled||t("toggle"),t("click",c)},O=()=>{var t,d;const{bem:b,checked:O,indeterminate:m}=e,j=e.iconSize||l("iconSize");return Object(a["createVNode"])("div",{ref:o,class:b("icon",[s.value,{disabled:i.value,checked:O,indeterminate:m}]),style:"dot"!==s.value?{fontSize:Object(n["b"])(j)}:{width:Object(n["b"])(j),height:Object(n["b"])(j),borderColor:null==(t=u.value)?void 0:t.borderColor}},[c.icon?c.icon({checked:O,disabled:i.value}):"dot"!==s.value?Object(a["createVNode"])(r["a"],{name:m?"minus":"success",style:u.value},null):Object(a["createVNode"])("div",{class:b("icon--dot__icon"),style:{backgroundColor:null==(d=u.value)?void 0:d.backgroundColor}},null)])},m=()=>{const{checked:t}=e;if(c.default)return Object(a["createVNode"])("span",{class:e.bem("label",[e.labelPosition,{disabled:i.value}])},[c.default({checked:t,disabled:i.value})])};return()=>{const t="left"===e.labelPosition?[m(),O()]:[O(),m()];return Object(a["createVNode"])("div",{role:e.role,class:e.bem([{disabled:i.value,"label-disabled":e.labelDisabled},d.value]),tabindex:i.value?void 0:0,"aria-checked":e.checked,onClick:b},[t])}}})},9362:function(e,t,c){},a640:function(e,t,c){"use strict";var a=c("d039");e.exports=function(e,t){var c=[][e];return!!c&&a((function(){c.call(null,t||function(){return 1},1)}))}},d58f:function(e,t,c){"use strict";var a=c("59ed"),o=c("7b0b"),l=c("44ad"),n=c("07fa"),r=TypeError,i=function(e){return function(t,c,i,d){a(c);var u=o(t),s=l(u),b=n(u),O=e?b-1:0,m=e?-1:1;if(i<2)while(1){if(O in s){d=s[O],O+=m;break}if(O+=m,e?O<0:b<=O)throw r("Reduce of empty array with no initial value")}for(;e?O>=0:b>O;O+=m)O in s&&(d=c(d,s[O],O,u));return d}};e.exports={left:i(!1),right:i(!0)}},e84a:function(e,t,c){"use strict";c.d(t,"a",(function(){return v}));var a=c("23f9"),o=c("7a23"),l=c("1fba"),n=c("e5f6"),r=c("fa7c"),i=c("8db7"),d=c("5aa0"),u=c("9b55"),s=c("450f"),b=c("d7d5"),O=c("efd9");const[m,j]=Object(l["a"])("swipe-cell"),p={name:Object(n["c"])(""),disabled:Boolean,leftWidth:n["f"],rightWidth:n["f"],beforeClose:Function,stopPropagation:Boolean};var f=Object(o["defineComponent"])({name:m,props:p,emits:["open","close","click"],setup(e,{emit:t,slots:c}){let a,l,n,m;const p=Object(o["ref"])(),f=Object(o["ref"])(),v=Object(o["ref"])(),h=Object(o["reactive"])({offset:0,dragging:!1}),g=Object(b["a"])(),V=e=>e.value?Object(s["useRect"])(e).width:0,k=Object(o["computed"])(()=>Object(r["f"])(e.leftWidth)?+e.leftWidth:V(f)),C=Object(o["computed"])(()=>Object(r["f"])(e.rightWidth)?+e.rightWidth:V(v)),N=c=>{h.offset="left"===c?k.value:-C.value,a||(a=!0,t("open",{name:e.name,position:c}))},y=c=>{h.offset=0,a&&(a=!1,t("close",{name:e.name,position:c}))},w=e=>{const t=Math.abs(h.offset),c=.15,o=a?1-c:c,l="left"===e?k.value:C.value;l&&t>l*o?N(e):y(e)},B=t=>{e.disabled||(n=h.offset,g.start(t))},x=t=>{if(e.disabled)return;const{deltaX:c}=g;if(g.move(t),g.isHorizontal()){l=!0,h.dragging=!0;const o=!a||c.value*n<0;o&&Object(i["e"])(t,e.stopPropagation),h.offset=Object(d["d"])(c.value+n,-C.value,k.value)}},I=()=>{h.dragging&&(h.dragging=!1,w(h.offset>0?"left":"right"),setTimeout(()=>{l=!1},0))},S=(c="outside")=>{m||(t("click",c),a&&!l&&(m=!0,Object(u["a"])(e.beforeClose,{args:[{name:e.name,position:c}],done:()=>{m=!1,y(c)},canceled:()=>m=!1,error:()=>m=!1})))},E=(e,t)=>c=>{t&&c.stopPropagation(),S(e)},_=(e,t)=>{const a=c[e];if(a)return Object(o["createVNode"])("div",{ref:t,class:j(e),onClick:E(e,!0)},[a()])};return Object(O["a"])({open:N,close:y}),Object(s["useClickAway"])(p,()=>S("outside"),{eventName:"touchstart"}),Object(s["useEventListener"])("touchmove",x,{target:p}),()=>{var e;const t={transform:`translate3d(${h.offset}px, 0, 0)`,transitionDuration:h.dragging?"0s":".6s"};return Object(o["createVNode"])("div",{ref:p,class:j(),onClick:E("cell",l),onTouchstartPassive:B,onTouchend:I,onTouchcancel:I},[Object(o["createVNode"])("div",{class:j("wrapper"),style:t},[_("left",f),null==(e=c.default)?void 0:e.call(c),_("right",v)])])}}});const v=Object(a["a"])(f)},f96e:function(e,t,c){}}]);