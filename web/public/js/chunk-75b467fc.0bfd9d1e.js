(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75b467fc"],{"083a":function(e,t,a){"use strict";var c=a("0d51"),o=TypeError;e.exports=function(e,t){if(!delete e[t])throw o("Cannot delete property "+c(t)+" of "+c(e))}},"13d5":function(e,t,a){"use strict";var c=a("23e7"),o=a("d58f").left,l=a("a640"),n=a("2d00"),r=a("605d"),i=!r&&n>79&&n<83,s=i||!l("reduce");c({target:"Array",proto:!0,forced:s},{reduce:function(e){var t=arguments.length;return o(this,e,t,t>1?arguments[1]:void 0)}})},3019:function(e,t,a){},"3c65":function(e,t,a){"use strict";var c=a("23e7"),o=a("7b0b"),l=a("07fa"),n=a("3a34"),r=a("083a"),i=a("3511"),s=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},d=s||!u();c({target:"Array",proto:!0,arity:1,forced:d},{unshift:function(e){var t=o(this),a=l(t),c=arguments.length;if(c){i(a+c);var s=a;while(s--){var u=s+c;s in t?t[u]=t[s]:r(t,u)}for(var d=0;d<c;d++)t[d]=arguments[d]}return n(t,a+c)}})},"605d":function(e,t,a){"use strict";var c=a("da84"),o=a("c6b6");e.exports="process"===o(c.process)},7007:function(e,t,a){"use strict";a("3019")},a640:function(e,t,a){"use strict";var c=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&c((function(){a.call(null,t||function(){return 1},1)}))}},c93a:function(e,t,a){"use strict";a("cd61")},cd61:function(e,t,a){},d58f:function(e,t,a){"use strict";var c=a("59ed"),o=a("7b0b"),l=a("44ad"),n=a("07fa"),r=TypeError,i=function(e){return function(t,a,i,s){c(a);var u=o(t),d=l(u),b=n(u),f=e?b-1:0,O=e?-1:1;if(i<2)while(1){if(f in d){s=d[f],f+=O;break}if(f+=O,e?f<0:b<=f)throw r("Reduce of empty array with no initial value")}for(;e?f>=0:b>f;f+=O)f in d&&(s=a(s,d[f],f,u));return s}};e.exports={left:i(!1),right:i(!0)}},df0a:function(e,t,a){"use strict";a.r(t);a("13d5"),a("3c65");var c=a("7a23"),o=a("e84a"),l=a("f23a"),n=a("2af9"),r=a("f6f3"),i=a("eeb9"),s=a("6605");const u=e=>(Object(c["pushScopeId"])("data-v-30db8ce6"),e=e(),Object(c["popScopeId"])(),e),d={class:"container"},b={class:"list"},f={class:"card"},O={class:"card-top"},p={class:"title"},v={class:"card-middle"},m=["onClick"],j={class:"flex-ac"},h=u(()=>Object(c["createElementVNode"])("label",{class:"f-16 mr-5"},"￥",-1)),g=u(()=>Object(c["createElementVNode"])("label",{class:"f-16 ml-10 mr-10"}," / ",-1)),V={class:"bottom-box"},k={class:"total"},C={class:"btn-box"};var N={__name:"index",setup(e){const t=Object(s["c"])(),a=Object(c["inject"])("$Message",()=>{}),u=Object(c["inject"])("$Modal",()=>{}),N=Object(c["ref"])([]);async function y(){try{const{returnCode:e,data:t}=await Object(i["o"])()||{};0===e&&(N.value=t&&t.map(e=>{const t={};return e.special.forEach(e=>{t[e.goodId]=+e.price}),e.special=t,e})||[])}catch(e){a.error("获取客户列表失败："+(e.message||e))}}const w=Object(c["ref"])(!1),x=Object(c["ref"])(""),I=Object(c["computed"])(()=>N.value.find(e=>e.userId==x.value)||{}),E=Object(c["ref"])([]),B=Object(c["ref"])("0.00");function U(){const{special:e={}}=I.value;E.value=E.value.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))}Object(c["watch"])(()=>x.value,U),Object(c["watch"])(()=>E.value,()=>{B.value=(E.value.reduce((e,t)=>e+ +(t.count*t.price).toFixed(2),0)||0).toFixed(2),window.$EventBus.$emit("badge",{mobileCashier:E.value.reduce((e,t)=>e+ +t.count,0)}),sessionStorage.setItem("order",JSON.stringify(E.value))},{deep:!0});const S=Object(c["ref"])("");function _(e){x.value=e.userId?+e.userId:"",S.value=e.orderId||"",Object(c["nextTick"])(()=>{E.value=JSON.parse(e.goodList||"[]").map(t=>("copy"===e.type&&(t.price=t.originPrice),t)),history.state.params={}})}function P(){u.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{S.value=""}})}function T(e){e?E.value=[]:u.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{E.value=[]}})}function $(e,t){const a=[...E.value],c=a.findIndex(t=>t.goodId===e.goodId);t?(-1===c?a.unshift({...e}):a.splice(c,1,{...e}),E.value=a):-1!==c&&u.confirm({title:"删除商品",content:`确认删除${e.name}?`,onOk:()=>{a.splice(c,1),E.value=a},onCancel:()=>{E.value[c]={...e,count:++t}}})}Object(c["watch"])(()=>t,({name:e})=>{if("mobileCashier"!==e)return;const{params:t={}}=history.state;Object.keys(t).length&&(E.value.length?u.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{_(t)}}):_(t))},{deep:!0,immediate:!0});const J=Object(c["ref"])(!1);async function z(e){if("1"==e&&!x.value)return a.info("请填写客户名称");if("2"!=e||x.value)try{J.value=!0;const{returnCode:t,data:c}=await Object(i["H"])({orderId:S.value||void 0,userId:x.value,status:e,total:B.value,detail:JSON.stringify(E.value)})||{};0===t&&c&&(a.success("保存成功"),window.$EventBus.$emit("saveOrder"),T(!0),x.value="",S.value="",y())}catch(t){a.error("保存草稿失败："+(t.message||t))}finally{J.value=!1}}return Object(c["onActivated"])(()=>{E.value=JSON.parse(sessionStorage.getItem("order")||"[]"),y()}),(e,t)=>{const a=Object(c["resolveComponent"])("Spin"),i=Object(c["resolveComponent"])("Icon"),s=Object(c["resolveComponent"])("van-cell"),u=Object(c["resolveComponent"])("viEmpty"),y=Object(c["resolveComponent"])("viInputNumber"),U=Object(c["resolveComponent"])("viInput"),_=Object(c["resolveComponent"])("Button");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",d,[Object(c["createVNode"])(a,{fix:"",show:J.value},null,8,["show"]),S.value?(Object(c["openBlock"])(),Object(c["createBlock"])(s,{key:0,title:"订单编号",value:S.value,class:"flex-none"},{"right-icon":Object(c["withCtx"])(()=>[Object(c["createVNode"])(i,{type:"md-close",size:"25",onClick:P,class:"vi-link-text ml-10"})]),_:1},8,["value"])):Object(c["createCommentVNode"])("",!0),Object(c["createVNode"])(s,{title:"客户名称",value:I.value.name,onClick:t[0]||(t[0]=e=>w.value=!0),"is-link":"",class:"user-select"},null,8,["value"]),Object(c["createVNode"])(Object(c["unref"])(r["a"]),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=e=>w.value=e),userId:x.value,"onUpdate:userId":t[2]||(t[2]=e=>x.value=e),allUsers:N.value},null,8,["modelValue","userId","allUsers"]),Object(c["createElementVNode"])("div",b,[E.value.length?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(u,{key:0})),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(E.value,(e,t)=>(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(o["a"]),{key:t},{right:Object(c["withCtx"])(()=>[Object(c["createVNode"])(_,{type:"error",onClick:t=>$(e,0)},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])("删除")]),_:2},1032,["onClick"])]),default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",f,[Object(c["createElementVNode"])("div",O,[Object(c["createElementVNode"])("p",p,Object(c["toDisplayString"])(e.name),1),Object(c["createVNode"])(y,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>$(e,t),class:"count-input"},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),Object(c["createElementVNode"])("div",v,[e.price!=e.originPrice&&e.unit==e.originUnit&&e.standard==e.originStandard?(Object(c["openBlock"])(),Object(c["createElementBlock"])("p",{key:0,onClick:t=>e.price=e.originPrice,class:"origin"},[Object(c["createTextVNode"])("￥ "),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.originPrice),1)],8,m)):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("div",j,[h,Object(c["createVNode"])(y,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,min:0,step:.5,class:"count-input"},null,8,["modelValue","onUpdate:modelValue"]),g,Object(c["createVNode"])(U,{modelValue:e.unit,"onUpdate:modelValue":t=>e.unit=t,placeholder:"单位",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),Object(c["createVNode"])(U,{modelValue:e.standard,"onUpdate:modelValue":t=>e.standard=t,placeholder:"规格",class:"flex-1 ml-10"},null,8,["modelValue","onUpdate:modelValue"])])]),Object(c["createVNode"])(Object(c["unref"])(l["a"]),{modelValue:e.remarks,"onUpdate:modelValue":t=>e.remarks=t,label:"备注：","label-width":"50",clearable:"",placeholder:"备注，有就填"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),Object(c["createElementVNode"])("div",V,[Object(c["createElementVNode"])("p",k,"总计：￥"+Object(c["toDisplayString"])(B.value),1),Object(c["createElementVNode"])("div",C,[Object(c["createVNode"])(_,{type:"error",onClick:t[3]||(t[3]=e=>T()),long:"",size:"large",shape:"circle"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])("清空商品")]),_:1}),Object(c["createVNode"])(_,{onClick:t[4]||(t[4]=e=>z("1")),long:"",size:"large",shape:"circle"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])("保存草稿")]),_:1}),Object(c["createVNode"])(Object(c["unref"])(n["i"]),{list:E.value,total:B.value,"user-data":I.value,size:"large",long:"",shape:"circle",onPrint:t[5]||(t[5]=e=>z("2"))},null,8,["list","total","user-data"])])])])}}},y=(a("c93a"),a("6b0d")),w=a.n(y);const x=w()(N,[["__scopeId","data-v-30db8ce6"]]);t["default"]=x},e84a:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var c=a("23f9"),o=a("7a23"),l=a("1fba"),n=a("e5f6"),r=a("fa7c"),i=a("8db7"),s=a("5aa0"),u=a("9b55"),d=a("450f"),b=a("d7d5"),f=a("efd9");const[O,p]=Object(l["a"])("swipe-cell"),v={name:Object(n["c"])(""),disabled:Boolean,leftWidth:n["f"],rightWidth:n["f"],beforeClose:Function,stopPropagation:Boolean};var m=Object(o["defineComponent"])({name:O,props:v,emits:["open","close","click"],setup(e,{emit:t,slots:a}){let c,l,n,O;const v=Object(o["ref"])(),m=Object(o["ref"])(),j=Object(o["ref"])(),h=Object(o["reactive"])({offset:0,dragging:!1}),g=Object(b["a"])(),V=e=>e.value?Object(d["useRect"])(e).width:0,k=Object(o["computed"])(()=>Object(r["e"])(e.leftWidth)?+e.leftWidth:V(m)),C=Object(o["computed"])(()=>Object(r["e"])(e.rightWidth)?+e.rightWidth:V(j)),N=a=>{h.offset="left"===a?k.value:-C.value,c||(c=!0,t("open",{name:e.name,position:a}))},y=a=>{h.offset=0,c&&(c=!1,t("close",{name:e.name,position:a}))},w=e=>{const t=Math.abs(h.offset),a=.15,o=c?1-a:a,l="left"===e?k.value:C.value;l&&t>l*o?N(e):y(e)},x=t=>{e.disabled||(n=h.offset,g.start(t))},I=t=>{if(e.disabled)return;const{deltaX:a}=g;if(g.move(t),g.isHorizontal()){l=!0,h.dragging=!0;const o=!c||a.value*n<0;o&&Object(i["e"])(t,e.stopPropagation),h.offset=Object(s["d"])(a.value+n,-C.value,k.value)}},E=()=>{h.dragging&&(h.dragging=!1,w(h.offset>0?"left":"right"),setTimeout(()=>{l=!1},0))},B=(a="outside")=>{O||(t("click",a),c&&!l&&(O=!0,Object(u["a"])(e.beforeClose,{args:[{name:e.name,position:a}],done:()=>{O=!1,y(a)},canceled:()=>O=!1,error:()=>O=!1})))},U=(e,t)=>a=>{t&&a.stopPropagation(),B(e)},S=(e,t)=>{const c=a[e];if(c)return Object(o["createVNode"])("div",{ref:t,class:p(e),onClick:U(e,!0)},[c()])};return Object(f["a"])({open:N,close:y}),Object(d["useClickAway"])(v,()=>B("outside"),{eventName:"touchstart"}),Object(d["useEventListener"])("touchmove",I,{target:v}),()=>{var e;const t={transform:`translate3d(${h.offset}px, 0, 0)`,transitionDuration:h.dragging?"0s":".6s"};return Object(o["createVNode"])("div",{ref:v,class:p(),onClick:U("cell",l),onTouchstartPassive:x,onTouchend:E,onTouchcancel:E},[Object(o["createVNode"])("div",{class:p("wrapper"),style:t},[S("left",m),null==(e=a.default)?void 0:e.call(a),S("right",j)])])}}});const j=Object(c["a"])(m)},f6f3:function(e,t,a){"use strict";var c=a("7a23"),o=a("f23a"),l=a("eeb9");const n={class:"flex-ac"},r={class:"user-list"};var i={__name:"userSelect",props:{modelValue:{type:Boolean,default:!1},allUsers:{type:Array,default(){return[]}},userId:{type:[Number,String],default:""}},emits:["update:modelValue","update:userId","change"],setup(e,{emit:t}){const a=e,i=Object(c["inject"])("$Message",()=>{}),s=Object(c["computed"])({get(){return a.modelValue},set(e){t("update:modelValue",e)}}),u=Object(c["computed"])({get(){return a.userId},set(e){t("update:userId",e)}}),d=Object(c["ref"])(""),b=Object(c["computed"])(()=>a.allUsers.filter(e=>!d.value||e.name.includes(d.value))),f=Object(c["ref"])(""),O=Object(c["ref"])(!1);function p(e){u.value=e.userId,f.value="",s.value=!1,t("change",e)}async function v(){if(f.value)try{O.value=!0;const{data:e}=await Object(l["N"])({name:f.value})||{};if(e)return i.success("名称已存在\n已选择"),void p(e);const{data:t}=await Object(l["J"])({name:f.value})||{};t&&(i.success("新增成功"),p(t))}catch(e){i.error("新增客户失败："+(e.message||e))}finally{O.value=!1}else i.info("请输入要新增的客户名称")}return(e,t)=>{const a=Object(c["resolveComponent"])("Spin"),l=Object(c["resolveComponent"])("Icon"),i=Object(c["resolveComponent"])("viEmpty"),m=Object(c["resolveComponent"])("van-radio"),j=Object(c["resolveComponent"])("van-cell"),h=Object(c["resolveComponent"])("van-radio-group"),g=Object(c["resolveComponent"])("van-action-sheet");return Object(c["openBlock"])(),Object(c["createBlock"])(g,{show:s.value,"onUpdate:show":t[3]||(t[3]=e=>s.value=e),title:"选择客户"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(a,{fix:"",show:O.value},null,8,["show"]),Object(c["createElementVNode"])("div",n,[Object(c["createVNode"])(Object(c["unref"])(o["a"]),{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),label:"没有？快速新增：","label-width":"120",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(c["createVNode"])(l,{type:"ios-checkmark-circle-outline",color:"green",size:"30",class:"mr-10",onClick:v})]),Object(c["createVNode"])(Object(c["unref"])(o["a"]),{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),label:"过滤客户：","label-width":"80",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(c["createElementVNode"])("div",r,[Object(c["createVNode"])(h,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e)},{default:Object(c["withCtx"])(()=>[b.value.length?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(i,{key:0})),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(b.value,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(j,{key:e.userId,title:e.name,clickable:"",onClick:t=>p(e)},{"right-icon":Object(c["withCtx"])(()=>[Object(c["createVNode"])(m,{name:e.userId},null,8,["name"])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["show"])}}},s=(a("7007"),a("6b0d")),u=a.n(s);const d=u()(i,[["__scopeId","data-v-deb94ee4"]]);t["a"]=d}}]);