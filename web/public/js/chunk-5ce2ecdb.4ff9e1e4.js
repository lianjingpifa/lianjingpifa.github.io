(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ce2ecdb"],{"083a":function(e,t,o){"use strict";var r=o("0d51"),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw a("Cannot delete property "+r(t)+" of "+r(e))}},"13d5":function(e,t,o){"use strict";var r=o("23e7"),a=o("d58f").left,c=o("a640"),s=o("2d00"),n=o("605d"),l=!n&&s>79&&s<83,i=l||!c("reduce");r({target:"Array",proto:!0,forced:i},{reduce:function(e){var t=arguments.length;return a(this,e,t,t>1?arguments[1]:void 0)}})},"1f29":function(e,t,o){"use strict";o("db7f")},"3c65":function(e,t,o){"use strict";var r=o("23e7"),a=o("7b0b"),c=o("07fa"),s=o("3a34"),n=o("083a"),l=o("3511"),i=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},u=i||!d();r({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(e){var t=a(this),o=c(t),r=arguments.length;if(r){l(o+r);var i=o;while(i--){var d=i+r;i in t?t[d]=t[i]:n(t,d)}for(var u=0;u<r;u++)t[u]=arguments[u]}return s(t,o+r)}})},"605d":function(e,t,o){"use strict";var r=o("da84"),a=o("c6b6");e.exports="process"===a(r.process)},a640:function(e,t,o){"use strict";var r=o("d039");e.exports=function(e,t){var o=[][e];return!!o&&r((function(){o.call(null,t||function(){return 1},1)}))}},d384:function(e,t,o){},d58f:function(e,t,o){"use strict";var r=o("59ed"),a=o("7b0b"),c=o("44ad"),s=o("07fa"),n=TypeError,l=function(e){return function(t,o,l,i){r(o);var d=a(t),u=c(d),m=s(d),b=e?m-1:0,h=e?-1:1;if(l<2)while(1){if(b in u){i=u[b],b+=h;break}if(b+=h,e?b<0:m<=b)throw n("Reduce of empty array with no initial value")}for(;e?b>=0:m>b;b+=h)b in u&&(i=o(i,u[b],b,d));return i}};e.exports={left:l(!1),right:l(!0)}},db7f:function(e,t,o){},df0a:function(e,t,o){"use strict";o.r(t);var r=o("7a23");const a=e=>(Object(r["pushScopeId"])("data-v-3aad8323"),e=e(),Object(r["popScopeId"])(),e),c={class:"container"},s={class:"list"},n={class:"card"},l={class:"card-top"},i={class:"title"},d={class:"card-middle"},u=["onClick"],m={class:"flex-ac"},b=a(()=>Object(r["createElementVNode"])("label",{class:"f-16 mr-5"},"￥",-1)),h=a(()=>Object(r["createElementVNode"])("label",{class:"f-16 ml-10 mr-10"}," / ",-1)),p={class:"bottom-box"},f={class:"total"},O={class:"btn-box"};function j(e,t,o,a,j,g){const v=Object(r["resolveComponent"])("Spin"),V=Object(r["resolveComponent"])("Icon"),U=Object(r["resolveComponent"])("van-cell"),C=Object(r["resolveComponent"])("userSelect"),N=Object(r["resolveComponent"])("viEmpty"),k=Object(r["resolveComponent"])("viInputNumber"),w=Object(r["resolveComponent"])("viInput"),I=Object(r["resolveComponent"])("van-field"),y=Object(r["resolveComponent"])("Button"),x=Object(r["resolveComponent"])("van-swipe-cell"),L=Object(r["resolveComponent"])("viPrint");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",c,[Object(r["createVNode"])(v,{fix:"",show:j.saveLoading},null,8,["show"]),j.curOrderId?(Object(r["openBlock"])(),Object(r["createBlock"])(U,{key:0,title:"订单编号",value:j.curOrderId,class:"flex-none"},{"right-icon":Object(r["withCtx"])(()=>[Object(r["createVNode"])(V,{type:"md-close",size:"25",onClick:g.deleteOrderId,class:"vi-link-text ml-10"},null,8,["onClick"])]),_:1},8,["value"])):Object(r["createCommentVNode"])("",!0),Object(r["createVNode"])(U,{title:"客户名称",value:g.curUser.name,onClick:t[0]||(t[0]=e=>j.showUserSelect=!0),"is-link":"",class:"user-select"},null,8,["value"]),Object(r["createVNode"])(C,{modelValue:j.showUserSelect,"onUpdate:modelValue":t[1]||(t[1]=e=>j.showUserSelect=e),userId:j.curUserId,"onUpdate:userId":t[2]||(t[2]=e=>j.curUserId=e),allUsers:j.allUsers},null,8,["modelValue","userId","allUsers"]),Object(r["createElementVNode"])("div",s,[j.goodList.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(N,{key:0})),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(j.goodList,(e,t)=>(Object(r["openBlock"])(),Object(r["createBlock"])(x,{key:t},{right:Object(r["withCtx"])(()=>[Object(r["createVNode"])(y,{type:"error",onClick:t=>g.changeCount(e,0)},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("删除")]),_:2},1032,["onClick"])]),default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",n,[Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("p",i,Object(r["toDisplayString"])(e.name),1),Object(r["createVNode"])(k,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>g.changeCount(e,t),class:"count-input"},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),Object(r["createElementVNode"])("div",d,[e.price!=e.originPrice&&e.unit==e.originUnit&&e.standard==e.originStandard?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:0,onClick:t=>e.price=e.originPrice,class:"origin"},[Object(r["createTextVNode"])("￥ "),Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(e.originPrice),1)],8,u)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",m,[b,Object(r["createVNode"])(k,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,min:0,step:.5,class:"count-input"},null,8,["modelValue","onUpdate:modelValue"]),h,Object(r["createVNode"])(w,{modelValue:e.unit,"onUpdate:modelValue":t=>e.unit=t,placeholder:"单位",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),Object(r["createVNode"])(w,{modelValue:e.standard,"onUpdate:modelValue":t=>e.standard=t,placeholder:"规格",class:"flex-1 ml-10"},null,8,["modelValue","onUpdate:modelValue"])])]),Object(r["createVNode"])(I,{modelValue:e.remarks,"onUpdate:modelValue":t=>e.remarks=t,label:"备注：","label-width":"50",clearable:"",placeholder:"备注，有就填"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),Object(r["createElementVNode"])("div",p,[Object(r["createElementVNode"])("p",f,"总计：￥"+Object(r["toDisplayString"])(j.totalPrice),1),Object(r["createElementVNode"])("div",O,[Object(r["createVNode"])(y,{type:"error",onClick:t[3]||(t[3]=e=>g.clearAll()),long:"",size:"large",shape:"circle"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("清空商品")]),_:1}),Object(r["createVNode"])(y,{onClick:t[4]||(t[4]=e=>g.saveOrder("1")),long:"",size:"large",shape:"circle"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("保存草稿")]),_:1}),Object(r["createVNode"])(L,{list:j.goodList,total:j.totalPrice,"user-data":g.curUser,size:"large",long:"",shape:"circle",onPrint:t[5]||(t[5]=e=>g.saveOrder("2"))},null,8,["list","total","user-data"])])])])}o("13d5"),o("3c65");var g=o("f23a"),v=o("e84a"),V=o("2af9"),U=o("f6f3"),C=o("eeb9"),N={name:"mobileCashier",components:{[g["a"].name]:g["a"],[v["a"].name]:v["a"],viPrint:V["i"],userSelect:U["a"]},data(){return{allUsers:[],curUserId:"",curOrderId:"",goodList:[],totalPrice:"0.00",saveLoading:!1,showUserSelect:!1}},watch:{goodList:{deep:!0,handler(e){this.totalPrice=(e.reduce((e,t)=>e+ +(t.count*t.price).toFixed(2),0)||0).toFixed(2),this.$EventBus.$emit("badge",{mobileCashier:e.reduce((e,t)=>e+ +t.count,0)}),sessionStorage.setItem("order",JSON.stringify(e))}},$route:{deep:!0,immediate:!0,handler({name:e}){if("mobileCashier"!==e)return;const{params:t={}}=history.state;Object.keys(t).length&&(this.goodList.length?this.$Modal.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{this.initData(t)}}):this.initData(t))}},curUserId(e){this.changeUser(e)}},computed:{curUser(){return this.allUsers.find(e=>e.userId==this.curUserId)||{}}},methods:{initData(e){this.curUserId=e.userId?+e.userId:"",this.curOrderId=e.orderId||"",this.$nextTick(()=>{this.goodList=JSON.parse(e.goodList||"[]").map(t=>("copy"===e.type&&(t.price=t.originPrice),t)),history.state.params={}})},deleteOrderId(){this.$Modal.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{this.curOrderId=""}})},clearAll(e){e?this.goodList=[]:this.$Modal.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{this.goodList=[]}})},changeCount(e,t){const o=[...this.goodList],r=o.findIndex(t=>t.goodId===e.goodId);t?(-1===r?o.unshift({...e}):o.splice(r,1,{...e}),this.goodList=o):-1!==r&&this.$Modal.confirm({title:"删除商品",content:`确认删除${e.name}?`,onOk:()=>{o.splice(r,1),this.goodList=o},onCancel:()=>{this.goodList[r]={...e,count:++t}}})},async saveOrder(e){if("1"==e&&!this.curUserId)return this.$Message.info("请填写客户名称");if("2"!=e||this.curUserId)try{this.saveLoading=!0;const{returnCode:t,data:o}=await Object(C["I"])({orderId:this.curOrderId||void 0,userId:this.curUserId,status:e,total:this.totalPrice,detail:JSON.stringify(this.goodList)})||{};0===t&&o&&(this.$Message.success("保存成功"),this.$EventBus.$emit("saveOrder"),this.clearAll(!0),this.curUserId="",this.curOrderId="",this.getUsersList())}catch(t){this.$Message.error("保存草稿失败："+(t.message||t))}finally{this.saveLoading=!1}},changeUser(){const{special:e={}}=this.curUser;this.goodList=this.goodList.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))},async getUsersList(){try{const{returnCode:e,data:t}=await Object(C["o"])()||{};0===e&&(this.allUsers=t&&t.map(e=>{const t={};return e.special.forEach(e=>{t[e.goodId]=+e.price}),e.special=t,e})||[])}catch(e){this.$Message.error("获取客户列表失败："+(e.message||e))}}},activated(){this.goodList=JSON.parse(sessionStorage.getItem("order")||"[]"),this.getUsersList()}},k=(o("1f29"),o("6b0d")),w=o.n(k);const I=w()(N,[["render",j],["__scopeId","data-v-3aad8323"]]);t["default"]=I},e84a:function(e,t,o){"use strict";o.d(t,"a",(function(){return j}));var r=o("23f9"),a=o("7a23"),c=o("1fba"),s=o("e5f6"),n=o("fa7c"),l=o("8db7"),i=o("5aa0"),d=o("9b55"),u=o("450f"),m=o("d7d5"),b=o("efd9");const[h,p]=Object(c["a"])("swipe-cell"),f={name:Object(s["c"])(""),disabled:Boolean,leftWidth:s["f"],rightWidth:s["f"],beforeClose:Function,stopPropagation:Boolean};var O=Object(a["defineComponent"])({name:h,props:f,emits:["open","close","click"],setup(e,{emit:t,slots:o}){let r,c,s,h;const f=Object(a["ref"])(),O=Object(a["ref"])(),j=Object(a["ref"])(),g=Object(a["reactive"])({offset:0,dragging:!1}),v=Object(m["a"])(),V=e=>e.value?Object(u["useRect"])(e).width:0,U=Object(a["computed"])(()=>Object(n["e"])(e.leftWidth)?+e.leftWidth:V(O)),C=Object(a["computed"])(()=>Object(n["e"])(e.rightWidth)?+e.rightWidth:V(j)),N=o=>{g.offset="left"===o?U.value:-C.value,r||(r=!0,t("open",{name:e.name,position:o}))},k=o=>{g.offset=0,r&&(r=!1,t("close",{name:e.name,position:o}))},w=e=>{const t=Math.abs(g.offset),o=.15,a=r?1-o:o,c="left"===e?U.value:C.value;c&&t>c*a?N(e):k(e)},I=t=>{e.disabled||(s=g.offset,v.start(t))},y=t=>{if(e.disabled)return;const{deltaX:o}=v;if(v.move(t),v.isHorizontal()){c=!0,g.dragging=!0;const a=!r||o.value*s<0;a&&Object(l["e"])(t,e.stopPropagation),g.offset=Object(i["d"])(o.value+s,-C.value,U.value)}},x=()=>{g.dragging&&(g.dragging=!1,w(g.offset>0?"left":"right"),setTimeout(()=>{c=!1},0))},L=(o="outside")=>{h||(t("click",o),r&&!c&&(h=!0,Object(d["a"])(e.beforeClose,{args:[{name:e.name,position:o}],done:()=>{h=!1,k(o)},canceled:()=>h=!1,error:()=>h=!1})))},E=(e,t)=>o=>{t&&o.stopPropagation(),L(e)},B=(e,t)=>{const r=o[e];if(r)return Object(a["createVNode"])("div",{ref:t,class:p(e),onClick:E(e,!0)},[r()])};return Object(b["a"])({open:N,close:k}),Object(u["useClickAway"])(f,()=>L("outside"),{eventName:"touchstart"}),Object(u["useEventListener"])("touchmove",y,{target:f}),()=>{var e;const t={transform:`translate3d(${g.offset}px, 0, 0)`,transitionDuration:g.dragging?"0s":".6s"};return Object(a["createVNode"])("div",{ref:f,class:p(),onClick:E("cell",c),onTouchstartPassive:I,onTouchend:x,onTouchcancel:x},[Object(a["createVNode"])("div",{class:p("wrapper"),style:t},[B("left",O),null==(e=o.default)?void 0:e.call(o),B("right",j)])])}}});const j=Object(r["a"])(O)},f095:function(e,t,o){"use strict";o("d384")},f6f3:function(e,t,o){"use strict";var r=o("7a23");const a={class:"flex-ac"},c={class:"user-list"};function s(e,t,o,s,n,l){const i=Object(r["resolveComponent"])("Spin"),d=Object(r["resolveComponent"])("van-field"),u=Object(r["resolveComponent"])("Icon"),m=Object(r["resolveComponent"])("viEmpty"),b=Object(r["resolveComponent"])("van-radio"),h=Object(r["resolveComponent"])("van-cell"),p=Object(r["resolveComponent"])("van-radio-group"),f=Object(r["resolveComponent"])("van-action-sheet");return Object(r["openBlock"])(),Object(r["createBlock"])(f,{show:l.showModal,"onUpdate:show":t[3]||(t[3]=e=>l.showModal=e),title:"选择客户"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(i,{fix:"",show:n.newUserLoading},null,8,["show"]),Object(r["createElementVNode"])("div",a,[Object(r["createVNode"])(d,{modelValue:n.newUserName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.newUserName=e),label:"没有？快速新增：","label-width":"120",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(r["createVNode"])(u,{type:"ios-checkmark-circle-outline",color:"green",size:"30",class:"mr-10",onClick:l.confirmAddUser},null,8,["onClick"])]),Object(r["createVNode"])(d,{modelValue:n.filterName,"onUpdate:modelValue":t[1]||(t[1]=e=>n.filterName=e),label:"过滤客户：","label-width":"80",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(r["createElementVNode"])("div",c,[Object(r["createVNode"])(p,{modelValue:l.curUserId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.curUserId=e)},{default:Object(r["withCtx"])(()=>[l.filterUsers.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(m,{key:0})),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(l.filterUsers,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(h,{key:e.userId,title:e.name,clickable:"",onClick:t=>l.selectUser(e)},{"right-icon":Object(r["withCtx"])(()=>[Object(r["createVNode"])(b,{name:e.userId},null,8,["name"])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["show"])}var n=o("f23a"),l=o("eeb9"),i={name:"userSelect",components:{[n["a"].name]:n["a"]},props:{modelValue:{type:Boolean,default:!1},allUsers:{type:Array,default(){return[]}},userId:{type:[Number,String],default:""}},data(){return{filterName:"",newUserName:"",newUserLoading:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},curUserId:{get(){return this.userId},set(e){this.$emit("update:userId",e)}},filterUsers(){return this.allUsers.filter(e=>!this.filterName||e.name.includes(this.filterName))}},methods:{selectUser(e){this.curUserId=e.userId,this.newUserName="",this.showModal=!1,this.$emit("change",e)},async confirmAddUser(){if(this.newUserName)try{this.newUserLoading=!0;const{data:e}=await Object(l["O"])({name:this.newUserName})||{};if(e)return this.$Message.success("名称已存在\n已选择"),void this.selectUser(e);const{data:t}=await Object(l["K"])({name:this.newUserName})||{};t&&(this.$Message.success("新增成功"),this.selectUser(t))}catch(e){this.$Message.error("新增客户失败："+(e.message||e))}finally{this.newUserLoading=!1}else this.$Message.info("请输入要新增的客户名称")}}},d=(o("f095"),o("6b0d")),u=o.n(d);const m=u()(i,[["render",s],["__scopeId","data-v-d2dc9874"]]);t["a"]=m}}]);