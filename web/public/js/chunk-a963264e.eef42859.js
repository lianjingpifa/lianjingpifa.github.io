(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a963264e"],{"1f38":function(e,t,o){"use strict";var a=o("7a23");function l(e,t,o,l,r,c){const n=Object(a["resolveComponent"])("viInput"),d=Object(a["resolveComponent"])("FormItem"),s=Object(a["resolveComponent"])("viInputNumber"),i=Object(a["resolveComponent"])("Option"),u=Object(a["resolveComponent"])("Select"),p=Object(a["resolveComponent"])("Form"),b=Object(a["resolveComponent"])("Button"),m=Object(a["resolveComponent"])("Modal");return Object(a["openBlock"])(),Object(a["createBlock"])(m,{title:c.title,modelValue:c.showModal,"onUpdate:modelValue":t[8]||(t[8]=e=>c.showModal=e),width:400,"class-name":"vertical-center-modal"},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{type:"text",onClick:t[7]||(t[7]=e=>c.showModal=!1)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("取消")]),_:1}),Object(a["createVNode"])(b,{type:"primary",onClick:c.submit,loading:r.loading},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("确定")]),_:1},8,["onClick","loading"])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{ref:"form",model:r.formData,rules:r.rules,"label-width":60,onKeydown:Object(a["withKeys"])(c.submit,["enter"]),class:"plr"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,{label:"名称:",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:r.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.formData.name=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(d,{label:"规格:",prop:"standard"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:r.formData.standard,"onUpdate:modelValue":t[1]||(t[1]=e=>r.formData.standard=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(d,{label:"单位:",prop:"unit"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:r.formData.unit,"onUpdate:modelValue":t[2]||(t[2]=e=>r.formData.unit=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(d,{label:"单价:",prop:"price"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{modelValue:r.formData.price,"onUpdate:modelValue":t[3]||(t[3]=e=>r.formData.price=e),min:0,step:.5},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(d,{label:"标签:",prop:"label"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{modelValue:r.formData.label,"onUpdate:modelValue":t[4]||(t[4]=e=>r.formData.label=e),multiple:""},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(r.dictMap.good,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:t,value:e.id},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(a["createVNode"])(d,{label:"仓库:",prop:"store"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{modelValue:r.formData.store,"onUpdate:modelValue":t[5]||(t[5]=e=>r.formData.store=e),multiple:""},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(r.dictMap.store,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:t,value:e.id},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.showCount?(Object(a["openBlock"])(),Object(a["createBlock"])(d,{key:0,label:"数量:",prop:"count"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{modelValue:r.formData.count,"onUpdate:modelValue":t[6]||(t[6]=e=>r.formData.count=e),integer:"",min:0},null,8,["modelValue"])]),_:1})):Object(a["createCommentVNode"])("",!0)]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["title","modelValue"])}o("d9e2");var r=o("eeb9"),c=o("2410"),n=o.n(c),d=o("4360");const s=Object(d["a"])();var i={name:"addGoodModal",props:{modelValue:{type:Boolean,default:!1},detailData:{type:Object,default(){return{}}},showCount:{type:Boolean,default:!1}},data(){const e=async(e,t,o)=>{if(t&&this.detailData.name!==this.formData.name){const{data:e}=await Object(r["I"])({name:t})||{};if(e)return o(new Error("该商品名称已存在"))}o()};return{dictMap:s.dictMap,formData:{},rules:{name:[{required:!0,message:"请输入商品名称"},{validator:e,trigger:"blur"}]},loading:!1}},computed:{title(){return(this.detailData.goodId?"编辑":"新增")+"商品"},showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}}},watch:{detailData:{deep:!0,handler(){this.$refs.form.resetFields(),this.formData=n()(this.detailData)}}},methods:{submit(){this.loading=!0,this.$refs.form.validate(async e=>{if(!e)return this.$Message.error("数据校验不通过"),void(this.loading=!1);try{const{_index:e,_rowKey:t,count:o,...a}=this.formData,{data:l}=await Object(r["C"])(a)||{};l&&(this.$Message.success(this.title+"成功"),this.$emit("save",{...this.formData}),this.$refs.form.resetFields(),this.showModal=!1)}catch(t){this.$Message.error("请求失败："+(t.message||t))}finally{this.loading=!1}})}}},u=o("6b0d"),p=o.n(u);const b=p()(i,[["render",l]]);t["a"]=b},"21b9":function(e,t,o){},2410:function(e,t,o){(function(t){var o=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var o,a,l;try{o=Map}catch(u){o=function(){}}try{a=Set}catch(u){a=function(){}}try{l=Promise}catch(u){l=function(){}}function r(c,n,d,s,u){"object"===typeof n&&(d=n.depth,s=n.prototype,u=n.includeNonEnumerable,n=n.circular);var p=[],b=[],m="undefined"!=typeof t;function h(c,d){if(null===c)return null;if(0===d)return c;var O,j;if("object"!=typeof c)return c;if(e(c,o))O=new o;else if(e(c,a))O=new a;else if(e(c,l))O=new l((function(e,t){c.then((function(t){e(h(t,d-1))}),(function(e){t(h(e,d-1))}))}));else if(r.__isArray(c))O=[];else if(r.__isRegExp(c))O=new RegExp(c.source,i(c)),c.lastIndex&&(O.lastIndex=c.lastIndex);else if(r.__isDate(c))O=new Date(c.getTime());else{if(m&&t.isBuffer(c))return O=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(O),O;e(c,Error)?O=Object.create(c):"undefined"==typeof s?(j=Object.getPrototypeOf(c),O=Object.create(j)):(O=Object.create(s),j=s)}if(n){var f=p.indexOf(c);if(-1!=f)return b[f];p.push(c),b.push(O)}for(var g in e(c,o)&&c.forEach((function(e,t){var o=h(t,d-1),a=h(e,d-1);O.set(o,a)})),e(c,a)&&c.forEach((function(e){var t=h(e,d-1);O.add(t)})),c){var V;j&&(V=Object.getOwnPropertyDescriptor(j,g)),V&&null==V.set||(O[g]=h(c[g],d-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(c);for(g=0;g<w.length;g++){var C=w[g],v=Object.getOwnPropertyDescriptor(c,C);(!v||v.enumerable||u)&&(O[C]=h(c[C],d-1),v.enumerable||Object.defineProperty(O,C,{enumerable:!1}))}}if(u){var x=Object.getOwnPropertyNames(c);for(g=0;g<x.length;g++){var y=x[g];v=Object.getOwnPropertyDescriptor(c,y);v&&v.enumerable||(O[y]=h(c[y],d-1),Object.defineProperty(O,y,{enumerable:!1}))}}return O}return"undefined"==typeof n&&(n=!0),"undefined"==typeof d&&(d=1/0),h(c,d)}function c(e){return Object.prototype.toString.call(e)}function n(e){return"object"===typeof e&&"[object Date]"===c(e)}function d(e){return"object"===typeof e&&"[object Array]"===c(e)}function s(e){return"object"===typeof e&&"[object RegExp]"===c(e)}function i(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return r.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},r.__objToStr=c,r.__isDate=n,r.__isArray=d,r.__isRegExp=s,r.__getRegExpFlags=i,r}();e.exports&&(e.exports=o)}).call(this,o("b639").Buffer)},"44c1":function(e,t,o){"use strict";o("21b9")},6746:function(e,t,o){"use strict";o.r(t);var a=o("7a23");const l=["onClick"],r=["onClick"],c=["onClick"];function n(e,t,o,n,d,s){const i=Object(a["resolveComponent"])("viInput"),u=Object(a["resolveComponent"])("FormItem"),p=Object(a["resolveComponent"])("Option"),b=Object(a["resolveComponent"])("Select"),m=Object(a["resolveComponent"])("Button"),h=Object(a["resolveComponent"])("viSearchForm"),O=Object(a["resolveComponent"])("viTablePage"),j=Object(a["resolveComponent"])("add-good-modal"),f=Object(a["resolveComponent"])("specialMngModal"),g=Object(a["resolveComponent"])("template-import-goods"),V=Object(a["resolveComponent"])("viLayoutUpDown");return Object(a["openBlock"])(),Object(a["createBlock"])(V,null,{up:Object(a["withCtx"])(()=>[Object(a["createVNode"])(h,{modelValue:d.searchData,"onUpdate:modelValue":t[6]||(t[6]=e=>d.searchData=e),onSearch:s.reSearch},{extral:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m,{type:"error",onClick:t[3]||(t[3]=e=>s.deleteData())},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("批量删除")]),_:1}),Object(a["createVNode"])(m,{type:"success",onClick:t[4]||(t[4]=e=>s.changeModal())},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("新增")]),_:1}),Object(a["createVNode"])(m,{onClick:s.exportData,loading:d.exportLoading},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("导出")]),_:1},8,["onClick","loading"]),Object(a["createVNode"])(m,{type:"primary",onClick:t[5]||(t[5]=e=>d.showImport=!0)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("批量导入")]),_:1})]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{label:"商品名称:",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:d.searchData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchData.name=e),class:"vi-width"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(u,{label:"商品标签:",prop:"label"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{modelValue:d.searchData.label,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchData.label=e),clearable:"",class:"vi-width"},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(d.dictMap.good,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(p,{key:t,value:e.id},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128)),Object(a["createVNode"])(p,{value:"其他"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue"])]),_:1}),Object(a["createVNode"])(u,{label:"商品仓库:",prop:"store"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{modelValue:d.searchData.store,"onUpdate:modelValue":t[2]||(t[2]=e=>d.searchData.store=e),clearable:"",class:"vi-width"},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(d.dictMap.store,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(p,{key:t,value:e.id},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128)),Object(a["createVNode"])(p,{value:"其他"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onSearch"])]),down:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,{ref:"table",columns:d.columns,getData:s.getData,addSelect:"",addIndex:"",onOnSelectionChange:t[7]||(t[7]=e=>d.selected=e),onOnSortChange:s.sortChange},{operate:Object(a["withCtx"])(({row:e})=>[Object(a["createElementVNode"])("a",{onClick:t=>s.openSpecialMng(e),class:"vi-green-pointer"},"特价",8,l),Object(a["createElementVNode"])("a",{onClick:t=>s.changeModal(e),class:"ml-10"},"修改",8,r),Object(a["createElementVNode"])("a",{onClick:t=>s.deleteData([e]),class:"ml-10 vi-red-pointer"},"删除",8,c)]),_:1},8,["columns","getData","onOnSortChange"]),Object(a["createVNode"])(j,{modelValue:d.showGoodModal,"onUpdate:modelValue":t[8]||(t[8]=e=>d.showGoodModal=e),detailData:d.detailData,onSave:s.reSearch},null,8,["modelValue","detailData","onSave"]),Object(a["createVNode"])(f,{modelValue:d.showSpecialModal,"onUpdate:modelValue":t[9]||(t[9]=e=>d.showSpecialModal=e),curRow:d.detailData},null,8,["modelValue","curRow"]),Object(a["createVNode"])(g,{modelValue:d.showImport,"onUpdate:modelValue":t[10]||(t[10]=e=>d.showImport=e),onSave:s.reSearch},null,8,["modelValue","onSave"])]),_:1})}var d=o("eeb9"),s=o("1f38"),i=o("e903");const u=e=>(Object(a["pushScopeId"])("data-v-4086cce6"),e=e(),Object(a["popScopeId"])(),e),p={class:"pt-20 pb-20"},b=u(()=>Object(a["createElementVNode"])("p",null,"点击或者拖拽文件上传",-1)),m={class:"mt-10"},h={class:"upload-msg",ref:"uploadMsg"},O={key:0};function j(e,t,o,l,r,c){const n=Object(a["resolveComponent"])("Icon"),d=Object(a["resolveComponent"])("Upload"),s=Object(a["resolveComponent"])("Checkbox"),i=Object(a["resolveComponent"])("Button"),u=Object(a["resolveComponent"])("Modal");return Object(a["openBlock"])(),Object(a["createBlock"])(u,{title:"批量导入商品",modelValue:c.showModal,"onUpdate:modelValue":t[2]||(t[2]=e=>c.showModal=e),width:500,draggable:"",sticky:"",scrollable:"",mask:!1},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{type:"text",onClick:t[1]||(t[1]=e=>c.showModal=!1)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("取消")]),_:1}),Object(a["createVNode"])(i,{type:"primary",onClick:c.exportTemplate},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("模板下载")]),_:1},8,["onClick"])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,{type:"drag",action:r.importGoods,headers:r.headers,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",format:["xlsx"],"show-upload-list":!1,"before-upload":c.beforeUpload,"on-success":c.onSuccess,"on-error":c.onError},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",p,[Object(a["createVNode"])(n,{type:"ios-cloud-upload",size:"52",style:{color:"#3399ff"}}),b])]),_:1},8,["action","headers","before-upload","on-success","on-error"]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",m,[Object(a["createElementVNode"])("p",null,[Object(a["createElementVNode"])("span",null,"导入文件名："+Object(a["toDisplayString"])(r.uploadName),1),Object(a["createVNode"])(s,{modelValue:r.showError,"onUpdate:modelValue":t[0]||(t[0]=e=>r.showError=e),class:"fr"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("只看错误信息")]),_:1},8,["modelValue"])]),Object(a["createElementVNode"])("div",h,[c.msgList.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",O,Object(a["toDisplayString"])(r.showError?"【无】":"【正在导入中】"),1)),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(c.msgList,(e,t)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{key:t},[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])({"vi-red-text":1==e.status,"vi-green-text":[0,2,10].includes(e.status)})},Object(a["toDisplayString"])(e.mes),3)]))),128))],512)],512),[[a["vShow"],r.uploadId]])]),_:1},8,["modelValue"])}var f=o("8451"),g=o("ec16"),V=(o("3c65"),{name:"templateImportGoods",components:{Upload:g["a"],Checkbox:f["a"]},props:{modelValue:{type:Boolean,default:!1}},data(){return{importGoods:d["w"],headers:{authorization:sessionStorage.getItem("authorization")},uploadId:"",uploadName:"",uploadMsg:[],showError:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}},msgList(){return this.uploadMsg.filter(e=>!this.showError||this.showError&&1==e.status)}},methods:{exportTemplate(){Object(d["j"])({goodIds:"下载模板"},`商品模板${(new Date).format("YYYYMMDDHHmmss")}.xlsx`)},beforeUpload(){return this.uploadId="",this.uploadName="",this.uploadMsg=[],!0},onSuccess(e,t){0==e.returnCode?(this.uploadName=t.name,e.data&&e.data.length?(this.uploadId=e.data[0].id,this.uploadMsg=e.data||[],this.$Message.success("导入成功"),this.$emit("save")):this.$Message.success("上传成功，开始导入")):this.$Message.error("上传失败："+e.returnMsg)},onError(e){this.$Message.error("上传失败："+(e.message||e))},batchImportGoods(e){if(0!==e.status||this.uploadId){if(e.id===this.uploadId){const t=this.uploadMsg.findIndex(t=>t.index<e.index);-1===t?this.uploadMsg.unshift(e):this.uploadMsg.splice(t,0,e),10==e.status&&this.$emit("save")}}else this.uploadId=e.id,this.uploadMsg=[e]}},mounted(){this.$EventBus.$on("batchImportGoods",this.batchImportGoods)},beforeMount(){this.$EventBus.$off("batchImportGoods",this.batchImportGoods)}}),w=(o("44c1"),o("6b0d")),C=o.n(w);const v=C()(V,[["render",j],["__scopeId","data-v-4086cce6"]]);var x=v,y=o("4360");const D=Object(y["a"])();var N={name:"goodMng",components:{addGoodModal:s["a"],specialMngModal:i["a"],templateImportGoods:x},data(){return{dictMap:D.dictMap,searchData:{},sortParams:{},showGoodModal:!1,detailData:{},columns:[{title:"名称",key:"name",minWidth:100},{title:"规格",key:"standard",width:100},{title:"单位",key:"unit",width:80},{title:"标签",minWidth:90,render:(e,{row:t})=>e("span",D.translate("good",t.label))},{title:"仓库",minWidth:90,render:(e,{row:t})=>e("span",D.translate("store",t.store))},{title:"单价",key:"price",width:80,sortable:"custom",render:(e,{row:t})=>e("span","￥"+t.price.toFixed(2))},{title:"修改时间",key:"updateTime",minWidth:90,sortable:"custom",sortType:"desc"},{title:"操作",slot:"operate",minWidth:100}],selected:[],showSpecialModal:!1,exportLoading:!1,showImport:!1}},methods:{reSearch(){var e;null===(e=this.$refs.table)||void 0===e||e.changePage(1)},sortChange({key:e,order:t}){this.sortParams="normal"===t?{}:{sortBy:e,order:t.toLocaleUpperCase()},this.reSearch()},getData(e){this.selected=[];const t={...e,...this.searchData,...this.sortParams};return Object(d["q"])(t)},changeModal(e){this.detailData={...e},this.showGoodModal=!0},openSpecialMng(e){this.detailData={...e},this.showSpecialModal=!0},deleteData(e=this.selected){if(!e.length)return this.$Message.info("至少选中一项");this.$Modal.confirm({title:"删除商品",content:"是否确认删除所选商品（将会删除该商品所有数据）？",onOk:async()=>{try{const{returnCode:t,data:o}=await Object(d["e"])({goodIds:e.map(e=>e.goodId).join()})||{};0===t&&o&&(this.$Message.success("删除成功"),this.$refs.table.changePage(1))}catch(t){this.$Message.error("删除失败："+(t.message||t))}}})},exportData(){this.exportLoading=!0,Object(d["j"])({...this.searchData,...this.sortParams,goodIds:this.selected.map(e=>e.goodId).join()},`商品${(new Date).format("YYYYMMDDHHmmss")}.xlsx`).finally(()=>{this.exportLoading=!1})}},activated(){this.reSearch()}};const k=C()(N,[["render",n]]);t["default"]=k}}]);