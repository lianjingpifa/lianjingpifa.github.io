(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f64d0220"],{"083a":function(e,t,o){"use strict";var a=o("0d51"),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+a(t)+" of "+a(e))}},"0d74":function(e,t,o){},"1f29":function(e,t,o){"use strict";o("db7f")},"21db":function(e,t,o){"use strict";o("0d74")},"3c65":function(e,t,o){"use strict";var a=o("23e7"),r=o("7b0b"),s=o("07fa"),c=o("3a34"),l=o("083a"),n=o("3511"),i=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},u=i||!d();a({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(e){var t=r(this),o=s(t),a=arguments.length;if(a){n(o+a);var i=o;while(i--){var d=i+a;i in t?t[d]=t[i]:l(t,d)}for(var u=0;u<a;u++)t[u]=arguments[u]}return c(t,o+a)}})},db7f:function(e,t,o){},df0a:function(e,t,o){"use strict";o.r(t);var a=o("7a23");const r=e=>(Object(a["pushScopeId"])("data-v-3aad8323"),e=e(),Object(a["popScopeId"])(),e),s={class:"container"},c={class:"list"},l={class:"card"},n={class:"card-top"},i={class:"title"},d={class:"card-middle"},u=["onClick"],m={class:"flex-ac"},b=r(()=>Object(a["createElementVNode"])("label",{class:"f-16 mr-5"},"￥",-1)),h=r(()=>Object(a["createElementVNode"])("label",{class:"f-16 ml-10 mr-10"}," / ",-1)),p={class:"bottom-box"},O={class:"total"},f={class:"btn-box"};function j(e,t,o,r,j,g){const v=Object(a["resolveComponent"])("Spin"),V=Object(a["resolveComponent"])("Icon"),U=Object(a["resolveComponent"])("van-cell"),C=Object(a["resolveComponent"])("userSelect"),N=Object(a["resolveComponent"])("viEmpty"),k=Object(a["resolveComponent"])("viInputNumber"),w=Object(a["resolveComponent"])("viInput"),I=Object(a["resolveComponent"])("van-field"),y=Object(a["resolveComponent"])("Button"),L=Object(a["resolveComponent"])("van-swipe-cell"),x=Object(a["resolveComponent"])("viPrint");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",s,[Object(a["createVNode"])(v,{fix:"",show:j.saveLoading},null,8,["show"]),j.curOrderId?(Object(a["openBlock"])(),Object(a["createBlock"])(U,{key:0,title:"订单编号",value:j.curOrderId,class:"flex-none"},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(V,{type:"md-close",size:"25",onClick:g.deleteOrderId,class:"vi-link-text ml-10"},null,8,["onClick"])]),_:1},8,["value"])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(U,{title:"客户名称",value:g.curUser.name,onClick:t[0]||(t[0]=e=>j.showUserSelect=!0),"is-link":"",class:"user-select"},null,8,["value"]),Object(a["createVNode"])(C,{modelValue:j.showUserSelect,"onUpdate:modelValue":t[1]||(t[1]=e=>j.showUserSelect=e),userId:j.curUserId,"onUpdate:userId":t[2]||(t[2]=e=>j.curUserId=e),allUsers:j.allUsers},null,8,["modelValue","userId","allUsers"]),Object(a["createElementVNode"])("div",c,[j.goodList.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(N,{key:0})),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(j.goodList,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(L,{key:t},{right:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{type:"error",onClick:t=>g.changeCount(e,0)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("删除")]),_:2},1032,["onClick"])]),default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",l,[Object(a["createElementVNode"])("div",n,[Object(a["createElementVNode"])("p",i,Object(a["toDisplayString"])(e.name),1),Object(a["createVNode"])(k,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>g.changeCount(e,t),class:"count-input"},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),Object(a["createElementVNode"])("div",d,[e.price!=e.originPrice&&e.unit==e.originUnit&&e.standard==e.originStandard?(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{key:0,onClick:t=>e.price=e.originPrice,class:"origin"},[Object(a["createTextVNode"])("￥ "),Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.originPrice),1)],8,u)):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",m,[b,Object(a["createVNode"])(k,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,min:0,step:.5,class:"count-input"},null,8,["modelValue","onUpdate:modelValue"]),h,Object(a["createVNode"])(w,{modelValue:e.unit,"onUpdate:modelValue":t=>e.unit=t,placeholder:"单位",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),Object(a["createVNode"])(w,{modelValue:e.standard,"onUpdate:modelValue":t=>e.standard=t,placeholder:"规格",class:"flex-1 ml-10"},null,8,["modelValue","onUpdate:modelValue"])])]),Object(a["createVNode"])(I,{modelValue:e.remarks,"onUpdate:modelValue":t=>e.remarks=t,label:"备注：","label-width":"50",clearable:"",placeholder:"备注，有就填"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),Object(a["createElementVNode"])("div",p,[Object(a["createElementVNode"])("p",O,"总计：￥"+Object(a["toDisplayString"])(j.totalPrice),1),Object(a["createElementVNode"])("div",f,[Object(a["createVNode"])(y,{type:"error",onClick:t[3]||(t[3]=e=>g.clearAll()),long:"",size:"large",shape:"circle"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("清空商品")]),_:1}),Object(a["createVNode"])(y,{onClick:t[4]||(t[4]=e=>g.saveOrder("1")),long:"",size:"large",shape:"circle"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("保存草稿")]),_:1}),Object(a["createVNode"])(x,{list:j.goodList,total:j.totalPrice,"user-data":g.curUser,size:"large",long:"",shape:"circle",onPrint:t[5]||(t[5]=e=>g.saveOrder("2"))},null,8,["list","total","user-data"])])])])}o("13d5"),o("3c65");var g=o("f23a"),v=o("e84a"),V=o("2af9");const U={class:"flex-ac"},C={class:"user-list"};function N(e,t,o,r,s,c){const l=Object(a["resolveComponent"])("Spin"),n=Object(a["resolveComponent"])("van-field"),i=Object(a["resolveComponent"])("Icon"),d=Object(a["resolveComponent"])("viEmpty"),u=Object(a["resolveComponent"])("van-radio"),m=Object(a["resolveComponent"])("van-cell"),b=Object(a["resolveComponent"])("van-radio-group"),h=Object(a["resolveComponent"])("van-action-sheet");return Object(a["openBlock"])(),Object(a["createBlock"])(h,{show:c.showModal,"onUpdate:show":t[3]||(t[3]=e=>c.showModal=e),title:"选择客户"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{fix:"",show:s.newUserLoading},null,8,["show"]),Object(a["createElementVNode"])("div",U,[Object(a["createVNode"])(n,{modelValue:s.newUserName,"onUpdate:modelValue":t[0]||(t[0]=e=>s.newUserName=e),label:"没有？快速新增：","label-width":"120",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(a["createVNode"])(i,{type:"ios-checkmark-circle-outline",color:"green",size:"30",class:"mr-10",onClick:c.confirmAddUser},null,8,["onClick"])]),Object(a["createVNode"])(n,{modelValue:s.filterName,"onUpdate:modelValue":t[1]||(t[1]=e=>s.filterName=e),label:"过滤客户：","label-width":"80",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(a["createElementVNode"])("div",C,[Object(a["createVNode"])(b,{modelValue:c.curUserId,"onUpdate:modelValue":t[2]||(t[2]=e=>c.curUserId=e)},{default:Object(a["withCtx"])(()=>[c.filterUsers.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(d,{key:0})),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(c.filterUsers,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(m,{key:e.userId,title:`${e.name}${e.remarks?`（${e.remarks}）`:""}`,clickable:"",onClick:t=>c.selectUser(e)},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{name:e.userId},null,8,["name"])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["show"])}var k=o("eeb9"),w={name:"userSelect",components:{[g["a"].name]:g["a"]},props:{modelValue:{type:Boolean,default:!1},allUsers:{type:Array,default(){return[]}},userId:{type:[Number,String],default:""}},data(){return{filterName:"",newUserName:"",newUserLoading:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},curUserId:{get(){return this.userId},set(e){this.$emit("update:userId",e)}},filterUsers(){return this.allUsers.filter(e=>!this.filterName||e.name.includes(this.filterName))}},methods:{selectUser(e){this.curUserId=e.userId,this.newUserName="",this.showModal=!1},async confirmAddUser(){if(this.newUserName)try{this.newUserLoading=!0;const{data:e}=await Object(k["J"])({name:this.newUserName})||{};if(e)return this.$Message.success("名称已存在\n已选择"),void this.selectUser(e);const{data:t}=await Object(k["F"])({name:this.newUserName})||{};t&&(this.$Message.success("新增成功"),this.selectUser(t))}catch(e){this.$Message.error("新增客户失败："+(e.message||e))}finally{this.newUserLoading=!1}else this.$Message.info("请输入要新增的客户名称")}}},I=(o("21db"),o("6b0d")),y=o.n(I);const L=y()(w,[["render",N],["__scopeId","data-v-0171d196"]]);var x=L,B={name:"mobileCashier",components:{[g["a"].name]:g["a"],[v["a"].name]:v["a"],viPrint:V["i"],userSelect:x},data(){return{allUsers:[],curUserId:"",curOrderId:"",goodList:[],totalPrice:"0.00",saveLoading:!1,showUserSelect:!1}},watch:{goodList:{deep:!0,handler(e){this.totalPrice=(e.reduce((e,t)=>e+ +(t.count*t.price).toFixed(2),0)||0).toFixed(2),this.$EventBus.$emit("badge",{mobileCashier:e.reduce((e,t)=>e+ +t.count,0)}),sessionStorage.setItem("order",JSON.stringify(e))}},$route:{deep:!0,immediate:!0,handler({name:e}){if("mobileCashier"!==e)return;const{params:t={}}=history.state;Object.keys(t).length&&(this.goodList.length?this.$Modal.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{this.initData(t)}}):this.initData(t))}},curUserId(e){this.changeUser(e)}},computed:{curUser(){return this.allUsers.find(e=>e.userId==this.curUserId)||{}}},methods:{initData(e){this.curUserId=e.userId?+e.userId:"",this.curOrderId=e.orderId||"",this.$nextTick(()=>{this.goodList=JSON.parse(e.goodList||"[]").map(t=>("copy"===e.type&&(t.price=t.originPrice),t)),history.state.params={}})},deleteOrderId(){this.$Modal.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{this.curOrderId=""}})},clearAll(e){e?this.goodList=[]:this.$Modal.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{this.goodList=[]}})},changeCount(e,t){const o=[...this.goodList],a=o.findIndex(t=>t.goodId===e.goodId);t?(-1===a?o.unshift({...e}):o.splice(a,1,{...e}),this.goodList=o):-1!==a&&this.$Modal.confirm({title:"删除商品",content:`确认删除${e.name}?`,onOk:()=>{o.splice(a,1),this.goodList=o},onCancel:()=>{this.goodList[a]={...e,count:++t}}})},async saveOrder(e){if("1"==e&&!this.curUserId)return this.$Message.info("请填写客户名称");if("2"!=e||this.curUserId)try{this.saveLoading=!0;const{returnCode:t,data:o}=await Object(k["D"])({orderId:this.curOrderId||void 0,userId:this.curUserId,status:e,total:this.totalPrice,detail:JSON.stringify(this.goodList)})||{};0===t&&o&&(this.$Message.success("保存成功"),this.$EventBus.$emit("saveOrder"),this.clearAll(!0),this.curUserId="",this.curOrderId="",this.getUsersList())}catch(t){this.$Message.error("保存草稿失败："+(t.message||t))}finally{this.saveLoading=!1}},changeUser(){const{special:e={}}=this.curUser;this.goodList=this.goodList.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))},async getUsersList(){try{const{returnCode:e,data:t}=await Object(k["n"])()||{};0===e&&(this.allUsers=t&&t.map(e=>{const t={};return e.special.forEach(e=>{t[e.goodId]=+e.price}),e.special=t,e})||[])}catch(e){this.$Message.error("获取客户列表失败："+(e.message||e))}}},activated(){this.goodList=JSON.parse(sessionStorage.getItem("order")||"[]"),this.getUsersList()}};o("1f29");const E=y()(B,[["render",j],["__scopeId","data-v-3aad8323"]]);t["default"]=E},e84a:function(e,t,o){"use strict";o.d(t,"a",(function(){return j}));var a=o("23f9"),r=o("7a23"),s=o("1fba"),c=o("e5f6"),l=o("fa7c"),n=o("8db7"),i=o("5aa0"),d=o("9b55"),u=o("450f"),m=o("d7d5"),b=o("efd9");const[h,p]=Object(s["a"])("swipe-cell"),O={name:Object(c["c"])(""),disabled:Boolean,leftWidth:c["f"],rightWidth:c["f"],beforeClose:Function,stopPropagation:Boolean};var f=Object(r["defineComponent"])({name:h,props:O,emits:["open","close","click"],setup(e,{emit:t,slots:o}){let a,s,c,h;const O=Object(r["ref"])(),f=Object(r["ref"])(),j=Object(r["ref"])(),g=Object(r["reactive"])({offset:0,dragging:!1}),v=Object(m["a"])(),V=e=>e.value?Object(u["useRect"])(e).width:0,U=Object(r["computed"])(()=>Object(l["e"])(e.leftWidth)?+e.leftWidth:V(f)),C=Object(r["computed"])(()=>Object(l["e"])(e.rightWidth)?+e.rightWidth:V(j)),N=o=>{g.offset="left"===o?U.value:-C.value,a||(a=!0,t("open",{name:e.name,position:o}))},k=o=>{g.offset=0,a&&(a=!1,t("close",{name:e.name,position:o}))},w=e=>{const t=Math.abs(g.offset),o=.15,r=a?1-o:o,s="left"===e?U.value:C.value;s&&t>s*r?N(e):k(e)},I=t=>{e.disabled||(c=g.offset,v.start(t))},y=t=>{if(e.disabled)return;const{deltaX:o}=v;if(v.move(t),v.isHorizontal()){s=!0,g.dragging=!0;const r=!a||o.value*c<0;r&&Object(n["e"])(t,e.stopPropagation),g.offset=Object(i["d"])(o.value+c,-C.value,U.value)}},L=()=>{g.dragging&&(g.dragging=!1,w(g.offset>0?"left":"right"),setTimeout(()=>{s=!1},0))},x=(o="outside")=>{h||(t("click",o),a&&!s&&(h=!0,Object(d["a"])(e.beforeClose,{args:[{name:e.name,position:o}],done:()=>{h=!1,k(o)},canceled:()=>h=!1,error:()=>h=!1})))},B=(e,t)=>o=>{t&&o.stopPropagation(),x(e)},E=(e,t)=>{const a=o[e];if(a)return Object(r["createVNode"])("div",{ref:t,class:p(e),onClick:B(e,!0)},[a()])};return Object(b["a"])({open:N,close:k}),Object(u["useClickAway"])(O,()=>x("outside"),{eventName:"touchstart"}),Object(u["useEventListener"])("touchmove",y,{target:O}),()=>{var e;const t={transform:`translate3d(${g.offset}px, 0, 0)`,transitionDuration:g.dragging?"0s":".6s"};return Object(r["createVNode"])("div",{ref:O,class:p(),onClick:B("cell",s),onTouchstartPassive:I,onTouchend:L,onTouchcancel:L},[Object(r["createVNode"])("div",{class:p("wrapper"),style:t},[E("left",f),null==(e=o.default)?void 0:e.call(o),E("right",j)])])}}});const j=Object(a["a"])(f)}}]);