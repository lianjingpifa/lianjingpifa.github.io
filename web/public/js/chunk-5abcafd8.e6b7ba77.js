(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5abcafd8"],{"108c":function(e,t,a){"use strict";a("8bef")},2410:function(e,t,a){(function(t){var a=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var a,o,n;try{a=Map}catch(u){a=function(){}}try{o=Set}catch(u){o=function(){}}try{n=Promise}catch(u){n=function(){}}function r(i,s,c,l,u){"object"===typeof s&&(c=s.depth,l=s.prototype,u=s.includeNonEnumerable,s=s.circular);var b=[],p=[],h="undefined"!=typeof t;function O(i,c){if(null===i)return null;if(0===c)return i;var f,m;if("object"!=typeof i)return i;if(e(i,a))f=new a;else if(e(i,o))f=new o;else if(e(i,n))f=new n((function(e,t){i.then((function(t){e(O(t,c-1))}),(function(e){t(O(e,c-1))}))}));else if(r.__isArray(i))f=[];else if(r.__isRegExp(i))f=new RegExp(i.source,d(i)),i.lastIndex&&(f.lastIndex=i.lastIndex);else if(r.__isDate(i))f=new Date(i.getTime());else{if(h&&t.isBuffer(i))return f=t.allocUnsafe?t.allocUnsafe(i.length):new t(i.length),i.copy(f),f;e(i,Error)?f=Object.create(i):"undefined"==typeof l?(m=Object.getPrototypeOf(i),f=Object.create(m)):(f=Object.create(l),m=l)}if(s){var g=b.indexOf(i);if(-1!=g)return p[g];b.push(i),p.push(f)}for(var j in e(i,a)&&i.forEach((function(e,t){var a=O(t,c-1),o=O(e,c-1);f.set(a,o)})),e(i,o)&&i.forEach((function(e){var t=O(e,c-1);f.add(t)})),i){var y;m&&(y=Object.getOwnPropertyDescriptor(m,j)),y&&null==y.set||(f[j]=O(i[j],c-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(i);for(j=0;j<w.length;j++){var x=w[j],D=Object.getOwnPropertyDescriptor(i,x);(!D||D.enumerable||u)&&(f[x]=O(i[x],c-1),D.enumerable||Object.defineProperty(f,x,{enumerable:!1}))}}if(u){var v=Object.getOwnPropertyNames(i);for(j=0;j<v.length;j++){var V=v[j];D=Object.getOwnPropertyDescriptor(i,V);D&&D.enumerable||(f[V]=O(i[V],c-1),Object.defineProperty(f,V,{enumerable:!1}))}}return f}return"undefined"==typeof s&&(s=!0),"undefined"==typeof c&&(c=1/0),O(i,c)}function i(e){return Object.prototype.toString.call(e)}function s(e){return"object"===typeof e&&"[object Date]"===i(e)}function c(e){return"object"===typeof e&&"[object Array]"===i(e)}function l(e){return"object"===typeof e&&"[object RegExp]"===i(e)}function d(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return r.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},r.__objToStr=i,r.__isDate=s,r.__isArray=c,r.__isRegExp=l,r.__getRegExpFlags=d,r}();e.exports&&(e.exports=a)}).call(this,a("b639").Buffer)},"267e":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return n}));const o={1:"整件",99:"散装"},n=e=>"99"==e.type},6504:function(e,t,a){"use strict";a.r(t);var o=a("7a23");const n=e=>(Object(o["pushScopeId"])("data-v-1eb5409e"),e=e(),Object(o["popScopeId"])(),e),r={class:"chart-box"},i={class:"chart-header"},s=n(()=>Object(o["createElementVNode"])("p",{class:"title"},[Object(o["createTextVNode"])("商品销量排行榜"),Object(o["createElementVNode"])("span",{class:"tip"},"（点击柱子进行趋势分析）")],-1)),c=n(()=>Object(o["createElementVNode"])("span",null,"排行范围：",-1)),l={class:"chart-box"},d={class:"chart-header"},u=n(()=>Object(o["createElementVNode"])("p",{class:"title"},"商品销量趋势分析",-1)),b={class:"flex-none"};function p(e,t,a,n,p,h){const O=Object(o["resolveComponent"])("Option"),f=Object(o["resolveComponent"])("Select"),m=Object(o["resolveComponent"])("FormItem"),g=Object(o["resolveComponent"])("DatePicker"),j=Object(o["resolveComponent"])("viSearchForm"),y=Object(o["resolveComponent"])("Spin"),w=Object(o["resolveComponent"])("Radio"),x=Object(o["resolveComponent"])("RadioGroup"),D=Object(o["resolveComponent"])("viChart"),v=Object(o["resolveComponent"])("Icon"),V=Object(o["resolveComponent"])("Button"),I=Object(o["resolveComponent"])("viLayoutUpDown");return Object(o["openBlock"])(),Object(o["createBlock"])(I,null,{up:Object(o["withCtx"])(()=>[Object(o["createVNode"])(j,{modelValue:p.searchData,"onUpdate:modelValue":t[3]||(t[3]=e=>p.searchData=e),onSearch:h.getSalesTop},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(m,{label:"商品范围:",prop:"goodIds"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(f,{modelValue:p.searchData.goodIds,"onUpdate:modelValue":t[0]||(t[0]=e=>p.searchData.goodIds=e),filterable:"",multiple:"",placeholder:"全部",class:"stat-width"},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(p.allGoods,e=>(Object(o["openBlock"])(),Object(o["createBlock"])(O,{key:e.goodId,value:e.goodId},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(o["createVNode"])(m,{label:"客户范围:",prop:"userIds"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(f,{modelValue:p.searchData.userIds,"onUpdate:modelValue":t[1]||(t[1]=e=>p.searchData.userIds=e),filterable:"",multiple:"",placeholder:"全部",class:"stat-width"},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(p.allUsers,e=>(Object(o["openBlock"])(),Object(o["createBlock"])(O,{key:e.userId,value:e.userId},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(o["createVNode"])(m,{label:"时间范围:",prop:"timeRange"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(g,{modelValue:p.searchData.timeRange,"onUpdate:modelValue":t[2]||(t[2]=e=>p.searchData.timeRange=e),type:"daterange",options:p.options,placeholder:"请选择",class:"vi-width"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["modelValue","onSearch"])]),down:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",r,[Object(o["createVNode"])(y,{fix:"",show:p.barLoading},null,8,["show"]),Object(o["createElementVNode"])("div",i,[s,Object(o["createElementVNode"])("div",null,[c,Object(o["createVNode"])(x,{modelValue:p.barType,"onUpdate:modelValue":t[4]||(t[4]=e=>p.barType=e),onOnChange:h.getSalesTop},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(w,{label:""},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("全部")]),_:1}),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(p.TYPE_MAP,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])(w,{key:t,label:t},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e),1)]),_:2},1032,["label"]))),128)),Object(o["createVNode"])(w,{label:"其他"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue","onOnChange"]),Object(o["createVNode"])(f,{modelValue:p.barSort,"onUpdate:modelValue":t[5]||(t[5]=e=>p.barSort=e),clearable:!1,transfer:"",onOnChange:h.drawBar,class:"vi-width"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(O,{value:"desc"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("倒序")]),_:1}),Object(o["createVNode"])(O,{value:"asc"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("升序")]),_:1})]),_:1},8,["modelValue","onOnChange"])])]),Object(o["createVNode"])(D,{options:p.barOption,onOnMount:h.addBarInteraction,class:"chart-content"},null,8,["options","onOnMount"])]),Object(o["createElementVNode"])("div",l,[Object(o["createVNode"])(y,{fix:"",show:p.lineLoading},null,8,["show"]),Object(o["createElementVNode"])("div",d,[u,Object(o["createElementVNode"])("p",{class:"line-legend",ref:"list",onWheel:t[6]||(t[6]=t=>e.$refs.list.scrollLeft+=t.deltaY)},[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(p.lineData,(e,t)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:t},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.userId?p.userMap[e.userId]+"-":"")+Object(o["toDisplayString"])(p.goodMap[e.goodId])+" ",1),Object(o["createVNode"])(v,{type:"md-close",size:"16",onClick:e=>{p.lineData.splice(t,1),h.drawLine()},class:"vi-link-pointer mr-5"},null,8,["onClick"])]))),128))],544),Object(o["createElementVNode"])("div",b,[Object(o["createVNode"])(V,{class:"mr-15",onClick:t[7]||(t[7]=e=>h.getSalesTrend(p.barData.map(({data:e})=>e[0])))},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("重置")]),_:1}),Object(o["createVNode"])(x,{modelValue:p.lineType,"onUpdate:modelValue":t[8]||(t[8]=e=>p.lineType=e),type:"button","button-style":"solid",onOnChange:t[9]||(t[9]=e=>h.getSalesTrend(p.lineData))},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(w,{label:"month"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("按月")]),_:1}),Object(o["createVNode"])(w,{label:"day"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("按天")]),_:1})]),_:1},8,["modelValue"])])]),Object(o["createVNode"])(D,{options:p.lineOption,class:"chart-content"},null,8,["options"])])]),_:1})}var h=a("8738"),O=(a("14d9"),a("2af9")),f=a("eeb9"),m=a("267e");const g={grid:{bottom:15,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[],axisLabel:{rotate:10,fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"bar",name:"销售总量",barMaxWidth:30,barMinWidth:20,label:{show:!0,position:"top"}}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]},j={grid:{bottom:20,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"},position:(e,t,a,o,n)=>{let r={top:e[1]-n.contentSize[1]/2};return e[0]+n.contentSize[0]+20<n.viewSize[0]?r.left=e[0]+20:r.left=e[0]-n.contentSize[0]-20,r}},xAxis:{type:"category",data:[],axisLabel:{fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"line",name:"销售总量",symbol:"circle",symbolSize:10,smooth:!0}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]};var y=a("2410"),w=a.n(y),x={name:"statisticsAnalysis",components:{DatePicker:h["a"],viChart:O["b"]},data(){return{TYPE_MAP:m["b"],allGoods:[],goodMap:{},allUsers:[],userMap:{},searchData:{goodIds:[],userIds:[],timeRange:[]},options:{shortcuts:[{text:"本周",value:()=>[(new Date).startOf("week"),new Date]},{text:"近7天",value:()=>[(new Date).subtract(7),new Date]},{text:"本月",value:()=>[(new Date).startOf("month"),new Date]},{text:"近30天",value:()=>[(new Date).subtract(30),new Date]},{text:"近90天",value:()=>[(new Date).subtract(90),new Date]},{text:"今年",value:()=>[(new Date).startOf("year"),new Date]},{text:"近一年",value:()=>[(new Date).subtract(365),new Date]},{text:"近三年",value:()=>[(new Date).subtract(1095),new Date]}]},barOption:{},barType:"1",barSort:"desc",barData:[],barLoading:!1,lineOption:{},lineType:"month",lineData:[],lineLoading:!1}},methods:{getParams(){const[e,t]=this.searchData.timeRange;return{goodIds:this.searchData.goodIds.join(),userIds:this.searchData.userIds.join(),startTime:e&&new Date(e).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:t&&new Date(t).endOf("day").format("YYYY-MM-DD HH:mm:ss")}},async getSalesTop(){try{this.barLoading=!0,this.lineLoading=!0;const e=this.getParams(),{returnCode:t,data:a}=await Object(f["n"])({...e,type:this.barType})||{};if(0===t){this.barData=a||[],this.drawBar();const e=this.barData.map(({data:e})=>e[0]);this.getSalesTrend(e)}}catch(e){this.$Message.error("获取商品排行榜失败："+(e.message||e))}finally{this.barLoading=!1}},drawBar(){if(!this.barData.length)return void(this.barOption={});const e=w()(g);e.legend.data=this.barData.map(e=>this.userMap[e.userId]||"销售总量"),e.xAxis.data=this.barData[0].data.map(e=>this.goodMap[e.goodId]),e.series=this.barData.map(t=>{const a=t.data.map(e=>({userId:t.userId,goodId:e.goodId,value:+(e.count||0)}));return"asc"===this.barSort&&a.reverse(),{...e.series[0],name:this.userMap[t.userId]||"销售总量",data:a}}),this.barData[0].data.length<10&&(e.dataZoom=[],e.xAxis.axisLabel.rotate=0),this.barOption=e},addBarInteraction(e){e.on("click",e=>{const{goodId:t,userId:a}=e.data,o=this.lineData.findIndex(e=>e.goodId==t&&e.userId==a);-1===o?this.getSalesTrend([{goodId:t,userId:a}],!1):(this.lineData.splice(o,1),this.drawLine())})},async getSalesTrend(e=[],t=!0){try{this.lineLoading=!0;const{startTime:n,endTime:r}=this.getParams(),{returnCode:i,data:s}=await Object(f["o"])({startTime:n,endTime:r,lineType:this.lineType,list:e.filter(e=>e)})||{};if(0===i){const e="month"==this.lineType?"YYYY-MM":"YYYY-MM-DD";let n=(new Date).format(e),r=new Date(0).format(e);for(let t of s){var a,o;const e=(null===(a=t.data[0])||void 0===a?void 0:a.date)||n,i=(null===(o=t.data[t.data.length-1])||void 0===o?void 0:o.date)||n;e>r&&(r=e),i<n&&(n=i)}const i=[];for(let t=r,a=0;t>=n;a++)i.push(t),t="day"===this.lineType?new Date(t).subtract(1,"days").format("YYYY-MM-DD"):new Date(t).subtract(1,"months").format("YYYY-MM");s.forEach(e=>{e.data=i.map(t=>{const a=e.data.find(e=>e.date===t);return{date:t,count:a?+a.count:0}})}),this.lineData=t?s||[]:this.lineData.concat(s||[]),this.drawLine()}}catch(n){this.$Message.error("获取商品销量趋势失败："+(n.message||n))}finally{this.lineLoading=!1}},drawLine(){if(!this.lineData.length)return void(this.lineOption={});const e=w()(j);e.legend.data=this.lineData.map(({userId:e,goodId:t})=>`${e?this.userMap[e]+"-":""}${this.goodMap[t]}`),e.xAxis.data=this.lineData[0].data.map(e=>e.date),e.series=this.lineData.map(({userId:t,goodId:a,data:o})=>({...e.series[0],name:`${t?this.userMap[t]+"-":""}${this.goodMap[a]}`,data:o.map(e=>({...e,value:+(e.count||0)}))})),this.lineData[0].data.length<10&&(e.dataZoom=[]),this.lineOption=e},async getGoodsList(){try{const{returnCode:e,data:t}=await Object(f["g"])()||{};if(0===e){this.allGoods=t||[];const e={};this.allGoods.forEach(t=>{e[t.goodId]=t.name}),this.goodMap=e}}catch(e){this.$Message.error("获取商品字典失败："+(e.message||e))}},async getUsersList(){try{const{returnCode:e,data:t}=await Object(f["h"])()||{};if(0===e){this.allUsers=t||[];const e={};this.allUsers.forEach(t=>{e[t.userId]=t.name}),this.userMap=e}}catch(e){this.$Message.error("获取客户列表失败："+(e.message||e))}}},mounted(){this.getSalesTop()},created(){this.getGoodsList(),this.getUsersList()}},D=(a("108c"),a("6b0d")),v=a.n(D);const V=v()(x,[["render",p],["__scopeId","data-v-1eb5409e"]]);t["default"]=V},"8bef":function(e,t,a){}}]);
//# sourceMappingURL=chunk-5abcafd8.e6b7ba77.js.map