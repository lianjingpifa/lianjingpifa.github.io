(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72ad6e07","chunk-96a3b086"],{"0cc1":function(e,t,a){},"2b40":function(e,t,a){"use strict";a("0cc1")},"2da3":function(e,t,a){},"2ff0":function(e,t,a){"use strict";a("4aae")},"342e":function(e,t,a){"use strict";a("2da3")},"4aae":function(e,t,a){},"5d2e":function(e,t,a){},"7e0a":function(e,t,a){"use strict";a.r(t);var o=a("7a23");const l=["onClick"],c=["onClick"],r=["onClick"];function s(e,t,a,s,n,d){const i=Object(o["resolveComponent"])("viInput"),p=Object(o["resolveComponent"])("FormItem"),u=Object(o["resolveComponent"])("Option"),m=Object(o["resolveComponent"])("Select"),h=Object(o["resolveComponent"])("DatePicker"),b=Object(o["resolveComponent"])("Button"),O=Object(o["resolveComponent"])("viSearchForm"),j=Object(o["resolveComponent"])("viTablePage"),w=Object(o["resolveComponent"])("viPrintContent"),V=Object(o["resolveComponent"])("Modal"),g=Object(o["resolveComponent"])("viLayoutUpDown");return Object(o["openBlock"])(),Object(o["createBlock"])(g,null,{up:Object(o["withCtx"])(()=>[Object(o["createVNode"])(O,{modelValue:n.searchData,"onUpdate:modelValue":t[5]||(t[5]=e=>n.searchData=e),onSearch:d.reSearch},{extral:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{type:"error",onClick:t[4]||(t[4]=e=>d.deleteData()),class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("批量删除")]),_:1})]),default:Object(o["withCtx"])(()=>[a.curRow.userId?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createBlock"])(p,{key:0,label:"客户名称:",prop:"userName"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{modelValue:n.searchData.userName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.searchData.userName=e),class:"vi-width"},null,8,["modelValue"])]),_:1})),Object(o["createVNode"])(p,{label:"订单状态:",prop:"status"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(m,{modelValue:n.searchData.status,"onUpdate:modelValue":t[1]||(t[1]=e=>n.searchData.status=e),clearable:"",class:"vi-width"},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(n.statusMap,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])(u,{value:e,key:t},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(o["createVNode"])(p,{label:"修改时间:",prop:"updateTime"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(h,{modelValue:n.searchData.updateTime,"onUpdate:modelValue":t[2]||(t[2]=e=>n.searchData.updateTime=e),type:"daterange",options:n.options,placeholder:"请选择",class:"vi-width"},null,8,["modelValue","options"])]),_:1}),Object(o["createVNode"])(p,{label:"创建时间:",prop:"createTime"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(h,{modelValue:n.searchData.createTime,"onUpdate:modelValue":t[3]||(t[3]=e=>n.searchData.createTime=e),type:"daterange",options:n.options,placeholder:"请选择",class:"vi-width"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["modelValue","onSearch"])]),down:Object(o["withCtx"])(()=>[Object(o["createVNode"])(j,{ref:"table",columns:d.columns,getData:d.getData,addSelect:"",addIndex:"",onOnSelectionChange:t[6]||(t[6]=e=>n.selected=e)},{operate:Object(o["withCtx"])(({row:e})=>[Object(o["createElementVNode"])("a",{onClick:t=>d.changeOrder(e)},"修改",8,l),Object(o["createElementVNode"])("a",{onClick:t=>d.deleteData([e]),class:"ml-10 vi-red-pointer"},"删除",8,c),Object(o["createElementVNode"])("a",{onClick:t=>d.copyOrder(e),class:"ml-10 vi-green-pointer"},"一键复制",8,r)]),_:1},8,["columns","getData"]),Object(o["createVNode"])(V,{title:"订单详情",modelValue:n.showDetail,"onUpdate:modelValue":t[11]||(t[11]=e=>n.showDetail=e),width:880,"class-name":"vertical-center-modal"},{footer:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{onClick:t[7]||(t[7]=e=>n.showDetail=!1)},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("取消")]),_:1}),Object(o["createVNode"])(b,{type:"primary",onClick:t[8]||(t[8]=e=>d.changeOrder(n.detailData))},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("去修改")]),_:1}),Object(o["createVNode"])(b,{type:"primary",onClick:t[9]||(t[9]=e=>d.copyOrder(n.detailData))},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("一键复制")]),_:1}),Object(o["createVNode"])(b,{type:"error",onClick:t[10]||(t[10]=e=>d.deleteData([n.detailData]))},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("删除")]),_:1})]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(w,{list:n.detailData.list,total:n.detailData.total,class:"order-detail"},null,8,["list","total"])]),_:1},8,["modelValue"])]),_:1})}var n=a("8738"),d=(a("14d9"),a("eeb9")),i=a("2af9"),p={name:"orderMng",components:{DatePicker:n["a"],viPrintContent:i["j"]},props:{curRow:{type:Object,default(){return{}}}},data(){return{searchData:{},statusMap:{1:"草稿",2:"已打印"},selected:[],options:{shortcuts:[{text:"今天",value:()=>[new Date,new Date]},{text:"近2天",value:()=>[(new Date).subtract(1),new Date]},{text:"近3天",value:()=>[(new Date).subtract(2),new Date]},{text:"近一周",value:()=>[(new Date).subtract(7),new Date]}]},showDetail:!1,detailData:{}}},computed:{columns(){return[{title:"订单编号",align:"center",width:180,render:(e,{row:t})=>e("span",{class:"vi-link-pointer",onClick:()=>{this.detailData={...t,list:JSON.parse(t.detail||"[]"),total:t.total.toFixed(2)},this.showDetail=!0}},t.orderId)},...this.curRow.userId?[]:[{title:"客户名称",key:"userName",align:"center",minWidth:200}],{title:"订单状态",align:"center",width:100,render:(e,{row:t})=>e("span",this.statusMap[t.status]||"-")},{title:"总金额",align:"center",minWidth:150,render:(e,{row:t})=>e("span","￥"+t.total.toFixed(2))},{title:"修改时间",key:"updateTime",align:"center",width:180},{title:"创建时间",key:"createTime",align:"center",width:180},{title:"操作",slot:"operate",align:"center",width:200}]}},methods:{reSearch(){var e;null===(e=this.$refs.table)||void 0===e||e.changePage(1)},getData(e){this.selected=[];const{updateTime:t=[],createTime:a=[],...o}=this.searchData;return Object(d["l"])({...e,...o,updateTimeStart:t[0]&&new Date(t[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),updateTimeEnd:t[1]&&new Date(t[1]).endOf("day").format("YYYY-MM-DD HH:mm:ss"),createTimeStart:a[0]&&new Date(a[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),createTimeEnd:a[1]&&new Date(a[1]).endOf("day").format("YYYY-MM-DD HH:mm:ss"),...this.curRow})},changeOrder(e){this.showDetail=!1,this.$emit("close"),this.$router.push({name:"cashierMng",state:{params:{type:"change",userId:e.userId,goodList:e.detail,orderId:e.orderId}}})},copyOrder(e){this.showDetail=!1,this.$emit("close"),this.$router.push({name:"cashierMng",state:{params:{type:"copy",goodList:e.detail}}})},deleteData(e=this.selected){if(!e.length)return this.$Message.info("至少选中一项");this.$Modal.confirm({title:"删除订单",content:"是否确认删除所选订单？",onOk:async()=>{try{const{returnCode:t,data:a}=await Object(d["b"])({orderIds:e.map(e=>e.orderId).join()})||{};0===t&&a&&(this.$Message.success("删除成功"),this.$refs.table.changePage(1),this.$EventBus.$emit("saveOrder"))}catch(t){this.$Message.error("删除失败："+(t.message||t))}}})}},activated(){this.reSearch()}},u=(a("2ff0"),a("6b0d")),m=a.n(u);const h=m()(p,[["render",s],["__scopeId","data-v-69495745"]]);t["default"]=h},"7f90":function(e,t,a){"use strict";a("8afa")},"8afa":function(e,t,a){},a458:function(e,t,a){"use strict";a("5d2e")},f642:function(e,t,a){"use strict";a.r(t);var o=a("7a23"),l=a("b116"),c=a.n(l);const r=["onClick"],s={key:1},n=["onClick"],d=["onClick"],i=["onClick"],p=["onClick"],u={key:1,class:"users-map"};function m(e,t,a,l,m,h){const b=Object(o["resolveComponent"])("viInput"),O=Object(o["resolveComponent"])("FormItem"),j=Object(o["resolveComponent"])("Button"),w=Object(o["resolveComponent"])("viSearchForm"),V=Object(o["resolveComponent"])("viTablePage"),g=Object(o["resolveComponent"])("viLayoutUpDown"),C=Object(o["resolveComponent"])("allUsersMap"),M=Object(o["resolveComponent"])("add-user-modal"),f=Object(o["resolveComponent"])("orderMngModal"),D=Object(o["resolveComponent"])("specialMngModal"),v=Object(o["resolveComponent"])("template-import-users"),k=Object(o["resolveComponent"])("single-user-map");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[m.isMapMode?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",u,[Object(o["createVNode"])(C,{ref:"userMap",onChangeUser:h.changeModal,onDeleteUser:t[7]||(t[7]=e=>h.deleteData([e])),onOpenHistoryOrder:h.openHistoryOrder,onOpenSpecialMng:h.openSpecialMng,onClose:t[8]||(t[8]=e=>m.isMapMode=!1)},null,8,["onChangeUser","onOpenHistoryOrder","onOpenSpecialMng"])])):(Object(o["openBlock"])(),Object(o["createBlock"])(g,{key:0},{up:Object(o["withCtx"])(()=>[Object(o["createVNode"])(w,{modelValue:m.searchData,"onUpdate:modelValue":t[5]||(t[5]=e=>m.searchData=e),onSearch:h.reSearch},{extral:Object(o["withCtx"])(()=>[Object(o["createVNode"])(j,{type:"primary",onClick:t[1]||(t[1]=e=>h.changeModal()),class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("新增")]),_:1}),Object(o["createVNode"])(j,{type:"error",onClick:t[2]||(t[2]=e=>h.deleteData()),class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("批量删除")]),_:1}),Object(o["createVNode"])(j,{onClick:h.exportData,loading:m.exportLoading,class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("导出")]),_:1},8,["onClick","loading"]),Object(o["createVNode"])(j,{type:"primary",onClick:t[3]||(t[3]=e=>m.showImport=!0),class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("批量导入")]),_:1}),Object(o["createVNode"])(j,{type:"success",onClick:t[4]||(t[4]=e=>m.isMapMode=!0),class:"ml-10"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("地图模式")]),_:1})]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(O,{label:"客户名称:",prop:"name"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{modelValue:m.searchData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>m.searchData.name=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onSearch"])]),down:Object(o["withCtx"])(()=>[Object(o["createVNode"])(V,{ref:"table",columns:m.columns,getData:h.getData,addSelect:"",addIndex:"",onOnSelectionChange:t[6]||(t[6]=e=>m.selected=e)},{point:Object(o["withCtx"])(({row:e})=>[e.longitude&&e.latitude?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,src:c.a,onClick:t=>h.openMap(e),class:"pointer"},null,8,r)):(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",s,"-"))]),operate:Object(o["withCtx"])(({row:e})=>[Object(o["createElementVNode"])("a",{onClick:t=>h.openHistoryOrder(e)},"历史订单",8,n),Object(o["createElementVNode"])("a",{onClick:t=>h.openSpecialMng(e),class:"ml-10 vi-green-pointer"},"特价",8,d),Object(o["createElementVNode"])("a",{onClick:t=>h.changeModal(e),class:"ml-10"},"修改",8,i),Object(o["createElementVNode"])("a",{onClick:t=>h.deleteData([e]),class:"ml-10 vi-red-pointer"},"删除",8,p)]),_:1},8,["columns","getData"])]),_:1})),Object(o["createVNode"])(M,{modelValue:m.showUserModal,"onUpdate:modelValue":t[9]||(t[9]=e=>m.showUserModal=e),detailData:m.detailData,onSave:h.reSearch},null,8,["modelValue","detailData","onSave"]),Object(o["createVNode"])(f,{modelValue:m.showOrderModal,"onUpdate:modelValue":t[10]||(t[10]=e=>m.showOrderModal=e),curRow:m.detailData},null,8,["modelValue","curRow"]),Object(o["createVNode"])(D,{modelValue:m.showSpecialModal,"onUpdate:modelValue":t[11]||(t[11]=e=>m.showSpecialModal=e),curRow:m.detailData},null,8,["modelValue","curRow"]),Object(o["createVNode"])(v,{modelValue:m.showImport,"onUpdate:modelValue":t[12]||(t[12]=e=>m.showImport=e),onSave:h.reSearch},null,8,["modelValue","onSave"]),Object(o["createVNode"])(k,{modelValue:m.showMapModal,"onUpdate:modelValue":t[13]||(t[13]=e=>m.showMapModal=e),curRow:m.detailData},null,8,["modelValue","curRow"])],64)}var h=a("eeb9"),b=a("c64b");const O={key:0,class:"orderMng"};function j(e,t,a,l,c,r){const s=Object(o["resolveComponent"])("orderMng"),n=Object(o["resolveComponent"])("Modal",!0);return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createVNode"])(n,{title:a.curRow.name+"-历史订单",modelValue:r.showModal,"onUpdate:modelValue":t[1]||(t[1]=e=>r.showModal=e),width:"1200",class:"orderMngModal"},{default:Object(o["withCtx"])(()=>[r.showModal?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",O,[Object(o["createVNode"])(s,{curRow:a.curRow,onClose:t[0]||(t[0]=e=>r.showModal=!1)},null,8,["curRow"])])):Object(o["createCommentVNode"])("",!0)]),_:1},8,["title","modelValue"])])}var w=a("7e0a"),V={name:"orderMngModal",components:{orderMng:w["default"]},props:{modelValue:{type:Boolean,default:!1},curRow:{type:Object,default(){return{}}}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},g=(a("a458"),a("7f90"),a("6b0d")),C=a.n(g);const M=C()(V,[["render",j],["__scopeId","data-v-550c1e58"]]);var f=M,D=a("e903");const v=e=>(Object(o["pushScopeId"])("data-v-5b47dfba"),e=e(),Object(o["popScopeId"])(),e),k={class:"pt-20 pb-20"},x=v(()=>Object(o["createElementVNode"])("p",null,"点击或者拖拽文件上传",-1)),N={class:"mt-10"},y={class:"upload-msg",ref:"uploadMsg"},S={key:0};function I(e,t,a,l,c,r){const s=Object(o["resolveComponent"])("Icon"),n=Object(o["resolveComponent"])("Upload"),d=Object(o["resolveComponent"])("Checkbox"),i=Object(o["resolveComponent"])("Button"),p=Object(o["resolveComponent"])("Modal");return Object(o["openBlock"])(),Object(o["createBlock"])(p,{title:"批量导入客户",modelValue:r.showModal,"onUpdate:modelValue":t[2]||(t[2]=e=>r.showModal=e),width:500,draggable:"",sticky:"",scrollable:"",mask:!1},{footer:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{type:"text",onClick:t[1]||(t[1]=e=>r.showModal=!1)},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("取消")]),_:1}),Object(o["createVNode"])(i,{type:"primary",onClick:r.exportTemplate},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("模板下载")]),_:1},8,["onClick"])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(n,{type:"drag",action:c.importUsers,headers:c.headers,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",format:["xlsx"],"show-upload-list":!1,"before-upload":r.beforeUpload,"on-success":r.onSuccess,"on-error":r.onError},{default:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",k,[Object(o["createVNode"])(s,{type:"ios-cloud-upload",size:"52",style:{color:"#3399ff"}}),x])]),_:1},8,["action","headers","before-upload","on-success","on-error"]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",N,[Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",null,"导入文件名："+Object(o["toDisplayString"])(c.uploadName),1),Object(o["createVNode"])(d,{modelValue:c.showError,"onUpdate:modelValue":t[0]||(t[0]=e=>c.showError=e),class:"fr"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("只看错误信息")]),_:1},8,["modelValue"])]),Object(o["createElementVNode"])("div",y,[r.msgList.length?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("p",S,Object(o["toDisplayString"])(c.showError?"【无】":"【正在导入中】"),1)),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(r.msgList,(e,t)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("p",{key:t},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])({"vi-red-text":1==e.status,"vi-green-text":[0,2,10].includes(e.status)})},Object(o["toDisplayString"])(e.mes),3)]))),128))],512)],512),[[o["vShow"],c.uploadId]])]),_:1},8,["modelValue"])}var U=a("8451"),B=a("ec16"),_=(a("3c65"),{name:"templateImportUsers",components:{Upload:B["a"],Checkbox:U["a"]},props:{modelValue:{type:Boolean,default:!1}},data(){return{importUsers:h["r"],headers:{authorization:sessionStorage.getItem("authorization")},uploadId:"",uploadName:"",uploadMsg:[],showError:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}},msgList(){return this.uploadMsg.filter(e=>!this.showError||this.showError&&1==e.status)}},methods:{exportTemplate(){Object(h["f"])({userIds:"下载模板"},`客户模板${(new Date).format("YYYYMMDDHHmmss")}.xlsx`)},beforeUpload(){return this.uploadId="",this.uploadName="",this.uploadMsg=[],!0},onSuccess(e,t){0==e.returnCode?(this.uploadName=t.name,this.$Message.success("上传成功，开始导入")):this.$Message.error("上传失败："+e.returnMsg)},onError(e){this.$Message.error("上传失败："+(e.message||e))},batchImportUsers(e){0!==e.status||this.uploadId?e.id===this.uploadId&&(this.uploadMsg.unshift(e),10==e.status&&this.$emit("save")):(this.uploadId=e.id,this.uploadMsg=[e])}},mounted(){this.$EventBus.$on("batchImportUsers",this.batchImportUsers)},beforeMount(){this.$EventBus.$off("batchImportUsers",this.batchImportUsers)}});a("342e");const E=C()(_,[["render",I],["__scopeId","data-v-5b47dfba"]]);var T=E,$=a("b046"),Y=a("31fd"),H={name:"userMng",components:{addUserModal:b["a"],orderMngModal:f,specialMngModal:D["a"],templateImportUsers:T,singleUserMap:$["a"],allUsersMap:Y["a"]},data(){return{searchData:{},showUserModal:!1,detailData:{},columns:[{title:"客户名称",key:"name",align:"center"},{title:"联系电话",key:"phone",align:"center"},{title:"备注",key:"remarks",align:"center"},{title:"定位",slot:"point",align:"center"},{title:"修改时间",key:"updateTime",align:"center",width:180},{title:"操作",slot:"operate",align:"center",width:200}],selected:[],showOrderModal:!1,showSpecialModal:!1,exportLoading:!1,showImport:!1,showMapModal:!1,isMapMode:!1}},methods:{reSearch(){var e;this.isMapMode?this.$refs.userMap.getUsersList():null===(e=this.$refs.table)||void 0===e||e.changePage(1)},getData(e){this.selected=[];const t={...e,...this.searchData};return Object(h["p"])(t)},changeModal(e){this.detailData={...e},this.showUserModal=!0},openHistoryOrder(e){this.detailData={...e},this.showOrderModal=!0},openSpecialMng(e){this.detailData={...e},this.showSpecialModal=!0},deleteData(e=this.selected){if(!e.length)return this.$Message.info("至少选中一项");this.$Modal.confirm({title:"删除客户",content:"是否确认删除所选客户（将会删除该用户所有数据）？",onOk:async()=>{try{const{returnCode:t,data:a}=await Object(h["d"])({userIds:e.map(e=>e.userId).join()})||{};0===t&&a&&(this.$Message.success("删除成功"),this.reSearch())}catch(t){this.$Message.error("删除失败："+(t.message||t))}}})},exportData(){this.exportLoading=!0,Object(h["f"])({...this.searchData,userIds:this.selected.map(e=>e.userId).join()},`客户${(new Date).format("YYYYMMDDHHmmss")}.xlsx`).finally(()=>{this.exportLoading=!1})},openMap(e){this.detailData={...e},this.showMapModal=!0}},activated(){this.reSearch()}};a("2b40");const R=C()(H,[["render",m],["__scopeId","data-v-3951545a"]]);t["default"]=R}}]);
//# sourceMappingURL=chunk-72ad6e07.8381e2fe.js.map