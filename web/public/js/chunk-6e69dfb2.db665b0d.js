(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e69dfb2"],{"083a":function(e,t,o){"use strict";var r=o("0d51"),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw a("Cannot delete property "+r(t)+" of "+r(e))}},"0ed6":function(e,t,o){"use strict";o("406d")},"1f38":function(e,t,o){"use strict";var r=o("7a23");function a(e,t,o,a,i,n){const c=Object(r["resolveComponent"])("viInput"),d=Object(r["resolveComponent"])("FormItem"),l=Object(r["resolveComponent"])("viInputNumber"),s=Object(r["resolveComponent"])("Radio"),u=Object(r["resolveComponent"])("RadioGroup"),b=Object(r["resolveComponent"])("Form"),m=Object(r["resolveComponent"])("Button"),h=Object(r["resolveComponent"])("Modal");return Object(r["openBlock"])(),Object(r["createBlock"])(h,{title:n.title,modelValue:n.showModal,"onUpdate:modelValue":t[7]||(t[7]=e=>n.showModal=e),width:400,"class-name":"vertical-center-modal"},{footer:Object(r["withCtx"])(()=>[Object(r["createVNode"])(m,{type:"text",onClick:t[6]||(t[6]=e=>n.showModal=!1)},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("取消")]),_:1}),Object(r["createVNode"])(m,{type:"primary",onClick:n.submit,loading:i.loading},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("确定")]),_:1},8,["onClick","loading"])]),default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(b,{ref:"form",model:i.formData,rules:i.rules,"label-width":60,onKeydown:Object(r["withKeys"])(n.submit,["enter"]),class:"plr"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(d,{label:"名称:",prop:"name"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(c,{modelValue:i.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.name=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(d,{label:"规格:",prop:"standard"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(c,{modelValue:i.formData.standard,"onUpdate:modelValue":t[1]||(t[1]=e=>i.formData.standard=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(d,{label:"单位:",prop:"unit"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(c,{modelValue:i.formData.unit,"onUpdate:modelValue":t[2]||(t[2]=e=>i.formData.unit=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(d,{label:"单价:",prop:"price"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(l,{modelValue:i.formData.price,"onUpdate:modelValue":t[3]||(t[3]=e=>i.formData.price=e),min:0,step:.5},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(d,{label:"种类:",prop:"type"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(u,{modelValue:i.formData.type,"onUpdate:modelValue":t[4]||(t[4]=e=>i.formData.type=e)},{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(i.TYPE_MAP,(e,t)=>(Object(r["openBlock"])(),Object(r["createBlock"])(s,{key:t,label:t},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.showCount?(Object(r["openBlock"])(),Object(r["createBlock"])(d,{key:0,label:"数量:",prop:"count"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(l,{modelValue:i.formData.count,"onUpdate:modelValue":t[5]||(t[5]=e=>i.formData.count=e),integer:"",min:0},null,8,["modelValue"])]),_:1})):Object(r["createCommentVNode"])("",!0)]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["title","modelValue"])}o("d9e2");var i=o("eeb9"),n=o("267e"),c=o("2410"),d=o.n(c),l={name:"addGoodModal",props:{modelValue:{type:Boolean,default:!1},detailData:{type:Object,default(){return{}}},showCount:{type:Boolean,default:!1}},data(){const e=async(e,t,o)=>{if(t&&this.detailData.name!==this.formData.name){const{data:e}=await Object(i["C"])({name:t})||{};if(e)return o(new Error("该商品名称已存在"))}o()};return{TYPE_MAP:n["b"],formData:{},rules:{name:[{required:!0,message:"请输入商品名称"},{validator:e,trigger:"blur"}]},loading:!1}},computed:{title(){return(this.detailData.goodId?"编辑":"新增")+"商品"},showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}}},watch:{detailData:{deep:!0,handler(){this.$refs.form.resetFields(),this.formData=d()(this.detailData)}}},methods:{submit(){this.loading=!0,this.$refs.form.validate(async e=>{if(!e)return this.$Message.error("数据校验不通过"),void(this.loading=!1);try{const{_index:e,_rowKey:t,count:o,...r}=this.formData,{data:a}=await Object(i["x"])(r)||{};a&&(this.$Message.success(this.title+"成功"),this.$emit("save",{...this.formData}),this.$refs.form.resetFields(),this.showModal=!1)}catch(t){this.$Message.error("请求失败："+(t.message||t))}finally{this.loading=!1}})}}},s=o("6b0d"),u=o.n(s);const b=u()(l,[["render",a]]);t["a"]=b},2410:function(e,t,o){(function(t){var o=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var o,r,a;try{o=Map}catch(u){o=function(){}}try{r=Set}catch(u){r=function(){}}try{a=Promise}catch(u){a=function(){}}function i(n,c,d,l,u){"object"===typeof c&&(d=c.depth,l=c.prototype,u=c.includeNonEnumerable,c=c.circular);var b=[],m=[],h="undefined"!=typeof t;function O(n,d){if(null===n)return null;if(0===d)return n;var p,j;if("object"!=typeof n)return n;if(e(n,o))p=new o;else if(e(n,r))p=new r;else if(e(n,a))p=new a((function(e,t){n.then((function(t){e(O(t,d-1))}),(function(e){t(O(e,d-1))}))}));else if(i.__isArray(n))p=[];else if(i.__isRegExp(n))p=new RegExp(n.source,s(n)),n.lastIndex&&(p.lastIndex=n.lastIndex);else if(i.__isDate(n))p=new Date(n.getTime());else{if(h&&t.isBuffer(n))return p=t.allocUnsafe?t.allocUnsafe(n.length):new t(n.length),n.copy(p),p;e(n,Error)?p=Object.create(n):"undefined"==typeof l?(j=Object.getPrototypeOf(n),p=Object.create(j)):(p=Object.create(l),j=l)}if(c){var g=b.indexOf(n);if(-1!=g)return m[g];b.push(n),m.push(p)}for(var f in e(n,o)&&n.forEach((function(e,t){var o=O(t,d-1),r=O(e,d-1);p.set(o,r)})),e(n,r)&&n.forEach((function(e){var t=O(e,d-1);p.add(t)})),n){var V;j&&(V=Object.getOwnPropertyDescriptor(j,f)),V&&null==V.set||(p[f]=O(n[f],d-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(n);for(f=0;f<w.length;f++){var v=w[f],y=Object.getOwnPropertyDescriptor(n,v);(!y||y.enumerable||u)&&(p[v]=O(n[v],d-1),y.enumerable||Object.defineProperty(p,v,{enumerable:!1}))}}if(u){var N=Object.getOwnPropertyNames(n);for(f=0;f<N.length;f++){var C=N[f];y=Object.getOwnPropertyDescriptor(n,C);y&&y.enumerable||(p[C]=O(n[C],d-1),Object.defineProperty(p,C,{enumerable:!1}))}}return p}return"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=1/0),O(n,d)}function n(e){return Object.prototype.toString.call(e)}function c(e){return"object"===typeof e&&"[object Date]"===n(e)}function d(e){return"object"===typeof e&&"[object Array]"===n(e)}function l(e){return"object"===typeof e&&"[object RegExp]"===n(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=n,i.__isDate=c,i.__isArray=d,i.__isRegExp=l,i.__getRegExpFlags=s,i}();e.exports&&(e.exports=o)}).call(this,o("b639").Buffer)},"267e":function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return a}));const r={1:"整件",99:"散装"},a=e=>"99"==e.type},"3c65":function(e,t,o){"use strict";var r=o("23e7"),a=o("7b0b"),i=o("07fa"),n=o("3a34"),c=o("083a"),d=o("3511"),l=1!==[].unshift(0),s=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},u=l||!s();r({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(e){var t=a(this),o=i(t),r=arguments.length;if(r){d(o+r);var l=o;while(l--){var s=l+r;l in t?t[s]=t[l]:c(t,s)}for(var u=0;u<r;u++)t[u]=arguments[u]}return n(t,o+r)}})},"406d":function(e,t,o){},"9b2d":function(e,t,o){"use strict";o.r(t);var r=o("7a23");const a=e=>(Object(r["pushScopeId"])("data-v-6f01656a"),e=e(),Object(r["popScopeId"])(),e),i={class:"header"},n=a(()=>Object(r["createElementVNode"])("span",null,"订单编号：",-1)),c=a(()=>Object(r["createElementVNode"])("span",null,"客户名称：",-1)),d=a(()=>Object(r["createElementVNode"])("span",{class:"ml-15"},"没有？快速新增：",-1)),l={class:"good-box"},s={class:"flex-none"},u=a(()=>Object(r["createElementVNode"])("span",null,"商品名称：",-1)),b={class:"search-wrapper"},m={class:"no-data"},h={class:"search-box"},O={class:"search-msg"},p=["title"],j={key:0,class:"origin"},g={class:"ml-10"},f={class:"search-input"},V={class:"table-box",ref:"table"},w={class:"flex-bc"},v=["onClick"],y={class:"w60 flex-cc flex-1"},N=["onClick"],C={class:"page-footer"};function x(e,t,o,a,x,k){const U=Object(r["resolveComponent"])("Icon"),I=Object(r["resolveComponent"])("Option"),L=Object(r["resolveComponent"])("Select"),G=Object(r["resolveComponent"])("viInput"),E=Object(r["resolveComponent"])("Button"),D=Object(r["resolveComponent"])("viInputNumber"),_=Object(r["resolveComponent"])("van-radio"),B=Object(r["resolveComponent"])("van-radio-group"),M=Object(r["resolveComponent"])("Table"),P=Object(r["resolveComponent"])("viPrint"),$=Object(r["resolveComponent"])("add-good-modal"),S=Object(r["resolveComponent"])("viLayoutUpDown");return Object(r["openBlock"])(),Object(r["createBlock"])(S,{onOnMount:k.addErd},{up:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",i,[x.curOrderId?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:0},[n,Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(x.curOrderId),1),Object(r["createVNode"])(U,{type:"md-close",size:"25",onClick:k.deleteOrderId,title:"重建订单",class:"vi-link-pointer mr-10"},null,8,["onClick"])],64)):Object(r["createCommentVNode"])("",!0),c,Object(r["createVNode"])(L,{modelValue:x.curUserId,"onUpdate:modelValue":t[0]||(t[0]=e=>x.curUserId=e),ref:"user",filterable:"",clearable:"",class:"vi-width"},{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(x.allUsers,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(I,{key:e.userId,value:e.userId},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),d,Object(r["createVNode"])(G,{modelValue:x.newUserName,"onUpdate:modelValue":t[1]||(t[1]=e=>x.newUserName=e),placeholder:"客户名称",onOnEnter:k.confirmAddUser,class:"vi-width"},null,8,["modelValue","onOnEnter"]),Object(r["createVNode"])(E,{type:"success",onClick:k.confirmAddUser,loading:x.newUserLoading,class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("新增客户")]),_:1},8,["onClick","loading"])])]),down:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("div",s,[u,Object(r["createVNode"])(L,{modelValue:x.curGoodId,"onUpdate:modelValue":t[2]||(t[2]=e=>x.curGoodId=e),filterable:"",clearable:"",onOnChange:k.selectGood,class:"vi-width"},{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(x.allGoods,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(I,{key:e.goodId,value:e.goodId},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onOnChange"])]),Object(r["createElementVNode"])("div",b,[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",m,"暂无数据",512),[[r["vShow"],!k.curGood.goodId]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",h,[Object(r["createElementVNode"])("div",O,[Object(r["createElementVNode"])("b",{title:k.curGood.name},"商品名称："+Object(r["toDisplayString"])(k.curGood.name),9,p),Object(r["createElementVNode"])("p",null,[k.curGood.price!=k.curGood.originPrice&&k.curGood.unit==k.curGood.originUnit&&k.curGood.standard==k.curGood.originStandard?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",j,"￥"+Object(r["toDisplayString"])(k.curGood.originPrice&&k.curGood.originPrice.toFixed(2)),1)):Object(r["createCommentVNode"])("",!0),Object(r["createTextVNode"])(" ￥"+Object(r["toDisplayString"])(k.curGood.price&&k.curGood.price.toFixed(2))+" / "+Object(r["toDisplayString"])(k.curGood.unit)+" ",1),Object(r["createElementVNode"])("span",g,Object(r["toDisplayString"])(k.curGood.standard),1)])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",f,[Object(r["createVNode"])(D,{ref:"count",modelValue:k.curGood.count,"onUpdate:modelValue":t[3]||(t[3]=e=>k.curGood.count=e),placeholder:"数量",integer:"",min:0,onOnEnter:k.confirmAdd},null,8,["modelValue","onOnEnter"]),Object(r["createVNode"])(E,{onClick:t[4]||(t[4]=e=>x.curGoodId=""),class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("取消")]),_:1}),Object(r["createVNode"])(E,{type:"primary",onClick:k.confirmAdd,class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("增加")]),_:1},8,["onClick"])],512),[[r["vShow"],k.curGood.goodId]])],512),[[r["vShow"],k.curGood.goodId]])])]),Object(r["createElementVNode"])("div",V,[Object(r["createVNode"])(M,{columns:x.columns,data:x.goodList,height:x.height,stripe:""},{standard:Object(r["withCtx"])(({index:e})=>[Object(r["createVNode"])(G,{modelValue:x.goodList[e].standard,"onUpdate:modelValue":t=>x.goodList[e].standard=t,placeholder:"规格",class:"w100"},null,8,["modelValue","onUpdate:modelValue"])]),unit:Object(r["withCtx"])(({index:e})=>[Object(r["createVNode"])(G,{modelValue:x.goodList[e].unit,"onUpdate:modelValue":t=>x.goodList[e].unit=t,placeholder:"单位",class:"w100"},null,8,["modelValue","onUpdate:modelValue"])]),price:Object(r["withCtx"])(({index:e})=>[Object(r["createElementVNode"])("div",w,[x.goodList[e].price!=x.goodList[e].originPrice&&x.goodList[e].unit==x.goodList[e].originUnit&&x.goodList[e].standard==x.goodList[e].originStandard&&x.goodList[e].isBulk==x.goodList[e].originIsBulk?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:0,onClick:t=>x.goodList[e].price=x.goodList[e].originPrice,class:"origin w40 pointer"},[Object(r["createTextVNode"])("￥ "),Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(x.goodList[e].originPrice),1)],8,v)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",y,[Object(r["createTextVNode"])(" ￥ "),Object(r["createVNode"])(D,{modelValue:x.goodList[e].price,"onUpdate:modelValue":t=>x.goodList[e].price=t,min:0,step:.5},null,8,["modelValue","onUpdate:modelValue"])])])]),count:Object(r["withCtx"])(({index:e})=>[Object(r["createVNode"])(D,{modelValue:x.goodList[e].count,"onUpdate:modelValue":t=>x.goodList[e].count=t,integer:"",min:0},null,8,["modelValue","onUpdate:modelValue"])]),isBulk:Object(r["withCtx"])(({index:e})=>[Object(r["createVNode"])(B,{"model-value":x.goodList[e].isBulk},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(_,{name:!0,onClick:t=>x.goodList[e].isBulk=!x.goodList[e].isBulk},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("散装")]),_:2},1032,["onClick"])]),_:2},1032,["model-value"])]),remarks:Object(r["withCtx"])(({index:e})=>[Object(r["createVNode"])(G,{modelValue:x.goodList[e].remarks,"onUpdate:modelValue":t=>x.goodList[e].remarks=t,placeholder:"备注",class:"w100"},null,8,["modelValue","onUpdate:modelValue"])]),operate:Object(r["withCtx"])(({index:e})=>[Object(r["createElementVNode"])("a",{onClick:t=>k.deleteGood(e),class:"vi-red-pointer"},"删除",8,N)]),_:1},8,["columns","data","height"])],512)]),footer:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",C,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(E,{type:"primary",onClick:t[5]||(t[5]=e=>x.showGoodModal=!0)},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("新增商品")]),_:1}),Object(r["createVNode"])(E,{onClick:t[6]||(t[6]=e=>{x.goodList=new Array(90).fill().map((e,t)=>({name:"物品"+(t+1),standard:"规格"+(t+1),unit:"单位"+(t+1),count:parseInt(100*Math.random()),price:+parseFloat(100*Math.random()).toFixed(2)}))}),class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("生成随机订单")]),_:1})]),Object(r["createElementVNode"])("p",null,"总计：￥"+Object(r["toDisplayString"])(x.totalPrice),1),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(E,{type:"error",onClick:t[7]||(t[7]=e=>k.clearAll()),class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("清空商品")]),_:1}),Object(r["createVNode"])(E,{onClick:t[8]||(t[8]=e=>k.saveOrder("1")),loading:x.saveLoading,class:"ml-10"},{default:Object(r["withCtx"])(()=>[Object(r["createTextVNode"])("保存草稿")]),_:1},8,["loading"]),Object(r["createVNode"])(P,{list:x.goodList,total:x.totalPrice,"user-data":k.curUser,onPrint:t[9]||(t[9]=e=>k.saveOrder("2"))},null,8,["list","total","user-data"])])]),Object(r["createVNode"])($,{modelValue:x.showGoodModal,"onUpdate:modelValue":t[10]||(t[10]=e=>x.showGoodModal=e),showCount:"",onSave:k.saveGood},null,8,["modelValue","onSave"])]),_:1},8,["onOnMount"])}var k=o("274c"),U=(o("13d5"),o("3c65"),o("eec4")),I=o.n(U),L=o("eeb9"),G=o("2af9"),E=o("1f38"),D=o("267e"),_={name:"cashierMng",components:{Table:k["a"],viPrint:G["i"],addGoodModal:E["a"]},data(){return{erd:null,allGoods:[],allUsers:[],curGoodId:"",curUserId:"",curOrderId:"",goodList:[],height:0,columns:[{title:"序号",type:"index",align:"center",width:80},{title:"名称",key:"name",align:"center",minWidth:150},{title:"规格",slot:"standard",align:"center",width:120},{title:"单位",slot:"unit",align:"center",width:100},{title:"数量",slot:"count",align:"center",width:100},{title:"单价",slot:"price",align:"center",width:200},{title:"是否散装",slot:"isBulk",align:"center",width:100},{title:"备注",slot:"remarks",align:"center",width:200},{title:"操作",slot:"operate",align:"center",width:100}],totalPrice:"0.00",showGoodModal:!1,printLoading:!1,saveLoading:!1,newUserName:"",newUserLoading:!1}},watch:{goodList:{deep:!0,handler(e){this.totalPrice=(e.reduce((e,t)=>e+ +(t.count*t.price).toFixed(2),0)||0).toFixed(2)}},$route:{deep:!0,immediate:!0,handler({name:e}){if("cashierMng"!==e)return;const{params:t={}}=history.state;Object.keys(t).length&&(this.goodList.length?this.$Modal.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{this.initData(t)}}):this.initData(t))}},curUserId(e){this.changeUser(e)}},computed:{curUser(){return this.allUsers.find(e=>e.userId==this.curUserId)||{}},curGood(){const e=this.allGoods.find(e=>e.goodId==this.curGoodId)||{};return e.count=1,e}},methods:{initData(e){this.curUserId=e.userId?+e.userId:"",this.curOrderId=e.orderId||"",this.$nextTick(()=>{this.goodList=JSON.parse(e.goodList||"[]").map(t=>("copy"===e.type&&(t.price=t.originPrice),t)),history.state.params={}})},async printOrder(){try{this.printLoading=!0;const{returnCode:e,data:t}=await Object(L["v"])({list:this.goodList,total:this.totalPrice})||{};0===e&&t&&this.$Message.success("打印成功")}catch(e){this.$Message.error("打印失败："+(e.message||e))}finally{this.printLoading=!1}},deleteOrderId(){this.$Modal.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{this.curOrderId=""}})},clearAll(e){e?(this.goodList=[],this.curGoodId=""):this.$Modal.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{this.goodList=[],this.curGoodId=""}})},selectGood(){this.$nextTick(()=>{this.$refs.count.focus()})},confirmAdd(){if(!this.curGood.count)return this.$Message.info("请输入商品数量");const e=this.goodList.findIndex(e=>e.goodId===this.curGood.goodId);-1===e?this.goodList.unshift({...this.curGood}):this.goodList[e].count+=this.curGood.count,this.curGoodId=""},deleteGood(e){this.$Modal.confirm({title:"移除商品",content:"是否确认移除该商品？",onOk:()=>{this.goodList.splice(e,1)}})},async saveOrder(e){if("1"==e&&!this.curUserId)return this.$Message.info("请填写客户名称");if("2"!=e||this.curUserId)try{this.saveLoading=!0;const{returnCode:t,data:o}=await Object(L["y"])({orderId:this.curOrderId||void 0,userId:this.curUserId,status:e,total:this.totalPrice,detail:JSON.stringify(this.goodList)})||{};0===t&&o&&(this.$Message.success("保存成功"),this.$EventBus.$emit("saveOrder"),this.clearAll(!0),this.curUserId="",this.curOrderId="",this.getUsersList())}catch(t){this.$Message.error("保存草稿失败："+(t.message||t))}finally{this.saveLoading=!1}},changeUser(){const{special:e={}}=this.curUser;this.allGoods=this.allGoods.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t)),this.goodList=this.goodList.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))},async confirmAddUser(){if(this.newUserName)try{this.newUserLoading=!0;const{data:e}=await Object(L["D"])({name:this.newUserName})||{};if(e)return this.$Message.error("该客户名称已存在"),this.curUserId=e.userId,void(this.newUserName="");const{data:t}=await Object(L["A"])({name:this.newUserName})||{};t&&(this.$Message.success("新增成功"),this.curUserId=t.userId,this.newUserName="",this.getUsersList())}catch(e){this.$Message.error("新增客户失败："+(e.message||e))}finally{this.newUserLoading=!1}else this.$Message.info("请输入要新增的客户名称")},saveGood(e){this.goodList.unshift({...e}),this.getGoodsList()},async getGoodsList(){try{const{returnCode:e,data:t}=await Object(L["i"])()||{};0===e&&(this.allGoods=t&&t.map(e=>(e.originPrice=e.price||0,e.unit=e.unit||"",e.originUnit=e.unit||"",e.standard=e.standard||"",e.originStandard=e.standard||"",e.isBulk=Object(D["a"])(e),e.originIsBulk=Object(D["a"])(e),e))||[])}catch(e){this.$Message.error("获取商品字典失败："+(e.message||e))}},async getUsersList(){try{const{returnCode:e,data:t}=await Object(L["j"])()||{};if(0===e&&(this.allUsers=t&&t.map(e=>{const t={};return e.special.forEach(e=>{t[e.goodId]=+e.price}),e.special=t,e})||[],this.curUserId)){const e=t.find(e=>e.userId===this.curUserId)||{};this.$refs.user.values=[{value:this.curUserId,label:e.name,tag:null}]}}catch(e){this.$Message.error("获取客户列表失败："+(e.message||e))}},addErd(){this.erd=I()(),this.erd.listenTo(this.$refs.table,()=>{this.height=this.$refs.table.offsetHeight})}},activated(){this.getGoodsList(),this.getUsersList()},beforeUnmount(){this.erd.uninstall(this.$refs.table)}},B=(o("0ed6"),o("6b0d")),M=o.n(B);const P=M()(_,[["render",x],["__scopeId","data-v-6f01656a"]]);t["default"]=P}}]);