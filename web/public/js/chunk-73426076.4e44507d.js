(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73426076"],{"0244":function(e,t,o){"use strict";o("69f1")},"083a":function(e,t,o){"use strict";var a=o("0d51"),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+a(t)+" of "+a(e))}},"1f38":function(e,t,o){"use strict";var a=o("7a23");function r(e,t,o,r,n,c){const l=Object(a["resolveComponent"])("viInput"),i=Object(a["resolveComponent"])("FormItem"),s=Object(a["resolveComponent"])("viInputNumber"),d=Object(a["resolveComponent"])("Radio"),u=Object(a["resolveComponent"])("RadioGroup"),b=Object(a["resolveComponent"])("Form"),p=Object(a["resolveComponent"])("Button"),m=Object(a["resolveComponent"])("Modal");return Object(a["openBlock"])(),Object(a["createBlock"])(m,{title:c.title,modelValue:c.showModal,"onUpdate:modelValue":t[7]||(t[7]=e=>c.showModal=e),width:400,"class-name":"vertical-center-modal"},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{type:"text",onClick:t[6]||(t[6]=e=>c.showModal=!1)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("取消")]),_:1}),Object(a["createVNode"])(p,{type:"primary",onClick:c.submit,loading:n.loading},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("确定")]),_:1},8,["onClick","loading"])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{ref:"form",model:n.formData,rules:n.rules,"label-width":60,onKeydown:Object(a["withKeys"])(c.submit,["enter"]),class:"plr"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{label:"名称:",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{modelValue:n.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.formData.name=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(i,{label:"规格:",prop:"standard"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{modelValue:n.formData.standard,"onUpdate:modelValue":t[1]||(t[1]=e=>n.formData.standard=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(i,{label:"单位:",prop:"unit"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{modelValue:n.formData.unit,"onUpdate:modelValue":t[2]||(t[2]=e=>n.formData.unit=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(i,{label:"单价:",prop:"price"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{modelValue:n.formData.price,"onUpdate:modelValue":t[3]||(t[3]=e=>n.formData.price=e),min:0,step:.5},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(i,{label:"种类:",prop:"type"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{modelValue:n.formData.type,"onUpdate:modelValue":t[4]||(t[4]=e=>n.formData.type=e)},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(n.TYPE_MAP,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(d,{key:t,label:t},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.showCount?(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:0,label:"数量:",prop:"count"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{modelValue:n.formData.count,"onUpdate:modelValue":t[5]||(t[5]=e=>n.formData.count=e),integer:"",min:0},null,8,["modelValue"])]),_:1})):Object(a["createCommentVNode"])("",!0)]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["title","modelValue"])}o("d9e2");var n=o("eeb9"),c=o("267e"),l=o("2410"),i=o.n(l),s={name:"addGoodModal",props:{modelValue:{type:Boolean,default:!1},detailData:{type:Object,default(){return{}}},showCount:{type:Boolean,default:!1}},data(){const e=async(e,t,o)=>{if(t&&this.detailData.name!==this.formData.name){const{data:e}=await Object(n["C"])({name:t})||{};if(e)return o(new Error("该商品名称已存在"))}o()};return{TYPE_MAP:c["b"],formData:{},rules:{name:[{required:!0,message:"请输入商品名称"},{validator:e,trigger:"blur"}]},loading:!1}},computed:{title(){return(this.detailData.goodId?"编辑":"新增")+"商品"},showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}}},watch:{detailData:{deep:!0,handler(){this.$refs.form.resetFields(),this.formData=i()(this.detailData)}}},methods:{submit(){this.loading=!0,this.$refs.form.validate(async e=>{if(!e)return this.$Message.error("数据校验不通过"),void(this.loading=!1);try{const{_index:e,_rowKey:t,count:o,...a}=this.formData,{data:r}=await Object(n["x"])(a)||{};r&&(this.$Message.success(this.title+"成功"),this.$emit("save",{...this.formData}),this.$refs.form.resetFields(),this.showModal=!1)}catch(t){this.$Message.error("请求失败："+(t.message||t))}finally{this.loading=!1}})}}},d=o("6b0d"),u=o.n(d);const b=u()(s,[["render",r]]);t["a"]=b},2410:function(e,t,o){(function(t){var o=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var o,a,r;try{o=Map}catch(u){o=function(){}}try{a=Set}catch(u){a=function(){}}try{r=Promise}catch(u){r=function(){}}function n(c,l,i,s,u){"object"===typeof l&&(i=l.depth,s=l.prototype,u=l.includeNonEnumerable,l=l.circular);var b=[],p=[],m="undefined"!=typeof t;function h(c,i){if(null===c)return null;if(0===i)return c;var f,O;if("object"!=typeof c)return c;if(e(c,o))f=new o;else if(e(c,a))f=new a;else if(e(c,r))f=new r((function(e,t){c.then((function(t){e(h(t,i-1))}),(function(e){t(h(e,i-1))}))}));else if(n.__isArray(c))f=[];else if(n.__isRegExp(c))f=new RegExp(c.source,d(c)),c.lastIndex&&(f.lastIndex=c.lastIndex);else if(n.__isDate(c))f=new Date(c.getTime());else{if(m&&t.isBuffer(c))return f=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(f),f;e(c,Error)?f=Object.create(c):"undefined"==typeof s?(O=Object.getPrototypeOf(c),f=Object.create(O)):(f=Object.create(s),O=s)}if(l){var j=b.indexOf(c);if(-1!=j)return p[j];b.push(c),p.push(f)}for(var g in e(c,o)&&c.forEach((function(e,t){var o=h(t,i-1),a=h(e,i-1);f.set(o,a)})),e(c,a)&&c.forEach((function(e){var t=h(e,i-1);f.add(t)})),c){var y;O&&(y=Object.getOwnPropertyDescriptor(O,g)),y&&null==y.set||(f[g]=h(c[g],i-1))}if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(c);for(g=0;g<v.length;g++){var w=v[g],V=Object.getOwnPropertyDescriptor(c,w);(!V||V.enumerable||u)&&(f[w]=h(c[w],i-1),V.enumerable||Object.defineProperty(f,w,{enumerable:!1}))}}if(u){var C=Object.getOwnPropertyNames(c);for(g=0;g<C.length;g++){var k=C[g];V=Object.getOwnPropertyDescriptor(c,k);V&&V.enumerable||(f[k]=h(c[k],i-1),Object.defineProperty(f,k,{enumerable:!1}))}}return f}return"undefined"==typeof l&&(l=!0),"undefined"==typeof i&&(i=1/0),h(c,i)}function c(e){return Object.prototype.toString.call(e)}function l(e){return"object"===typeof e&&"[object Date]"===c(e)}function i(e){return"object"===typeof e&&"[object Array]"===c(e)}function s(e){return"object"===typeof e&&"[object RegExp]"===c(e)}function d(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return n.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},n.__objToStr=c,n.__isDate=l,n.__isArray=i,n.__isRegExp=s,n.__getRegExpFlags=d,n}();e.exports&&(e.exports=o)}).call(this,o("b639").Buffer)},"267e":function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"a",(function(){return r}));const a={1:"整件",99:"散装"},r=e=>"99"==e.type},"3c65":function(e,t,o){"use strict";var a=o("23e7"),r=o("7b0b"),n=o("07fa"),c=o("3a34"),l=o("083a"),i=o("3511"),s=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},u=s||!d();a({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(e){var t=r(this),o=n(t),a=arguments.length;if(a){i(o+a);var s=o;while(s--){var d=s+a;s in t?t[d]=t[s]:l(t,d)}for(var u=0;u<a;u++)t[u]=arguments[u]}return c(t,o+a)}})},"4ed8":function(e,t,o){"use strict";o.r(t);o("14d9");var a=o("7a23");const r={class:"container"},n=["onClick"],c={class:"card-top"},l={class:"card-bottom"},i={class:"card-left"},s={class:"price"},d={key:0,class:"ml-5"},u={key:1,class:"standard"},b={class:"card-right"};function p(e,t,o,p,m,h){const f=Object(a["resolveComponent"])("Icon"),O=Object(a["resolveComponent"])("van-search"),j=Object(a["resolveComponent"])("van-action-sheet"),g=Object(a["resolveComponent"])("van-sidebar-item"),y=Object(a["resolveComponent"])("van-sidebar"),v=Object(a["resolveComponent"])("viInputNumber"),w=Object(a["resolveComponent"])("viListScroll"),V=Object(a["resolveComponent"])("add-good-modal");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",null,[h.showScan?(Object(a["openBlock"])(),Object(a["createBlock"])(f,{key:0,type:"ios-qr-scanner",size:"28",onClick:t[0]||(t[0]=t=>e.$router.push("mobileEnter")),class:"header-icon left"})):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(f,{type:"ios-add",size:"34",onClick:t[1]||(t[1]=e=>h.onSelect("change",{})),class:"header-icon right"}),Object(a["createVNode"])(O,{modelValue:m.keyword,"onUpdate:modelValue":t[3]||(t[3]=e=>m.keyword=e),shape:"round",placeholder:"请输入商品名称搜索","show-action":"",onClear:h.reSearch,onSearch:h.reSearch,class:"search-input"},{action:Object(a["withCtx"])(()=>[Object(a["createVNode"])(f,{type:"ios-repeat",size:"24",onClick:t[2]||(t[2]=e=>m.showSort=!0),class:"rotate"})]),_:1},8,["modelValue","onClear","onSearch"]),Object(a["createVNode"])(j,{show:m.showSort,"onUpdate:show":t[4]||(t[4]=e=>m.showSort=e),title:"排序",actions:h.sortActions,"cancel-text":"取消","close-on-click-action":"",onSelect:h.sortChange},null,8,["show","actions","onSelect"]),Object(a["createElementVNode"])("div",r,[Object(a["createVNode"])(y,{modelValue:m.type,"onUpdate:modelValue":t[5]||(t[5]=e=>m.type=e),onChange:h.reSearch,class:"sidebar"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(g,{title:"全部"}),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(m.TYPE_MAP,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(g,{key:t,title:e},null,8,["title"]))),128)),Object(a["createVNode"])(g,{title:"其他"})]),_:1},8,["modelValue","onChange"]),Object(a["createVNode"])(w,{ref:"list",getData:h.getData,onOnUpdate:h.updateData,class:"flex-1 h100"},{default:Object(a["withCtx"])(({item:e})=>[Object(a["createElementVNode"])("div",{class:"card",onClick:t=>h.openPopup(e)},[Object(a["createElementVNode"])("p",c,Object(a["toDisplayString"])(e.name),1),Object(a["createElementVNode"])("div",l,[Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("span",s,"￥"+Object(a["toDisplayString"])(e.price&&e.price.toFixed(2)),1),e.unit?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",d,"/ "+Object(a["toDisplayString"])(e.unit),1)):Object(a["createCommentVNode"])("",!0),e.standard?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",u,Object(a["toDisplayString"])(e.standard),1)):Object(a["createCommentVNode"])("",!0)]),Object(a["createElementVNode"])("div",b,[Object(a["createVNode"])(v,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>h.changeCount(e,t),onClick:t[6]||(t[6]=Object(a["withModifiers"])(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","onOnChange"])])])],8,n)]),_:1},8,["getData","onOnUpdate"])]),Object(a["createVNode"])(V,{modelValue:m.showGoodModal,"onUpdate:modelValue":t[7]||(t[7]=e=>m.showGoodModal=e),detailData:m.detailData,onSave:h.reSearch},null,8,["modelValue","detailData","onSave"]),Object(a["createVNode"])(j,{show:m.showPopup,"onUpdate:show":t[8]||(t[8]=e=>m.showPopup=e),title:m.detailData.name,actions:m.actions,"cancel-text":"取消","close-on-click-action":"",onSelect:t[9]||(t[9]=e=>h.onSelect(e.type))},null,8,["show","title","actions"])])}o("3c65"),o("13d5");var m=o("23f9"),h=o("1fba"),f=o("e5f6"),O=o("450f");const[j,g]=Object(h["a"])("sidebar"),y=Symbol(j),v={modelValue:Object(f["c"])(0)};var w=Object(a["defineComponent"])({name:j,props:v,emits:["change","update:modelValue"],setup(e,{emit:t,slots:o}){const{linkChildren:r}=Object(O["useChildren"])(y),n=()=>+e.modelValue,c=e=>{e!==n()&&(t("update:modelValue",e),t("change",e))};return r({getActive:n,setActive:c}),()=>{var e;return Object(a["createVNode"])("div",{role:"tablist",class:g()},[null==(e=o.default)?void 0:e.call(o)])}}});const V=Object(m["a"])(w);var C=o("fa7c"),k=o("4e5e"),D=o("8be7");const[S,N]=Object(h["a"])("sidebar-item"),x=Object(C["a"])({},k["b"],{dot:Boolean,title:String,badge:f["f"],disabled:Boolean,badgeProps:Object});var B=Object(a["defineComponent"])({name:S,props:x,emits:["click"],setup(e,{emit:t,slots:o}){const r=Object(k["c"])(),{parent:n,index:c}=Object(O["useParent"])(y);if(!n)return void 0;const l=()=>{e.disabled||(t("click",c.value),n.setActive(c.value),r())};return()=>{const{dot:t,badge:r,title:i,disabled:s}=e,d=c.value===n.getActive();return Object(a["createVNode"])("div",{role:"tab",class:N({select:d,disabled:s}),tabindex:s?void 0:0,"aria-selected":d,onClick:l},[Object(a["createVNode"])(D["a"],Object(a["mergeProps"])({dot:t,class:N("text"),content:r},e.badgeProps),{default:()=>[o.title?o.title():i]})])}}});const _=Object(m["a"])(B);var P=o("eeb9"),E=o("2af9"),M=o("1f38"),I=o("267e"),U={name:"mobileGood",components:{[V.name]:V,[_.name]:_,viListScroll:E["g"],addGoodModal:M["a"]},data(){return{TYPE_MAP:I["b"],type:"",keyword:"",showGoodModal:!1,detailData:{},showPopup:!1,actions:[{name:"删除",type:"delete",color:"#f66161"},{name:"特价",type:"special",color:"#07c160"},{name:"修改",type:"change"}],showSort:!1,sortParams:{sortBy:"updateTime",order:"DESC"}}},computed:{showScan(){return location.href.startsWith("https")||location.href.startsWith("http://localhost")},sortActions(){const e=[{name:"修改时间倒序",sortBy:"updateTime",order:"DESC"},{name:"修改时间顺序",sortBy:"updateTime",order:"ASC"},{name:"价格倒序",sortBy:"price",order:"DESC"},{name:"价格顺序",sortBy:"price",order:"ASC"}];return e.map(e=>(this.sortParams.sortBy==e.sortBy&&this.sortParams.order==e.order&&(e.color="#2d8cf0"),e))}},methods:{sortChange({sortBy:e,order:t}){this.sortParams={sortBy:e,order:t},this.reSearch()},reSearch(){var e;null===(e=this.$refs.list)||void 0===e||e.reSearch()},getData(e){const t=["",...Object.keys(I["b"]),"其他"];return Object(P["m"])({...e,name:this.keyword,type:t[this.type],...this.sortParams})},updateData({rows:e,total:t}){this.$emit("total",t);const o=JSON.parse(sessionStorage.getItem("order")||"[]"),a={};o.forEach(e=>a[e.goodId]=e.count),e.forEach(e=>{e.originPrice=e.price||0,e.originUnit=e.unit,e.originStandard=e.standard,e.isBulk=Object(I["a"])(e),e.originIsBulk=Object(I["a"])(e),e.count=a[e.goodId]||0})},changeCount(e,t){const o=JSON.parse(sessionStorage.getItem("order")||"[]"),a=o.findIndex(t=>t.goodId===e.goodId),r={...e,...-1===a?{}:o[a],count:t};t?-1===a?o.unshift(r):o.splice(a,1,r):-1!==a&&o.splice(a,1),sessionStorage.setItem("order",JSON.stringify(o)),this.$EventBus.$emit("badge",{mobileCashier:o.reduce((e,t)=>e+ +t.count,0)})},deleteGood({goodId:e,name:t}){this.$Modal.confirm({title:"删除商品",content:`是否确认删除${t}？`,onOk:async()=>{try{const{returnCode:t,data:o}=await Object(P["c"])({goodIds:""+e})||{};0===t&&o&&(this.$Message.success("删除成功"),this.reSearch())}catch(t){this.$Message.error("删除失败："+(t.message||t))}}})},openPopup(e){this.detailData={...e},this.showPopup=!0},onSelect(e,t=this.detailData){"change"===e?(this.detailData={...t},this.showGoodModal=!0):"special"===e?this.$router.push({name:"mobileSpecial",state:{params:{goodId:t.goodId,name:t.name}}}):"delete"===e&&this.deleteGood(t)}},activated(){this.reSearch()}},$=(o("0244"),o("6b0d")),A=o.n($);const T=A()(U,[["render",p],["__scopeId","data-v-267d6b2c"]]);t["default"]=T},"69f1":function(e,t,o){}}]);