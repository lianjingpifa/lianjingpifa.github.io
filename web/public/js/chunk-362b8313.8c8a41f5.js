(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-362b8313"],{"083a":function(e,t,o){"use strict";var a=o("0d51"),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+a(t)+" of "+a(e))}},"0d74":function(e,t,o){},"21db":function(e,t,o){"use strict";o("0d74")},"29ed":function(e,t,o){},"3c65":function(e,t,o){"use strict";var a=o("23e7"),r=o("7b0b"),c=o("07fa"),s=o("3a34"),l=o("083a"),n=o("3511"),i=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},u=i||!d();a({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(e){var t=r(this),o=c(t),a=arguments.length;if(a){n(o+a);var i=o;while(i--){var d=i+a;i in t?t[d]=t[i]:l(t,d)}for(var u=0;u<a;u++)t[u]=arguments[u]}return s(t,o+a)}})},"7c62":function(e,t,o){"use strict";o("29ed")},df0a:function(e,t,o){"use strict";o.r(t);var a=o("7a23");const r=e=>(Object(a["pushScopeId"])("data-v-3159b0a8"),e=e(),Object(a["popScopeId"])(),e),c={class:"container"},s={class:"list"},l={class:"card"},n={class:"card-top"},i={class:"title"},d={class:"card-middle"},u=["onClick"],m={class:"flex-ac"},b=r(()=>Object(a["createElementVNode"])("label",{class:"f-16 mr-5"},"￥",-1)),h=r(()=>Object(a["createElementVNode"])("label",{class:"f-16 ml-10 mr-10"}," / ",-1)),p={class:"flex-ac"},O={class:"bottom-box"},j={class:"total"},f={class:"btn-box"};function g(e,t,o,r,g,v){const V=Object(a["resolveComponent"])("Spin"),U=Object(a["resolveComponent"])("Icon"),k=Object(a["resolveComponent"])("van-cell"),C=Object(a["resolveComponent"])("userSelect"),N=Object(a["resolveComponent"])("viEmpty"),w=Object(a["resolveComponent"])("viInputNumber"),I=Object(a["resolveComponent"])("viInput"),y=Object(a["resolveComponent"])("van-field"),x=Object(a["resolveComponent"])("van-radio"),L=Object(a["resolveComponent"])("van-radio-group"),B=Object(a["resolveComponent"])("Button"),E=Object(a["resolveComponent"])("van-swipe-cell"),$=Object(a["resolveComponent"])("viPrint");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",c,[Object(a["createVNode"])(V,{fix:"",show:g.saveLoading},null,8,["show"]),g.curOrderId?(Object(a["openBlock"])(),Object(a["createBlock"])(k,{key:0,title:"订单编号",value:g.curOrderId,class:"flex-none"},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(U,{type:"md-close",size:"25",onClick:v.deleteOrderId,class:"vi-link-text ml-10"},null,8,["onClick"])]),_:1},8,["value"])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(k,{title:"客户名称",value:v.curUser.name,onClick:t[0]||(t[0]=e=>g.showUserSelect=!0),"is-link":"",class:"user-select"},null,8,["value"]),Object(a["createVNode"])(C,{modelValue:g.showUserSelect,"onUpdate:modelValue":t[1]||(t[1]=e=>g.showUserSelect=e),userId:g.curUserId,"onUpdate:userId":t[2]||(t[2]=e=>g.curUserId=e),allUsers:g.allUsers},null,8,["modelValue","userId","allUsers"]),Object(a["createElementVNode"])("div",s,[g.goodList.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(N,{key:0})),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(g.goodList,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(E,{key:t},{right:Object(a["withCtx"])(()=>[Object(a["createVNode"])(B,{type:"error",onClick:t=>v.changeCount(e,0)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("删除")]),_:2},1032,["onClick"])]),default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",l,[Object(a["createElementVNode"])("div",n,[Object(a["createElementVNode"])("p",i,Object(a["toDisplayString"])(e.name),1),Object(a["createVNode"])(w,{modelValue:e.count,"onUpdate:modelValue":t=>e.count=t,integer:"",min:0,onOnChange:t=>v.changeCount(e,t),class:"count-input"},null,8,["modelValue","onUpdate:modelValue","onOnChange"])]),Object(a["createElementVNode"])("div",d,[e.price!=e.originPrice&&e.unit==e.originUnit&&e.standard==e.originStandard&&e.isBulk==e.originIsBulk?(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{key:0,onClick:t=>e.price=e.originPrice,class:"origin"},[Object(a["createTextVNode"])("￥ "),Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.originPrice),1)],8,u)):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",m,[b,Object(a["createVNode"])(w,{modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,min:0,step:.5,class:"count-input"},null,8,["modelValue","onUpdate:modelValue"]),h,Object(a["createVNode"])(I,{modelValue:e.unit,"onUpdate:modelValue":t=>e.unit=t,placeholder:"单位",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),Object(a["createVNode"])(I,{modelValue:e.standard,"onUpdate:modelValue":t=>e.standard=t,placeholder:"规格",class:"flex-1 ml-10"},null,8,["modelValue","onUpdate:modelValue"])])]),Object(a["createElementVNode"])("div",p,[Object(a["createVNode"])(y,{modelValue:e.remarks,"onUpdate:modelValue":t=>e.remarks=t,label:"备注：","label-width":"50",clearable:"",placeholder:"备注，有就填"},null,8,["modelValue","onUpdate:modelValue"]),Object(a["createVNode"])(L,{"model-value":e.isBulk,class:"flex-none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(x,{name:!0,onClick:t=>e.isBulk=!e.isBulk},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("散装")]),_:2},1032,["onClick"])]),_:2},1032,["model-value"])])])]),_:2},1024))),128))]),Object(a["createElementVNode"])("div",O,[Object(a["createElementVNode"])("p",j,"总计：￥"+Object(a["toDisplayString"])(g.totalPrice),1),Object(a["createElementVNode"])("div",f,[Object(a["createVNode"])(B,{type:"error",onClick:t[3]||(t[3]=e=>v.clearAll()),long:"",size:"large",shape:"circle"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("清空商品")]),_:1}),Object(a["createVNode"])(B,{onClick:t[4]||(t[4]=e=>v.saveOrder("1")),long:"",size:"large",shape:"circle",class:"ml-10"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("保存草稿")]),_:1}),Object(a["createVNode"])($,{list:g.goodList,total:g.totalPrice,"user-data":v.curUser,size:"large",long:"",shape:"circle",onPrint:t[5]||(t[5]=e=>v.saveOrder("2"))},null,8,["list","total","user-data"])])])])}o("13d5"),o("3c65");var v=o("f23a"),V=o("e84a"),U=o("2af9");const k={class:"flex-ac"},C={class:"user-list"};function N(e,t,o,r,c,s){const l=Object(a["resolveComponent"])("Spin"),n=Object(a["resolveComponent"])("van-field"),i=Object(a["resolveComponent"])("Icon"),d=Object(a["resolveComponent"])("viEmpty"),u=Object(a["resolveComponent"])("van-radio"),m=Object(a["resolveComponent"])("van-cell"),b=Object(a["resolveComponent"])("van-radio-group"),h=Object(a["resolveComponent"])("van-action-sheet");return Object(a["openBlock"])(),Object(a["createBlock"])(h,{show:s.showModal,"onUpdate:show":t[3]||(t[3]=e=>s.showModal=e),title:"选择客户"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{fix:"",show:c.newUserLoading},null,8,["show"]),Object(a["createElementVNode"])("div",k,[Object(a["createVNode"])(n,{modelValue:c.newUserName,"onUpdate:modelValue":t[0]||(t[0]=e=>c.newUserName=e),label:"没有？快速新增：","label-width":"120",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(a["createVNode"])(i,{type:"ios-checkmark-circle-outline",color:"green",size:"30",class:"mr-10",onClick:s.confirmAddUser},null,8,["onClick"])]),Object(a["createVNode"])(n,{modelValue:c.filterName,"onUpdate:modelValue":t[1]||(t[1]=e=>c.filterName=e),label:"过滤客户：","label-width":"80",clearable:"",placeholder:"客户名称"},null,8,["modelValue"]),Object(a["createElementVNode"])("div",C,[Object(a["createVNode"])(b,{modelValue:s.curUserId,"onUpdate:modelValue":t[2]||(t[2]=e=>s.curUserId=e)},{default:Object(a["withCtx"])(()=>[s.filterUsers.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(d,{key:0})),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(s.filterUsers,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(m,{key:e.userId,title:`${e.name}${e.remarks?`（${e.remarks}）`:""}`,clickable:"",onClick:t=>s.selectUser(e)},{"right-icon":Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{name:e.userId},null,8,["name"])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["show"])}var w=o("eeb9"),I={name:"userSelect",components:{[v["a"].name]:v["a"]},props:{modelValue:{type:Boolean,default:!1},allUsers:{type:Array,default(){return[]}},userId:{type:[Number,String],default:""}},data(){return{filterName:"",newUserName:"",newUserLoading:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},curUserId:{get(){return this.userId},set(e){this.$emit("update:userId",e)}},filterUsers(){return this.allUsers.filter(e=>!this.filterName||e.name.includes(this.filterName))}},methods:{selectUser(e){this.curUserId=e.userId,this.newUserName="",this.showModal=!1},async confirmAddUser(){if(this.newUserName)try{this.newUserLoading=!0;const{data:e}=await Object(w["A"])({name:this.newUserName})||{};if(e)return this.$Message.success("名称已存在\n已选择"),void this.selectUser(e);const{data:t}=await Object(w["y"])({name:this.newUserName})||{};t&&(this.$Message.success("新增成功"),this.selectUser(t))}catch(e){this.$Message.error("新增客户失败："+(e.message||e))}finally{this.newUserLoading=!1}else this.$Message.info("请输入要新增的客户名称")}}},y=(o("21db"),o("6b0d")),x=o.n(y);const L=x()(I,[["render",N],["__scopeId","data-v-0171d196"]]);var B=L,E={name:"mobileCashier",components:{[v["a"].name]:v["a"],[V["a"].name]:V["a"],viPrint:U["i"],userSelect:B},data(){return{allUsers:[],curUserId:"",curOrderId:"",goodList:[],totalPrice:"0.00",saveLoading:!1,showUserSelect:!1}},watch:{goodList:{deep:!0,handler(e){this.totalPrice=(e.reduce((e,t)=>e+ +(t.count*t.price).toFixed(2),0)||0).toFixed(2),this.$EventBus.$emit("badge",{mobileCashier:e.reduce((e,t)=>e+ +t.count,0)}),sessionStorage.setItem("order",JSON.stringify(e))}},$route:{deep:!0,immediate:!0,handler({name:e}){if("mobileCashier"!==e)return;const{params:t={}}=history.state;Object.keys(t).length&&(this.goodList.length?this.$Modal.confirm({title:"编辑确认",content:"页面存在草稿数据，是否删除草稿，显示订单内容",onOk:()=>{this.initData(t)}}):this.initData(t))}},curUserId(e){this.changeUser(e)}},computed:{curUser(){return this.allUsers.find(e=>e.userId==this.curUserId)||{}}},methods:{initData(e){this.curUserId=e.userId?+e.userId:"",this.curOrderId=e.orderId||"",this.$nextTick(()=>{this.goodList=JSON.parse(e.goodList||"[]").map(t=>("copy"===e.type&&(t.price=t.originPrice),t)),history.state.params={}})},deleteOrderId(){this.$Modal.confirm({title:"重建订单",content:"是否确认重建订单？",onOk:()=>{this.curOrderId=""}})},clearAll(e){e?this.goodList=[]:this.$Modal.confirm({title:"清空商品",content:"是否确认清空所有商品？",onOk:()=>{this.goodList=[]}})},changeCount(e,t){const o=[...this.goodList],a=o.findIndex(t=>t.goodId===e.goodId);t?(-1===a?o.unshift({...e}):o.splice(a,1,{...e}),this.goodList=o):-1!==a&&this.$Modal.confirm({title:"删除商品",content:`确认删除${e.name}?`,onOk:()=>{o.splice(a,1),this.goodList=o},onCancel:()=>{this.goodList[a]={...e,count:++t}}})},async saveOrder(e){if("1"==e&&!this.curUserId)return this.$Message.info("请填写客户名称");if("2"!=e||this.curUserId)try{this.saveLoading=!0;const{returnCode:t,data:o}=await Object(w["w"])({orderId:this.curOrderId||void 0,userId:this.curUserId,status:e,total:this.totalPrice,detail:JSON.stringify(this.goodList)})||{};0===t&&o&&(this.$Message.success("保存成功"),this.$EventBus.$emit("saveOrder"),this.clearAll(!0),this.curUserId="",this.curOrderId="",this.getUsersList())}catch(t){this.$Message.error("保存草稿失败："+(t.message||t))}finally{this.saveLoading=!1}},changeUser(){const{special:e={}}=this.curUser;this.goodList=this.goodList.map(t=>(t.unit===t.originUnit&&t.standard===t.originStandard?t.price=e[t.goodId]||t.originPrice:t.price=t.originPrice,t))},async getUsersList(){try{const{returnCode:e,data:t}=await Object(w["h"])()||{};0===e&&(this.allUsers=t&&t.map(e=>{const t={};return e.special.forEach(e=>{t[e.goodId]=+e.price}),e.special=t,e})||[])}catch(e){this.$Message.error("获取客户列表失败："+(e.message||e))}}},activated(){this.goodList=JSON.parse(sessionStorage.getItem("order")||"[]"),this.getUsersList()}};o("7c62");const $=x()(E,[["render",g],["__scopeId","data-v-3159b0a8"]]);t["default"]=$},e84a:function(e,t,o){"use strict";o.d(t,"a",(function(){return f}));var a=o("23f9"),r=o("7a23"),c=o("1fba"),s=o("e5f6"),l=o("fa7c"),n=o("8db7"),i=o("5aa0"),d=o("9b55"),u=o("450f"),m=o("d7d5"),b=o("efd9");const[h,p]=Object(c["a"])("swipe-cell"),O={name:Object(s["c"])(""),disabled:Boolean,leftWidth:s["f"],rightWidth:s["f"],beforeClose:Function,stopPropagation:Boolean};var j=Object(r["defineComponent"])({name:h,props:O,emits:["open","close","click"],setup(e,{emit:t,slots:o}){let a,c,s,h;const O=Object(r["ref"])(),j=Object(r["ref"])(),f=Object(r["ref"])(),g=Object(r["reactive"])({offset:0,dragging:!1}),v=Object(m["a"])(),V=e=>e.value?Object(u["useRect"])(e).width:0,U=Object(r["computed"])(()=>Object(l["e"])(e.leftWidth)?+e.leftWidth:V(j)),k=Object(r["computed"])(()=>Object(l["e"])(e.rightWidth)?+e.rightWidth:V(f)),C=o=>{g.offset="left"===o?U.value:-k.value,a||(a=!0,t("open",{name:e.name,position:o}))},N=o=>{g.offset=0,a&&(a=!1,t("close",{name:e.name,position:o}))},w=e=>{const t=Math.abs(g.offset),o=.15,r=a?1-o:o,c="left"===e?U.value:k.value;c&&t>c*r?C(e):N(e)},I=t=>{e.disabled||(s=g.offset,v.start(t))},y=t=>{if(e.disabled)return;const{deltaX:o}=v;if(v.move(t),v.isHorizontal()){c=!0,g.dragging=!0;const r=!a||o.value*s<0;r&&Object(n["e"])(t,e.stopPropagation),g.offset=Object(i["d"])(o.value+s,-k.value,U.value)}},x=()=>{g.dragging&&(g.dragging=!1,w(g.offset>0?"left":"right"),setTimeout(()=>{c=!1},0))},L=(o="outside")=>{h||(t("click",o),a&&!c&&(h=!0,Object(d["a"])(e.beforeClose,{args:[{name:e.name,position:o}],done:()=>{h=!1,N(o)},canceled:()=>h=!1,error:()=>h=!1})))},B=(e,t)=>o=>{t&&o.stopPropagation(),L(e)},E=(e,t)=>{const a=o[e];if(a)return Object(r["createVNode"])("div",{ref:t,class:p(e),onClick:B(e,!0)},[a()])};return Object(b["a"])({open:C,close:N}),Object(u["useClickAway"])(O,()=>L("outside"),{eventName:"touchstart"}),Object(u["useEventListener"])("touchmove",y,{target:O}),()=>{var e;const t={transform:`translate3d(${g.offset}px, 0, 0)`,transitionDuration:g.dragging?"0s":".6s"};return Object(r["createVNode"])("div",{ref:O,class:p(),onClick:B("cell",c),onTouchstartPassive:I,onTouchend:x,onTouchcancel:x},[Object(r["createVNode"])("div",{class:p("wrapper"),style:t},[E("left",j),null==(e=o.default)?void 0:e.call(o),E("right",f)])])}}});const f=Object(a["a"])(j)}}]);
//# sourceMappingURL=chunk-362b8313.8c8a41f5.js.map