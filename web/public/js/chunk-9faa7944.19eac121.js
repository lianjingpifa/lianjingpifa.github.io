(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9faa7944"],{2410:function(e,t,a){(function(t){var a=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var a,o,n;try{a=Map}catch(s){a=function(){}}try{o=Set}catch(s){o=function(){}}try{n=Promise}catch(s){n=function(){}}function l(c,r,u,i,s){"object"===typeof r&&(u=r.depth,i=r.prototype,s=r.includeNonEnumerable,r=r.circular);var b=[],f=[],m="undefined"!=typeof t;function p(c,u){if(null===c)return null;if(0===u)return c;var O,j;if("object"!=typeof c)return c;if(e(c,a))O=new a;else if(e(c,o))O=new o;else if(e(c,n))O=new n((function(e,t){c.then((function(t){e(p(t,u-1))}),(function(e){t(p(e,u-1))}))}));else if(l.__isArray(c))O=[];else if(l.__isRegExp(c))O=new RegExp(c.source,d(c)),c.lastIndex&&(O.lastIndex=c.lastIndex);else if(l.__isDate(c))O=new Date(c.getTime());else{if(m&&t.isBuffer(c))return O=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(O),O;e(c,Error)?O=Object.create(c):"undefined"==typeof i?(j=Object.getPrototypeOf(c),O=Object.create(j)):(O=Object.create(i),j=i)}if(r){var v=b.indexOf(c);if(-1!=v)return f[v];b.push(c),f.push(O)}for(var h in e(c,a)&&c.forEach((function(e,t){var a=p(t,u-1),o=p(e,u-1);O.set(a,o)})),e(c,o)&&c.forEach((function(e){var t=p(e,u-1);O.add(t)})),c){var g;j&&(g=Object.getOwnPropertyDescriptor(j,h)),g&&null==g.set||(O[h]=p(c[h],u-1))}if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(c);for(h=0;h<y.length;h++){var x=y[h],w=Object.getOwnPropertyDescriptor(c,x);(!w||w.enumerable||s)&&(O[x]=p(c[x],u-1),w.enumerable||Object.defineProperty(O,x,{enumerable:!1}))}}if(s){var V=Object.getOwnPropertyNames(c);for(h=0;h<V.length;h++){var N=V[h];w=Object.getOwnPropertyDescriptor(c,N);w&&w.enumerable||(O[N]=p(c[N],u-1),Object.defineProperty(O,N,{enumerable:!1}))}}return O}return"undefined"==typeof r&&(r=!0),"undefined"==typeof u&&(u=1/0),p(c,u)}function c(e){return Object.prototype.toString.call(e)}function r(e){return"object"===typeof e&&"[object Date]"===c(e)}function u(e){return"object"===typeof e&&"[object Array]"===c(e)}function i(e){return"object"===typeof e&&"[object RegExp]"===c(e)}function d(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return l.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},l.__objToStr=c,l.__isDate=r,l.__isArray=u,l.__isRegExp=i,l.__getRegExpFlags=d,l}();e.exports&&(e.exports=a)}).call(this,a("b639").Buffer)},"35a8":function(e,t,a){},6504:function(e,t,a){"use strict";a.r(t);var o=a("8738"),n=(a("14d9"),a("7a23")),l=a("2af9"),c=a("eeb9");const r={grid:{bottom:15,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[],axisLabel:{rotate:10,fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"bar",name:"销售总量",barMaxWidth:30,barMinWidth:20,label:{show:!0,position:"top"}}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]},u={grid:{bottom:20,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"},position:(e,t,a,o,n)=>{let l={top:e[1]-n.contentSize[1]/2};return e[0]+n.contentSize[0]+20<n.viewSize[0]?l.left=e[0]+20:l.left=e[0]-n.contentSize[0]-20,l}},xAxis:{type:"category",data:[],axisLabel:{fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"line",name:"销售总量",symbol:"circle",symbolSize:10,smooth:!0}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]};var i=a("2410"),d=a.n(i),s=a("4360");const b=e=>(Object(n["pushScopeId"])("data-v-433d4648"),e=e(),Object(n["popScopeId"])(),e),f={class:"chart-box"},m={class:"chart-header"},p=b(()=>Object(n["createElementVNode"])("p",{class:"vi-title"},[Object(n["createTextVNode"])("商品销量排行榜"),Object(n["createElementVNode"])("span",{class:"vi-text-tip"},"（点击柱子进行趋势分析）")],-1)),O=b(()=>Object(n["createElementVNode"])("span",null,"排行范围：",-1)),j={class:"chart-box"},v={class:"chart-header"},h=b(()=>Object(n["createElementVNode"])("p",{class:"vi-title"},"商品销量趋势分析",-1)),g={class:"flex-none"};var y={__name:"index",setup(e){const t=Object(s["a"])(),a=Object(n["computed"])(()=>t.dictMap),i=Object(n["inject"])("$Message",()=>{}),b={shortcuts:[{text:"本周",value:()=>[(new Date).startOf("week"),new Date]},{text:"近7天",value:()=>[(new Date).subtract(7),new Date]},{text:"本月",value:()=>[(new Date).startOf("month"),new Date]},{text:"近30天",value:()=>[(new Date).subtract(30),new Date]},{text:"近90天",value:()=>[(new Date).subtract(90),new Date]},{text:"今年",value:()=>[(new Date).startOf("year"),new Date]},{text:"近一年",value:()=>[(new Date).subtract(365),new Date]},{text:"近三年",value:()=>[(new Date).subtract(1095),new Date]}]},y=Object(n["ref"])({timeRange:[]});function x(){const{timeRange:e,...t}=y.value,[a,o]=e;return{startTime:a&&new Date(a).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:o&&new Date(o).endOf("day").format("YYYY-MM-DD HH:mm:ss"),...t}}const w=Object(n["ref"])({}),V=Object(n["ref"])("month"),N=Object(n["ref"])([]),D=Object(n["ref"])(!1);function C(){if(!N.value.length)return void(w.value={});const e=d()(u);e.legend.data=N.value.map(({userName:e,goodName:t})=>`${e?e+"-":""}${t}`),e.xAxis.data=N.value[0].data.map(e=>e.date),e.series=N.value.map(({userName:t,goodName:a,data:o})=>({...e.series[0],name:`${t?t+"-":""}${a}`,data:o.map(e=>({...e,value:+(e.count||0)}))})),N.value[0].data.length<10&&(e.dataZoom=[]),w.value=e}function _(e){N.value.splice(e,1),C()}async function I(e=[],t=!0){try{D.value=!0;const{startTime:n,endTime:l}=x(),{returnCode:r,data:u}=await Object(c["x"])({startTime:n,endTime:l,lineType:V.value,list:e.filter(e=>e)})||{};if(0===r){const e="month"==V.value?"YYYY-MM":"YYYY-MM-DD";let n=(new Date).format(e),l=new Date(0).format(e);for(let t of u){var a,o;const e=(null===(a=t.data[0])||void 0===a?void 0:a.date)||n,c=(null===(o=t.data[t.data.length-1])||void 0===o?void 0:o.date)||n;e>l&&(l=e),c<n&&(n=c)}const c=[];for(let t=l,a=0;t>=n;a++)c.push(t),t="day"===V.value?new Date(t).subtract(1,"days").format("YYYY-MM-DD"):new Date(t).subtract(1,"months").format("YYYY-MM");u.forEach(e=>{e.data=c.map(t=>{const a=e.data.find(e=>e.date===t);return{date:t,count:a?+a.count:0}})}),N.value=t?u||[]:N.value.concat(u||[]),C()}}catch(n){i.error("获取商品销量趋势失败："+(n.message||n))}finally{D.value=!1}}const S=Object(n["ref"])({}),Y=Object(n["ref"])("1"),E=Object(n["ref"])("desc"),M=Object(n["ref"])([]),k=Object(n["ref"])(!1);function T(){if(!M.value.length)return void(S.value={});const e=d()(r);e.legend.data=M.value.map(e=>e.userName||"销售总量"),e.xAxis.data=M.value[0].data.map(e=>e.goodName),e.series=M.value.map(t=>{const a=t.data.map(e=>({userId:t.userId,userName:t.userName,goodId:e.goodId,goodName:e.goodName,value:+(e.count||0)}));return"asc"===E.value&&a.reverse(),{...e.series[0],name:t.userName||"销售总量",data:a}}),M.value[0].data.length<10&&(e.dataZoom=[],e.xAxis.axisLabel.rotate=0),S.value=e}async function z(){try{k.value=!0,D.value=!0;const e=x(),{returnCode:t,data:a}=await Object(c["w"])({...e,label:Y.value})||{};if(0===t){M.value=a||[],T();const e=M.value.map(({data:e})=>e[0]);I(e)}}catch(e){i.error("获取商品排行榜失败："+(e.message||e))}finally{k.value=!1}}function B(e){e.on("click",e=>{const{goodId:t,goodName:a,userId:o,userName:n}=e.data,l=N.value.findIndex(e=>e.goodId==t&&e.userId==o);-1===l?I([{goodId:t,goodName:a,userId:o,userName:n}],!1):(N.value.splice(l,1),C())})}return Object(n["onMounted"])(()=>{z()}),(e,t)=>{const r=Object(n["resolveComponent"])("FormItem"),u=Object(n["resolveComponent"])("viSearchForm"),i=Object(n["resolveComponent"])("Spin"),d=Object(n["resolveComponent"])("Option"),s=Object(n["resolveComponent"])("viSelect"),x=Object(n["resolveComponent"])("Icon"),C=Object(n["resolveComponent"])("Button"),W=Object(n["resolveComponent"])("Radio"),P=Object(n["resolveComponent"])("RadioGroup"),R=Object(n["resolveComponent"])("viLayoutUpDown");return Object(n["openBlock"])(),Object(n["createBlock"])(R,null,{up:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e),onSearch:z},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(r,{label:"商品范围:",prop:"goodIds"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Object(n["unref"])(l["d"]),{modelValue:y.value.goodIds,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value.goodIds=e),getData:Object(n["unref"])(c["s"]),valueKey:"goodId",multiple:"",filterable:"",class:"fuzzy-width"},null,8,["modelValue","getData"])]),_:1}),Object(n["createVNode"])(r,{label:"客户范围:",prop:"userIds"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Object(n["unref"])(l["d"]),{modelValue:y.value.userIds,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value.userIds=e),getData:Object(n["unref"])(c["y"]),valueKey:"userId",multiple:"",filterable:"",class:"fuzzy-width"},null,8,["modelValue","getData"])]),_:1}),Object(n["createVNode"])(r,{label:"时间范围:",prop:"timeRange"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Object(n["unref"])(o["a"]),{modelValue:y.value.timeRange,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value.timeRange=e),type:"daterange",options:b,placeholder:"请选择",class:"stat-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),down:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",f,[Object(n["createVNode"])(i,{fix:"",show:k.value},null,8,["show"]),Object(n["createElementVNode"])("div",m,[p,Object(n["createElementVNode"])("div",null,[O,Object(n["createVNode"])(s,{modelValue:Y.value,"onUpdate:modelValue":t[4]||(t[4]=e=>Y.value=e),transfer:"",onOnChange:z,class:"vi-width"},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.value.good,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:t,value:e.id},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128)),Object(n["createVNode"])(d,{value:"其他"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue"]),Object(n["createVNode"])(s,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=e=>E.value=e),transfer:"",clearable:!1,onOnChange:T,class:"vi-width ml-10"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{value:"desc"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("倒序")]),_:1}),Object(n["createVNode"])(d,{value:"asc"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("升序")]),_:1})]),_:1},8,["modelValue"])])]),Object(n["createVNode"])(Object(n["unref"])(l["b"]),{options:S.value,onOnMount:B,class:"chart-content"},null,8,["options"])]),Object(n["createElementVNode"])("div",j,[Object(n["createVNode"])(i,{fix:"",show:D.value},null,8,["show"]),Object(n["createElementVNode"])("div",v,[h,Object(n["createElementVNode"])("p",{class:"line-legend",ref:"list",onWheel:t[6]||(t[6]=t=>e.$refs.list.scrollLeft+=t.deltaY)},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(N.value,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:t},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.userId?e.userName+"-":"")+Object(n["toDisplayString"])(e.goodName)+" ",1),Object(n["createVNode"])(x,{type:"md-close",size:"16",onClick:e=>_(t),class:"vi-link-pointer mr-5"},null,8,["onClick"])]))),128))],544),Object(n["createElementVNode"])("div",g,[Object(n["createVNode"])(C,{class:"mr-15",onClick:t[7]||(t[7]=e=>I(M.value.map(({data:e})=>e[0])))},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("重置")]),_:1}),Object(n["createVNode"])(P,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=e=>V.value=e),type:"button","button-style":"solid",onOnChange:t[9]||(t[9]=e=>I(N.value))},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(W,{label:"month"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("按月")]),_:1}),Object(n["createVNode"])(W,{label:"day"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("按天")]),_:1})]),_:1},8,["modelValue"])])]),Object(n["createVNode"])(Object(n["unref"])(l["b"]),{options:w.value,class:"chart-content"},null,8,["options"])])]),_:1})}}},x=(a("69d4"),a("6b0d")),w=a.n(x);const V=w()(y,[["__scopeId","data-v-433d4648"]]);t["default"]=V},"69d4":function(e,t,a){"use strict";a("35a8")}}]);