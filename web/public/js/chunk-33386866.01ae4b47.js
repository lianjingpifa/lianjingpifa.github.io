(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33386866"],{"1f38":function(e,t,o){"use strict";var a=o("7a23");function r(e,t,o,r,l,c){const n=Object(a["resolveComponent"])("viInput"),s=Object(a["resolveComponent"])("FormItem"),d=Object(a["resolveComponent"])("viInputNumber"),i=Object(a["resolveComponent"])("Radio"),u=Object(a["resolveComponent"])("RadioGroup"),p=Object(a["resolveComponent"])("Form"),m=Object(a["resolveComponent"])("Button"),b=Object(a["resolveComponent"])("Modal");return Object(a["openBlock"])(),Object(a["createBlock"])(b,{title:c.title,modelValue:c.showModal,"onUpdate:modelValue":t[7]||(t[7]=e=>c.showModal=e),width:400,"class-name":"vertical-center-modal"},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m,{type:"text",onClick:t[6]||(t[6]=e=>c.showModal=!1)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("取消")]),_:1}),Object(a["createVNode"])(m,{type:"primary",onClick:c.submit,loading:l.loading},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("确定")]),_:1},8,["onClick","loading"])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{ref:"form",model:l.formData,rules:l.rules,"label-width":60,onKeydown:Object(a["withKeys"])(c.submit,["enter"]),class:"plr"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{label:"名称:",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:l.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.formData.name=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(s,{label:"规格:",prop:"standard"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:l.formData.standard,"onUpdate:modelValue":t[1]||(t[1]=e=>l.formData.standard=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(s,{label:"单位:",prop:"unit"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(n,{modelValue:l.formData.unit,"onUpdate:modelValue":t[2]||(t[2]=e=>l.formData.unit=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(s,{label:"单价:",prop:"price"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,{modelValue:l.formData.price,"onUpdate:modelValue":t[3]||(t[3]=e=>l.formData.price=e),min:0,step:.5},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(s,{label:"种类:",prop:"type"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{modelValue:l.formData.type,"onUpdate:modelValue":t[4]||(t[4]=e=>l.formData.type=e)},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(l.TYPE_MAP,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:t,label:t},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.showCount?(Object(a["openBlock"])(),Object(a["createBlock"])(s,{key:0,label:"数量:",prop:"count"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,{modelValue:l.formData.count,"onUpdate:modelValue":t[5]||(t[5]=e=>l.formData.count=e),integer:"",min:0},null,8,["modelValue"])]),_:1})):Object(a["createCommentVNode"])("",!0)]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["title","modelValue"])}o("d9e2");var l=o("eeb9"),c=o("267e"),n=o("2410"),s=o.n(n),d={name:"addGoodModal",props:{modelValue:{type:Boolean,default:!1},detailData:{type:Object,default(){return{}}},showCount:{type:Boolean,default:!1}},data(){const e=async(e,t,o)=>{if(t&&this.detailData.name!==this.formData.name){const{data:e}=await Object(l["z"])({name:t})||{};if(e)return o(new Error("该商品名称已存在"))}o()};return{TYPE_MAP:c["b"],formData:{},rules:{name:[{required:!0,message:"请输入商品名称"},{validator:e,trigger:"blur"}]},loading:!1}},computed:{title(){return(this.detailData.goodId?"编辑":"新增")+"商品"},showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}}},watch:{detailData:{deep:!0,handler(){this.$refs.form.resetFields(),this.formData=s()(this.detailData)}}},methods:{submit(){this.loading=!0,this.$refs.form.validate(async e=>{if(!e)return this.$Message.error("数据校验不通过"),void(this.loading=!1);try{const{_index:e,_rowKey:t,count:o,...a}=this.formData,{data:r}=await Object(l["v"])(a)||{};r&&(this.$Message.success(this.title+"成功"),this.$emit("save",{...this.formData}),this.$refs.form.resetFields(),this.showModal=!1)}catch(t){this.$Message.error("请求失败："+(t.message||t))}finally{this.loading=!1}})}}},i=o("6b0d"),u=o.n(i);const p=u()(d,[["render",r]]);t["a"]=p},"21b9":function(e,t,o){},2410:function(e,t,o){(function(t){var o=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var o,a,r;try{o=Map}catch(u){o=function(){}}try{a=Set}catch(u){a=function(){}}try{r=Promise}catch(u){r=function(){}}function l(c,n,s,d,u){"object"===typeof n&&(s=n.depth,d=n.prototype,u=n.includeNonEnumerable,n=n.circular);var p=[],m=[],b="undefined"!=typeof t;function h(c,s){if(null===c)return null;if(0===s)return c;var O,j;if("object"!=typeof c)return c;if(e(c,o))O=new o;else if(e(c,a))O=new a;else if(e(c,r))O=new r((function(e,t){c.then((function(t){e(h(t,s-1))}),(function(e){t(h(e,s-1))}))}));else if(l.__isArray(c))O=[];else if(l.__isRegExp(c))O=new RegExp(c.source,i(c)),c.lastIndex&&(O.lastIndex=c.lastIndex);else if(l.__isDate(c))O=new Date(c.getTime());else{if(b&&t.isBuffer(c))return O=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(O),O;e(c,Error)?O=Object.create(c):"undefined"==typeof d?(j=Object.getPrototypeOf(c),O=Object.create(j)):(O=Object.create(d),j=d)}if(n){var f=p.indexOf(c);if(-1!=f)return m[f];p.push(c),m.push(O)}for(var g in e(c,o)&&c.forEach((function(e,t){var o=h(t,s-1),a=h(e,s-1);O.set(o,a)})),e(c,a)&&c.forEach((function(e){var t=h(e,s-1);O.add(t)})),c){var w;j&&(w=Object.getOwnPropertyDescriptor(j,g)),w&&null==w.set||(O[g]=h(c[g],s-1))}if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(c);for(g=0;g<V.length;g++){var C=V[g],y=Object.getOwnPropertyDescriptor(c,C);(!y||y.enumerable||u)&&(O[C]=h(c[C],s-1),y.enumerable||Object.defineProperty(O,C,{enumerable:!1}))}}if(u){var x=Object.getOwnPropertyNames(c);for(g=0;g<x.length;g++){var v=x[g];y=Object.getOwnPropertyDescriptor(c,v);y&&y.enumerable||(O[v]=h(c[v],s-1),Object.defineProperty(O,v,{enumerable:!1}))}}return O}return"undefined"==typeof n&&(n=!0),"undefined"==typeof s&&(s=1/0),h(c,s)}function c(e){return Object.prototype.toString.call(e)}function n(e){return"object"===typeof e&&"[object Date]"===c(e)}function s(e){return"object"===typeof e&&"[object Array]"===c(e)}function d(e){return"object"===typeof e&&"[object RegExp]"===c(e)}function i(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return l.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},l.__objToStr=c,l.__isDate=n,l.__isArray=s,l.__isRegExp=d,l.__getRegExpFlags=i,l}();e.exports&&(e.exports=o)}).call(this,o("b639").Buffer)},"267e":function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"a",(function(){return r}));const a={1:"整件",99:"散装"},r=e=>"99"==e.type},"44c1":function(e,t,o){"use strict";o("21b9")},6746:function(e,t,o){"use strict";o.r(t);var a=o("7a23");const r=["onClick"],l=["onClick"],c=["onClick"];function n(e,t,o,n,s,d){const i=Object(a["resolveComponent"])("viInput"),u=Object(a["resolveComponent"])("FormItem"),p=Object(a["resolveComponent"])("Radio"),m=Object(a["resolveComponent"])("RadioGroup"),b=Object(a["resolveComponent"])("Button"),h=Object(a["resolveComponent"])("viSearchForm"),O=Object(a["resolveComponent"])("viTablePage"),j=Object(a["resolveComponent"])("add-good-modal"),f=Object(a["resolveComponent"])("specialMngModal"),g=Object(a["resolveComponent"])("template-import-goods"),w=Object(a["resolveComponent"])("viLayoutUpDown");return Object(a["openBlock"])(),Object(a["createBlock"])(w,null,{up:Object(a["withCtx"])(()=>[Object(a["createVNode"])(h,{modelValue:s.searchData,"onUpdate:modelValue":t[5]||(t[5]=e=>s.searchData=e),onSearch:d.reSearch},{extral:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,{type:"primary",onClick:t[2]||(t[2]=e=>d.changeModal()),class:"ml-10"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("新增")]),_:1}),Object(a["createVNode"])(b,{type:"error",onClick:t[3]||(t[3]=e=>d.deleteData()),class:"ml-10"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("批量删除")]),_:1}),Object(a["createVNode"])(b,{onClick:d.exportData,loading:s.exportLoading,class:"ml-10"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("导出")]),_:1},8,["onClick","loading"]),Object(a["createVNode"])(b,{type:"primary",onClick:t[4]||(t[4]=e=>s.showImport=!0),class:"ml-10"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("批量导入")]),_:1})]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{label:"商品名称:",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:s.searchData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>s.searchData.name=e)},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(u,{label:"商品种类:",prop:"type"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m,{modelValue:s.searchData.type,"onUpdate:modelValue":t[1]||(t[1]=e=>s.searchData.type=e)},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{label:""},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("全部")]),_:1}),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(s.TYPE_MAP,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(p,{key:t,label:t},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e),1)]),_:2},1032,["label"]))),128)),Object(a["createVNode"])(p,{label:"其他"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onSearch"])]),down:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,{ref:"table",columns:s.columns,getData:d.getData,addSelect:"",addIndex:"",onOnSelectionChange:t[6]||(t[6]=e=>s.selected=e),onOnSortChange:d.sortChange},{operate:Object(a["withCtx"])(({row:e})=>[Object(a["createElementVNode"])("a",{onClick:t=>d.openSpecialMng(e),class:"vi-green-pointer"},"特价",8,r),Object(a["createElementVNode"])("a",{onClick:t=>d.changeModal(e),class:"ml-10"},"修改",8,l),Object(a["createElementVNode"])("a",{onClick:t=>d.deleteData([e]),class:"ml-10 vi-red-pointer"},"删除",8,c)]),_:1},8,["columns","getData","onOnSortChange"]),Object(a["createVNode"])(j,{modelValue:s.showGoodModal,"onUpdate:modelValue":t[7]||(t[7]=e=>s.showGoodModal=e),detailData:s.detailData,onSave:d.reSearch},null,8,["modelValue","detailData","onSave"]),Object(a["createVNode"])(f,{modelValue:s.showSpecialModal,"onUpdate:modelValue":t[8]||(t[8]=e=>s.showSpecialModal=e),curRow:s.detailData},null,8,["modelValue","curRow"]),Object(a["createVNode"])(g,{modelValue:s.showImport,"onUpdate:modelValue":t[9]||(t[9]=e=>s.showImport=e),onSave:d.reSearch},null,8,["modelValue","onSave"])]),_:1})}var s=o("eeb9"),d=o("1f38"),i=o("e903"),u=o("267e");const p=e=>(Object(a["pushScopeId"])("data-v-4086cce6"),e=e(),Object(a["popScopeId"])(),e),m={class:"pt-20 pb-20"},b=p(()=>Object(a["createElementVNode"])("p",null,"点击或者拖拽文件上传",-1)),h={class:"mt-10"},O={class:"upload-msg",ref:"uploadMsg"},j={key:0};function f(e,t,o,r,l,c){const n=Object(a["resolveComponent"])("Icon"),s=Object(a["resolveComponent"])("Upload"),d=Object(a["resolveComponent"])("Checkbox"),i=Object(a["resolveComponent"])("Button"),u=Object(a["resolveComponent"])("Modal");return Object(a["openBlock"])(),Object(a["createBlock"])(u,{title:"批量导入商品",modelValue:c.showModal,"onUpdate:modelValue":t[2]||(t[2]=e=>c.showModal=e),width:500,draggable:"",sticky:"",scrollable:"",mask:!1},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{type:"text",onClick:t[1]||(t[1]=e=>c.showModal=!1)},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("取消")]),_:1}),Object(a["createVNode"])(i,{type:"primary",onClick:c.exportTemplate},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("模板下载")]),_:1},8,["onClick"])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{type:"drag",action:l.importGoods,headers:l.headers,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",format:["xlsx"],"show-upload-list":!1,"before-upload":c.beforeUpload,"on-success":c.onSuccess,"on-error":c.onError},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",m,[Object(a["createVNode"])(n,{type:"ios-cloud-upload",size:"52",style:{color:"#3399ff"}}),b])]),_:1},8,["action","headers","before-upload","on-success","on-error"]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",h,[Object(a["createElementVNode"])("p",null,[Object(a["createElementVNode"])("span",null,"导入文件名："+Object(a["toDisplayString"])(l.uploadName),1),Object(a["createVNode"])(d,{modelValue:l.showError,"onUpdate:modelValue":t[0]||(t[0]=e=>l.showError=e),class:"fr"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("只看错误信息")]),_:1},8,["modelValue"])]),Object(a["createElementVNode"])("div",O,[c.msgList.length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",j,Object(a["toDisplayString"])(l.showError?"【无】":"【正在导入中】"),1)),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(c.msgList,(e,t)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{key:t},[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])({"vi-red-text":1==e.status,"vi-green-text":[0,2,10].includes(e.status)})},Object(a["toDisplayString"])(e.mes),3)]))),128))],512)],512),[[a["vShow"],l.uploadId]])]),_:1},8,["modelValue"])}var g=o("8451"),w=o("ec16"),V=(o("3c65"),{name:"templateImportGoods",components:{Upload:w["a"],Checkbox:g["a"]},props:{modelValue:{type:Boolean,default:!1}},data(){return{importGoods:s["q"],headers:{authorization:sessionStorage.getItem("authorization")},uploadId:"",uploadName:"",uploadMsg:[],showError:!1}},computed:{showModal:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),e||this.$emit("close")}},msgList(){return this.uploadMsg.filter(e=>!this.showError||this.showError&&1==e.status)}},methods:{exportTemplate(){Object(s["e"])({goodIds:"下载模板"},`商品模板${(new Date).format("YYYYMMDDHHmmss")}.xlsx`)},beforeUpload(){return this.uploadId="",this.uploadName="",this.uploadMsg=[],!0},onSuccess(e,t){0==e.returnCode?(this.uploadName=t.name,e.data&&e.data.length?(this.uploadId=e.data[0].id,this.uploadMsg=e.data||[],this.$Message.success("导入成功"),this.$emit("save")):this.$Message.success("上传成功，开始导入")):this.$Message.error("上传失败："+e.returnMsg)},onError(e){this.$Message.error("上传失败："+(e.message||e))},batchImportGoods(e){if(0!==e.status||this.uploadId){if(e.id===this.uploadId){const t=this.uploadMsg.findIndex(t=>t.index<e.index);-1===t?this.uploadMsg.unshift(e):this.uploadMsg.splice(t,0,e),10==e.status&&this.$emit("save")}}else this.uploadId=e.id,this.uploadMsg=[e]}},mounted(){this.$EventBus.$on("batchImportGoods",this.batchImportGoods)},beforeMount(){this.$EventBus.$off("batchImportGoods",this.batchImportGoods)}}),C=(o("44c1"),o("6b0d")),y=o.n(C);const x=y()(V,[["render",f],["__scopeId","data-v-4086cce6"]]);var v=x,D={name:"goodMng",components:{addGoodModal:d["a"],specialMngModal:i["a"],templateImportGoods:v},data(){return{TYPE_MAP:u["b"],searchData:{type:""},sortParams:{},showGoodModal:!1,detailData:{},columns:[{title:"名称",key:"name",align:"center",minWidth:100},{title:"规格",key:"standard",align:"center",width:120},{title:"单位",key:"unit",align:"center",width:120},{title:"种类",align:"center",width:120,render:(e,{row:t})=>e("span",u["b"][t.type]||"其他")},{title:"单价",key:"price",align:"center",width:120,sortable:"custom",render:(e,{row:t})=>e("span","￥"+t.price.toFixed(2))},{title:"修改时间",key:"updateTime",align:"center",width:180,sortable:"custom",sortType:"desc"},{title:"操作",slot:"operate",align:"center",width:200}],selected:[],showSpecialModal:!1,exportLoading:!1,showImport:!1}},methods:{reSearch(){var e;null===(e=this.$refs.table)||void 0===e||e.changePage(1)},sortChange({key:e,order:t}){this.sortParams="normal"===t?{}:{sortBy:e,order:t.toLocaleUpperCase()},this.reSearch()},getData(e){this.selected=[];const t={...e,...this.searchData,...this.sortParams};return Object(s["k"])(t)},changeModal(e){this.detailData={...e},this.showGoodModal=!0},openSpecialMng(e){this.detailData={...e},this.showSpecialModal=!0},deleteData(e=this.selected){if(!e.length)return this.$Message.info("至少选中一项");this.$Modal.confirm({title:"删除商品",content:"是否确认删除所选商品（将会删除该商品所有数据）？",onOk:async()=>{try{const{returnCode:t,data:o}=await Object(s["a"])({goodIds:e.map(e=>e.goodId).join()})||{};0===t&&o&&(this.$Message.success("删除成功"),this.$refs.table.changePage(1))}catch(t){this.$Message.error("删除失败："+(t.message||t))}}})},exportData(){this.exportLoading=!0,Object(s["e"])({...this.searchData,...this.sortParams,goodIds:this.selected.map(e=>e.goodId).join()},`商品${(new Date).format("YYYYMMDDHHmmss")}.xlsx`).finally(()=>{this.exportLoading=!1})}},activated(){this.reSearch()}};const N=y()(D,[["render",n]]);t["default"]=N}}]);
//# sourceMappingURL=chunk-33386866.01ae4b47.js.map