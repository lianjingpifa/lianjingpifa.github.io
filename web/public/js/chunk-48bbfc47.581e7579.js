(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48bbfc47"],{2410:function(e,t,a){(function(t){var a=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var a,o,n;try{a=Map}catch(s){a=function(){}}try{o=Set}catch(s){o=function(){}}try{n=Promise}catch(s){n=function(){}}function l(c,r,u,d,s){"object"===typeof r&&(u=r.depth,d=r.prototype,s=r.includeNonEnumerable,r=r.circular);var b=[],f=[],O="undefined"!=typeof t;function p(c,u){if(null===c)return null;if(0===u)return c;var j,v;if("object"!=typeof c)return c;if(e(c,a))j=new a;else if(e(c,o))j=new o;else if(e(c,n))j=new n((function(e,t){c.then((function(t){e(p(t,u-1))}),(function(e){t(p(e,u-1))}))}));else if(l.__isArray(c))j=[];else if(l.__isRegExp(c))j=new RegExp(c.source,i(c)),c.lastIndex&&(j.lastIndex=c.lastIndex);else if(l.__isDate(c))j=new Date(c.getTime());else{if(O&&t.isBuffer(c))return j=t.allocUnsafe?t.allocUnsafe(c.length):new t(c.length),c.copy(j),j;e(c,Error)?j=Object.create(c):"undefined"==typeof d?(v=Object.getPrototypeOf(c),j=Object.create(v)):(j=Object.create(d),v=d)}if(r){var m=b.indexOf(c);if(-1!=m)return f[m];b.push(c),f.push(j)}for(var h in e(c,a)&&c.forEach((function(e,t){var a=p(t,u-1),o=p(e,u-1);j.set(a,o)})),e(c,o)&&c.forEach((function(e){var t=p(e,u-1);j.add(t)})),c){var g;v&&(g=Object.getOwnPropertyDescriptor(v,h)),g&&null==g.set||(j[h]=p(c[h],u-1))}if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(c);for(h=0;h<y.length;h++){var w=y[h],x=Object.getOwnPropertyDescriptor(c,w);(!x||x.enumerable||s)&&(j[w]=p(c[w],u-1),x.enumerable||Object.defineProperty(j,w,{enumerable:!1}))}}if(s){var V=Object.getOwnPropertyNames(c);for(h=0;h<V.length;h++){var N=V[h];x=Object.getOwnPropertyDescriptor(c,N);x&&x.enumerable||(j[N]=p(c[N],u-1),Object.defineProperty(j,N,{enumerable:!1}))}}return j}return"undefined"==typeof r&&(r=!0),"undefined"==typeof u&&(u=1/0),p(c,u)}function c(e){return Object.prototype.toString.call(e)}function r(e){return"object"===typeof e&&"[object Date]"===c(e)}function u(e){return"object"===typeof e&&"[object Array]"===c(e)}function d(e){return"object"===typeof e&&"[object RegExp]"===c(e)}function i(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return l.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},l.__objToStr=c,l.__isDate=r,l.__isArray=u,l.__isRegExp=d,l.__getRegExpFlags=i,l}();e.exports&&(e.exports=a)}).call(this,a("b639").Buffer)},6504:function(e,t,a){"use strict";a.r(t);var o=a("8738"),n=(a("14d9"),a("7a23")),l=a("2af9"),c=a("eeb9");const r={grid:{bottom:15,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[],axisLabel:{rotate:10,fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"bar",name:"销售总量",barMaxWidth:30,barMinWidth:20,label:{show:!0,position:"top"}}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]},u={grid:{bottom:20,top:20,left:0,right:0,containLabel:!0},legend:{data:["销售总量"],right:0,itemWidth:10,itemHeight:8,textStyle:{fontWeight:400,fontSize:12,padding:[0,0,-3,0]}},tooltip:{trigger:"axis",appendToBody:!0,axisPointer:{type:"shadow"},position:(e,t,a,o,n)=>{let l={top:e[1]-n.contentSize[1]/2};return e[0]+n.contentSize[0]+20<n.viewSize[0]?l.left=e[0]+20:l.left=e[0]-n.contentSize[0]-20,l}},xAxis:{type:"category",data:[],axisLabel:{fontWeight:400,fontSize:12}},yAxis:{type:"value",axisLabel:{fontWeight:400,fontSize:12}},series:[{data:[],type:"line",name:"销售总量",symbol:"circle",symbolSize:10,smooth:!0}],dataZoom:[{type:"slider",height:15,bottom:5,right:5,startValue:0,endValue:9},{type:"inside",startValue:0,endValue:9,zoomOnMouseWheel:!1,moveOnMouseWheel:!0}]};var d=a("2410"),i=a.n(d),s=a("4360");const b=e=>(Object(n["pushScopeId"])("data-v-0cd82ea8"),e=e(),Object(n["popScopeId"])(),e),f={class:"chart-box"},O={class:"chart-header"},p=b(()=>Object(n["createElementVNode"])("p",{class:"vi-title"},[Object(n["createTextVNode"])("商品销量排行榜"),Object(n["createElementVNode"])("span",{class:"vi-text-tip"},"（点击柱子进行趋势分析）")],-1)),j=b(()=>Object(n["createElementVNode"])("span",null,"排行范围：",-1)),v={class:"chart-box"},m={class:"chart-header"},h=b(()=>Object(n["createElementVNode"])("p",{class:"vi-title"},"商品销量趋势分析",-1)),g={class:"flex-none"};var y={__name:"index",setup(e){const t=Object(s["a"])(),a=Object(n["computed"])(()=>t.dictMap),d=Object(n["inject"])("$Message",()=>{}),b={shortcuts:[{text:"本周",value:()=>[(new Date).startOf("week"),new Date]},{text:"近7天",value:()=>[(new Date).subtract(7),new Date]},{text:"本月",value:()=>[(new Date).startOf("month"),new Date]},{text:"近30天",value:()=>[(new Date).subtract(30),new Date]},{text:"近90天",value:()=>[(new Date).subtract(90),new Date]},{text:"今年",value:()=>[(new Date).startOf("year"),new Date]},{text:"近一年",value:()=>[(new Date).subtract(365),new Date]},{text:"近三年",value:()=>[(new Date).subtract(1095),new Date]}]},y=Object(n["ref"])([]),w=Object(n["ref"])({});async function x(){try{const{returnCode:e,data:t}=await Object(c["n"])()||{};if(0===e){y.value=t||[];const e={};y.value.forEach(t=>{e[t.goodId]=t.name}),w.value=e}}catch(e){d.error("获取商品字典失败："+(e.message||e))}}const V=Object(n["ref"])([]),N=Object(n["ref"])({});async function D(){try{const{returnCode:e,data:t}=await Object(c["o"])()||{};if(0===e){V.value=t||[];const e={};V.value.forEach(t=>{e[t.userId]=t.name}),N.value=e}}catch(e){d.error("获取客户列表失败："+(e.message||e))}}const C=Object(n["ref"])({timeRange:[]});function I(){const[e,t]=C.value.timeRange;return{startTime:e&&new Date(e).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:t&&new Date(t).endOf("day").format("YYYY-MM-DD HH:mm:ss")}}const _=Object(n["ref"])({}),k=Object(n["ref"])("month"),S=Object(n["ref"])([]),E=Object(n["ref"])(!1);function Y(){if(!S.value.length)return void(_.value={});const e=i()(u);e.legend.data=S.value.map(({userId:e,goodId:t})=>`${e?N.value[e]+"-":""}${w.value[t]}`),e.xAxis.data=S.value[0].data.map(e=>e.date),e.series=S.value.map(({userId:t,goodId:a,data:o})=>({...e.series[0],name:`${t?N.value[t]+"-":""}${w.value[a]}`,data:o.map(e=>({...e,value:+(e.count||0)}))})),S.value[0].data.length<10&&(e.dataZoom=[]),_.value=e}async function B(e=[],t=!0){try{E.value=!0;const{startTime:n,endTime:l}=I(),{returnCode:r,data:u}=await Object(c["w"])({startTime:n,endTime:l,lineType:k.value,list:e.filter(e=>e)})||{};if(0===r){const e="month"==k.value?"YYYY-MM":"YYYY-MM-DD";let n=(new Date).format(e),l=new Date(0).format(e);for(let t of u){var a,o;const e=(null===(a=t.data[0])||void 0===a?void 0:a.date)||n,c=(null===(o=t.data[t.data.length-1])||void 0===o?void 0:o.date)||n;e>l&&(l=e),c<n&&(n=c)}const c=[];for(let t=l,a=0;t>=n;a++)c.push(t),t="day"===k.value?new Date(t).subtract(1,"days").format("YYYY-MM-DD"):new Date(t).subtract(1,"months").format("YYYY-MM");u.forEach(e=>{e.data=c.map(t=>{const a=e.data.find(e=>e.date===t);return{date:t,count:a?+a.count:0}})}),S.value=t?u||[]:S.value.concat(u||[]),Y()}}catch(n){d.error("获取商品销量趋势失败："+(n.message||n))}finally{E.value=!1}}const M=Object(n["ref"])({}),T=Object(n["ref"])("1"),W=Object(n["ref"])("desc"),z=Object(n["ref"])([]),L=Object(n["ref"])(!1);function P(){if(!z.value.length)return void(M.value={});const e=i()(r);e.legend.data=z.value.map(e=>N.value[e.userId]||"销售总量"),e.xAxis.data=z.value[0].data.map(e=>w.value[e.goodId]),e.series=z.value.map(t=>{const a=t.data.map(e=>({userId:t.userId,goodId:e.goodId,value:+(e.count||0)}));return"asc"===W.value&&a.reverse(),{...e.series[0],name:N.value[t.userId]||"销售总量",data:a}}),z.value[0].data.length<10&&(e.dataZoom=[],e.xAxis.axisLabel.rotate=0),M.value=e}async function R(){try{L.value=!0,E.value=!0;const e=I(),{returnCode:t,data:a}=await Object(c["v"])({...e,label:T.value})||{};if(0===t){z.value=a||[],P();const e=z.value.map(({data:e})=>e[0]);B(e)}}catch(e){d.error("获取商品排行榜失败："+(e.message||e))}finally{L.value=!1}}function A(e){e.on("click",e=>{const{goodId:t,userId:a}=e.data,o=S.value.findIndex(e=>e.goodId==t&&e.userId==a);-1===o?B([{goodId:t,userId:a}],!1):(S.value.splice(o,1),Y())})}return Object(n["onMounted"])(()=>{x(),D(),R()}),(e,t)=>{const c=Object(n["resolveComponent"])("Option"),r=Object(n["resolveComponent"])("viSelect"),u=Object(n["resolveComponent"])("FormItem"),d=Object(n["resolveComponent"])("viSearchForm"),i=Object(n["resolveComponent"])("Spin"),s=Object(n["resolveComponent"])("Icon"),x=Object(n["resolveComponent"])("Button"),D=Object(n["resolveComponent"])("Radio"),I=Object(n["resolveComponent"])("RadioGroup"),U=Object(n["resolveComponent"])("viLayoutUpDown");return Object(n["openBlock"])(),Object(n["createBlock"])(U,null,{up:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=e=>C.value=e),onSearch:R},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{label:"商品范围:",prop:"goodIds"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(r,{modelValue:C.value.goodIds,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value.goodIds=e),multiple:"",placeholder:"全部",class:"stat-width"},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(y.value,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(c,{key:e.goodId,value:String(e.goodId)},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(n["createVNode"])(u,{label:"客户范围:",prop:"userIds"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(r,{modelValue:C.value.userIds,"onUpdate:modelValue":t[1]||(t[1]=e=>C.value.userIds=e),multiple:"",placeholder:"全部",class:"stat-width"},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(V.value,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(c,{key:e.userId,value:String(e.userId)},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(n["createVNode"])(u,{label:"时间范围:",prop:"timeRange"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Object(n["unref"])(o["a"]),{modelValue:C.value.timeRange,"onUpdate:modelValue":t[2]||(t[2]=e=>C.value.timeRange=e),type:"daterange",options:b,placeholder:"请选择",class:"vi-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),down:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",f,[Object(n["createVNode"])(i,{fix:"",show:L.value},null,8,["show"]),Object(n["createElementVNode"])("div",O,[p,Object(n["createElementVNode"])("div",null,[j,Object(n["createVNode"])(r,{modelValue:T.value,"onUpdate:modelValue":t[4]||(t[4]=e=>T.value=e),transfer:"",onOnChange:R,class:"vi-width"},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.value.good,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(c,{key:t,value:e.id},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.name),1)]),_:2},1032,["value"]))),128)),Object(n["createVNode"])(c,{value:"其他"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("其他")]),_:1})]),_:1},8,["modelValue"]),Object(n["createVNode"])(r,{modelValue:W.value,"onUpdate:modelValue":t[5]||(t[5]=e=>W.value=e),transfer:"",clearable:!1,onOnChange:P,class:"vi-width ml-10"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{value:"desc"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("倒序")]),_:1}),Object(n["createVNode"])(c,{value:"asc"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("升序")]),_:1})]),_:1},8,["modelValue"])])]),Object(n["createVNode"])(Object(n["unref"])(l["b"]),{options:M.value,onOnMount:A,class:"chart-content"},null,8,["options"])]),Object(n["createElementVNode"])("div",v,[Object(n["createVNode"])(i,{fix:"",show:E.value},null,8,["show"]),Object(n["createElementVNode"])("div",m,[h,Object(n["createElementVNode"])("p",{class:"line-legend",ref:"list",onWheel:t[6]||(t[6]=t=>e.$refs.list.scrollLeft+=t.deltaY)},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(S.value,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:t},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.userId?N.value[e.userId]+"-":"")+Object(n["toDisplayString"])(w.value[e.goodId])+" ",1),Object(n["createVNode"])(s,{type:"md-close",size:"16",onClick:e=>{S.value.splice(t,1),Y()},class:"vi-link-pointer mr-5"},null,8,["onClick"])]))),128))],544),Object(n["createElementVNode"])("div",g,[Object(n["createVNode"])(x,{class:"mr-15",onClick:t[7]||(t[7]=e=>B(z.value.map(({data:e})=>e[0])))},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("重置")]),_:1}),Object(n["createVNode"])(I,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=e=>k.value=e),type:"button","button-style":"solid",onOnChange:t[9]||(t[9]=e=>B(S.value))},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(D,{label:"month"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("按月")]),_:1}),Object(n["createVNode"])(D,{label:"day"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("按天")]),_:1})]),_:1},8,["modelValue"])])]),Object(n["createVNode"])(Object(n["unref"])(l["b"]),{options:_.value,class:"chart-content"},null,8,["options"])])]),_:1})}}},w=(a("6ba3"),a("6b0d")),x=a.n(w);const V=x()(y,[["__scopeId","data-v-0cd82ea8"]]);t["default"]=V},"6b01":function(e,t,a){},"6ba3":function(e,t,a){"use strict";a("6b01")}}]);